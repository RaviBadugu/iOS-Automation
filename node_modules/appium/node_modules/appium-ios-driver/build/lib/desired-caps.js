"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.desiredCapValidation = desiredCapValidation;
exports.default = exports.desiredCapConstraints = void 0;

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

const desiredCapConstraints = {
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: ['iOS']
  },
  browserName: {
    isString: true
  },
  app: {
    isString: true
  },
  launchTimeout: {},
  calendarFormat: {
    isString: true
  },
  bundleId: {
    isString: true
  },
  udid: {
    isString: true
  },
  locationServicesEnabled: {
    isBoolean: true
  },
  locationServicesAuthorized: {
    isBoolean: true
  },
  autoAcceptAlerts: {
    isBoolean: true
  },
  autoDismissAlerts: {
    isBoolean: true
  },
  nativeInstrumentsLib: {
    isBoolean: true
  },
  nativeWebTap: {
    isBoolean: true
  },
  safariInitialUrl: {
    isString: true
  },
  safariAllowPopups: {
    isBoolean: true
  },
  safariIgnoreFraudWarning: {
    isBoolean: true
  },
  safariOpenLinksInBackground: {
    isBoolean: true
  },
  safariGarbageCollect: {
    isBoolean: true
  },
  keepKeyChains: {
    isBoolean: true
  },
  localizableStringsDir: {
    isString: true
  },
  processArguments: {},
  interKeyDelay: {
    isNumber: true
  },
  showIOSLog: {
    isBoolean: true
  },
  sendKeyStrategy: {
    isString: true,
    inclusion: ['oneByOne', 'grouped', 'setValue']
  },
  screenshotWaitTimeout: {
    isNumber: true
  },
  waitForAppScript: {
    isString: true
  },
  webviewConnectRetries: {
    isNumber: true
  },
  appName: {
    isString: true
  },
  clearSystemFiles: {
    isBoolean: true
  },
  customSSLCert: {
    isString: true
  },
  webkitResponseTimeout: {
    isNumber: true
  },
  remoteDebugProxy: {
    isString: true
  },
  enablePerformanceLogging: {
    isBoolean: true
  },
  enableAsyncExecuteFromHttps: {
    isBoolean: true
  },
  realDeviceLogger: {
    isString: true
  },
  fullContextList: {
    isBoolean: true
  },
  ignoreAboutBlankUrl: {
    isBoolean: true
  }
};
exports.desiredCapConstraints = desiredCapConstraints;

function desiredCapValidation(caps) {
  if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
    let msg = 'The desired capabilities must include either an app or a bundleId for iOS';

    _logger.default.errorAndThrow(msg);
  }

  if (caps.launchTimeout) {
    let msg = 'launchTimeout must be a number, object, or string JSON object';

    if (!_lodash.default.isNumber(caps.launchTimeout)) {
      if (_lodash.default.isString(caps.launchTimeout)) {
        try {
          caps.launchTimeout = JSON.parse(caps.launchTimeout);
        } catch (err) {
          _logger.default.errorAndThrow(msg);
        }
      }

      if (!_lodash.default.isObject(caps.launchTimeout)) {
        _logger.default.errorAndThrow(msg);
      }
    }
  }

  if (caps.processArguments) {
    if (_lodash.default.isString(caps.processArguments)) {
      try {
        caps.processArguments = JSON.parse(caps.processArguments);
      } catch (ign) {}
    } else if (!_lodash.default.isObject(caps.processArguments)) {
      _logger.default.errorAndThrow('processArguments must be a string, object, or a string JSON object');
    }
  }

  if (typeof caps.enablePerformanceLogging !== 'boolean' && typeof caps.loggingPrefs === 'object' && caps.loggingPrefs.performance) {
    caps.enablePerformanceLogging = !!caps.loggingPrefs.performance;
  }

  return true;
}

var _default = desiredCapConstraints;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZXNpcmVkLWNhcHMuanMiXSwibmFtZXMiOlsiZGVzaXJlZENhcENvbnN0cmFpbnRzIiwicGxhdGZvcm1OYW1lIiwicHJlc2VuY2UiLCJpc1N0cmluZyIsImluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZSIsImJyb3dzZXJOYW1lIiwiYXBwIiwibGF1bmNoVGltZW91dCIsImNhbGVuZGFyRm9ybWF0IiwiYnVuZGxlSWQiLCJ1ZGlkIiwibG9jYXRpb25TZXJ2aWNlc0VuYWJsZWQiLCJpc0Jvb2xlYW4iLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImF1dG9BY2NlcHRBbGVydHMiLCJhdXRvRGlzbWlzc0FsZXJ0cyIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwibmF0aXZlV2ViVGFwIiwic2FmYXJpSW5pdGlhbFVybCIsInNhZmFyaUFsbG93UG9wdXBzIiwic2FmYXJpSWdub3JlRnJhdWRXYXJuaW5nIiwic2FmYXJpT3BlbkxpbmtzSW5CYWNrZ3JvdW5kIiwic2FmYXJpR2FyYmFnZUNvbGxlY3QiLCJrZWVwS2V5Q2hhaW5zIiwibG9jYWxpemFibGVTdHJpbmdzRGlyIiwicHJvY2Vzc0FyZ3VtZW50cyIsImludGVyS2V5RGVsYXkiLCJpc051bWJlciIsInNob3dJT1NMb2ciLCJzZW5kS2V5U3RyYXRlZ3kiLCJpbmNsdXNpb24iLCJzY3JlZW5zaG90V2FpdFRpbWVvdXQiLCJ3YWl0Rm9yQXBwU2NyaXB0Iiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiYXBwTmFtZSIsImNsZWFyU3lzdGVtRmlsZXMiLCJjdXN0b21TU0xDZXJ0Iiwid2Via2l0UmVzcG9uc2VUaW1lb3V0IiwicmVtb3RlRGVidWdQcm94eSIsImVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZyIsImVuYWJsZUFzeW5jRXhlY3V0ZUZyb21IdHRwcyIsInJlYWxEZXZpY2VMb2dnZXIiLCJmdWxsQ29udGV4dExpc3QiLCJpZ25vcmVBYm91dEJsYW5rVXJsIiwiZGVzaXJlZENhcFZhbGlkYXRpb24iLCJjYXBzIiwidG9Mb3dlckNhc2UiLCJtc2ciLCJsb2dnZXIiLCJlcnJvckFuZFRocm93IiwiXyIsIkpTT04iLCJwYXJzZSIsImVyciIsImlzT2JqZWN0IiwiaWduIiwibG9nZ2luZ1ByZWZzIiwicGVyZm9ybWFuY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFHQSxNQUFNQSxxQkFBcUIsR0FBRztBQUM1QkMsRUFBQUEsWUFBWSxFQUFFO0FBQ1pDLElBQUFBLFFBQVEsRUFBRSxJQURFO0FBRVpDLElBQUFBLFFBQVEsRUFBRSxJQUZFO0FBR1pDLElBQUFBLHdCQUF3QixFQUFFLENBQUMsS0FBRDtBQUhkLEdBRGM7QUFNNUJDLEVBQUFBLFdBQVcsRUFBRTtBQUNYRixJQUFBQSxRQUFRLEVBQUU7QUFEQyxHQU5lO0FBUzVCRyxFQUFBQSxHQUFHLEVBQUU7QUFDSEgsSUFBQUEsUUFBUSxFQUFFO0FBRFAsR0FUdUI7QUFhNUJJLEVBQUFBLGFBQWEsRUFBRSxFQWJhO0FBaUI1QkMsRUFBQUEsY0FBYyxFQUFFO0FBQ2RMLElBQUFBLFFBQVEsRUFBRTtBQURJLEdBakJZO0FBb0I1Qk0sRUFBQUEsUUFBUSxFQUFFO0FBQ1JOLElBQUFBLFFBQVEsRUFBRTtBQURGLEdBcEJrQjtBQXVCNUJPLEVBQUFBLElBQUksRUFBRTtBQUNKUCxJQUFBQSxRQUFRLEVBQUU7QUFETixHQXZCc0I7QUEwQjVCUSxFQUFBQSx1QkFBdUIsRUFBRTtBQUN2QkMsSUFBQUEsU0FBUyxFQUFFO0FBRFksR0ExQkc7QUE2QjVCQyxFQUFBQSwwQkFBMEIsRUFBRTtBQUMxQkQsSUFBQUEsU0FBUyxFQUFFO0FBRGUsR0E3QkE7QUFnQzVCRSxFQUFBQSxnQkFBZ0IsRUFBRTtBQUNoQkYsSUFBQUEsU0FBUyxFQUFFO0FBREssR0FoQ1U7QUFtQzVCRyxFQUFBQSxpQkFBaUIsRUFBRTtBQUNqQkgsSUFBQUEsU0FBUyxFQUFFO0FBRE0sR0FuQ1M7QUFzQzVCSSxFQUFBQSxvQkFBb0IsRUFBRTtBQUNwQkosSUFBQUEsU0FBUyxF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LFFBRDdCLElBQ3lDWCxJQUFJLENBQUNXLFlBQUwsQ0FBa0JDLFdBRC9ELEVBQzRFO0FBQzFFWixJQUFBQSxJQUFJLENBQUNOLHdCQUFMLEdBQWdDLENBQUMsQ0FBQ00sSUFBSSxDQUFDVyxZQUFMLENBQWtCQyxXQUFwRDtBQUNEOztBQUdELFNBQU8sSUFBUDtBQUNEOztlQUdjekQscUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5cblxuY29uc3QgZGVzaXJlZENhcENvbnN0cmFpbnRzID0ge1xuICBwbGF0Zm9ybU5hbWU6IHtcbiAgICBwcmVzZW5jZTogdHJ1ZSxcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICBpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmU6IFsnaU9TJ11cbiAgfSxcbiAgYnJvd3Nlck5hbWU6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBhcHA6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuXG4gIGxhdW5jaFRpbWVvdXQ6IHtcbiAgICAvLyByZWNvZ25pemUgdGhlIGNhcCxcbiAgICAvLyBidXQgdmFsaWRhdGUgaW4gdGhlIGRyaXZlciN2YWxpZGF0ZURlc2lyZWRDYXBzIG1ldGhvZFxuICB9LFxuICBjYWxlbmRhckZvcm1hdDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGJ1bmRsZUlkOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgdWRpZDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGxvY2F0aW9uU2VydmljZXNFbmFibGVkOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGxvY2F0aW9uU2VydmljZXNBdXRob3JpemVkOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGF1dG9BY2NlcHRBbGVydHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgYXV0b0Rpc21pc3NBbGVydHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbmF0aXZlSW5zdHJ1bWVudHNMaWI6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbmF0aXZlV2ViVGFwOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUluaXRpYWxVcmw6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBzYWZhcmlBbGxvd1BvcHVwczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlJZ25vcmVGcmF1ZFdhcm5pbmc6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpT3BlbkxpbmtzSW5CYWNrZ3JvdW5kOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUdhcmJhZ2VDb2xsZWN0OiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGtlZXBLZXlDaGFpbnM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbG9jYWxpemFibGVTdHJpbmdzRGlyOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgcHJvY2Vzc0FyZ3VtZW50czoge1xuICAgIC8vIHJlY29nbml6ZSB0aGUgY2FwLFxuICAgIC8vIGJ1dCB2YWxpZGF0ZSBpbiB0aGUgZHJpdmVyI3ZhbGlkYXRlRGVzaXJlZENhcHMgbWV0aG9kXG4gIH0sXG4gIGludGVyS2V5RGVsYXk6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICBzaG93SU9TTG9nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNlbmRLZXlTdHJhdGVneToge1xuICAgIGlzU3RyaW5nOiB0cnVlLFxuICAgIGluY2x1c2lvbjogWydvbmVCeU9uZScsICdncm91cGVkJywgJ3NldFZhbHVlJ11cbiAgfSxcbiAgc2NyZWVuc2hvdFdhaXRUaW1lb3V0OiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgd2FpdEZvckFwcFNjcmlwdDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHdlYnZpZXdDb25uZWN0UmV0cmllczoge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIGFwcE5hbWU6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBjbGVhclN5c3RlbUZpbGVzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGN1c3RvbVNTTENlcnQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICB3ZWJraXRSZXNwb25zZVRpbWVvdXQ6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICByZW1vdGVEZWJ1Z1Byb3h5OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGVuYWJsZUFzeW5jRXhlY3V0ZUZyb21IdHRwczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICByZWFsRGV2aWNlTG9nZ2VyOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgZnVsbENvbnRleHRMaXN0OiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGlnbm9yZUFib3V0QmxhbmtVcmw6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIGRlc2lyZWRDYXBWYWxpZGF0aW9uIChjYXBzKSB7XG4gIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYXBhYmlsaXRpZXMgaGF2ZSBvbmUgb2YgYGFwcGAgb3IgYGJ1bmRsZUlkYFxuICBpZiAoKGNhcHMuYnJvd3Nlck5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkgIT09ICdzYWZhcmknICYmXG4gICAgICAhY2Fwcy5hcHAgJiYgIWNhcHMuYnVuZGxlSWQpIHtcbiAgICBsZXQgbXNnID0gJ1RoZSBkZXNpcmVkIGNhcGFiaWxpdGllcyBtdXN0IGluY2x1ZGUgZWl0aGVyIGFuIGFwcCBvciBhIGJ1bmRsZUlkIGZvciBpT1MnO1xuICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gIH1cblxuICAvLyBgbGF1bmNoVGltZW91dGAgaXMgbW9yZSBjb21wbGV4IHRoYW4gdGhlIHZhbGlkYXRvcnMgY2FuIGVhc2lseSBoYW5kbGVcbiAgLy8gYW5kIHRvbyBzcGVjaWZpYyBmb3IgYSBnZW5lcmFsaXplZCB2YWxpZGF0b3Igb2YgaXRzIG93blxuICBpZiAoY2Fwcy5sYXVuY2hUaW1lb3V0KSB7XG4gICAgLy8gaXQgY2FuIGJlIGEgbnVtYmVyLCBhIEpTT04gc3RyaW5nLCBvciBhbiBvYmplY3RcbiAgICBsZXQgbXNnID0gJ2xhdW5jaFRpbWVvdXQgbXVzdCBiZSBhIG51bWJlciwgb2JqZWN0LCBvciBzdHJpbmcgSlNPTiBvYmplY3QnO1xuICAgIGlmICghXy5pc051bWJlcihjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICBpZiAoXy5pc1N0cmluZyhjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICAgIC8vIGlmIHRoaXMgaXMgYSBzdHJpbmcsIGl0IG11c3QgYmUgYSBKU09OIHN0cmluZ1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIGNoYW5nZSBgbGF1bmNoVGltZW91dGAgdG8gYW4gb2JqZWN0XG4gICAgICAgICAgY2Fwcy5sYXVuY2hUaW1lb3V0ID0gSlNPTi5wYXJzZShjYXBzLmxhdW5jaFRpbWVvdXQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAvLyBpdCB3YXMgYSBzdHJpbmcsIGJ1dCBub3Qgc29tZXRoaW5nIHBhcnNhYmxlIGFzIEpTT05cbiAgICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNPYmplY3QoY2Fwcy5sYXVuY2hUaW1lb3V0KSkge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGBwcm9jZXNzQXJndW1lbnRzYCBpcyBtb3JlIGNvbXBsZXggYXMgaXQgY2FuIGJlIGEgc3RyaW5nXG4gIC8vIG9yIGEgaGFzaFxuICBpZiAoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKSB7XG4gICAgaWYgKF8uaXNTdHJpbmcoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gdHJ5IHRvIHBhcnNlIHRoZSBzdHJpbmcgYXMgSlNPTlxuICAgICAgICBjYXBzLnByb2Nlc3NBcmd1bWVudHMgPSBKU09OLnBhcnNlKGNhcHMucHJvY2Vzc0FyZ3VtZW50cyk7XG4gICAgICB9IGNhdGNoIChpZ24pIHtcbiAgICAgICAgLy8gaWYgd2UgY2Fubm90IHBhcnNlLCBqdXN0IGxlYXZlIGFzIGEgc3RyaW5nXG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghXy5pc09iamVjdChjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdygncHJvY2Vzc0FyZ3VtZW50cyBtdXN0IGJlIGEgc3RyaW5nLCBvYmplY3QsIG9yIGEgc3RyaW5nIEpTT04gb2JqZWN0Jyk7XG4gICAgfVxuICB9XG5cbiAgLy8gdGhlcmUgaXMgYW4gdW5kb2N1bWVudGVkIGxlZ2FjeSBjYXAgYGxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZWAgdG8gZW5hYmxlXG4gIC8vIHBlcmZvcm1hbmNlIGxvZ2dpbmcuIFRyYW5zbGF0ZSB0byBgZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nYFxuICBpZiAodHlwZW9mIGNhcHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nICE9PSAnYm9vbGVhbicgJiZcbiAgICAgIHR5cGVvZiBjYXBzLmxvZ2dpbmdQcmVmcyA9PT0gJ29iamVjdCcgJiYgY2Fwcy5sb2dnaW5nUHJlZnMucGVyZm9ybWFuY2UpIHtcbiAgICBjYXBzLmVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZyA9ICEhY2Fwcy5sb2dnaW5nUHJlZnMucGVyZm9ybWFuY2U7XG4gIH1cblxuICAvLyBmaW5hbGx5LCByZXR1cm4gdHJ1ZSBzaW5jZSB0aGUgc3VwZXJjbGFzcyBjaGVjayBwYXNzZWQsIGFzIGRpZCB0aGlzXG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgeyBkZXNpcmVkQ2FwQ29uc3RyYWludHMsIGRlc2lyZWRDYXBWYWxpZGF0aW9uIH07XG5leHBvcnQgZGVmYXVsdCBkZXNpcmVkQ2FwQ29uc3RyYWludHM7XG4iXSwiZmlsZSI6ImxpYi9kZXNpcmVkLWNhcHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
