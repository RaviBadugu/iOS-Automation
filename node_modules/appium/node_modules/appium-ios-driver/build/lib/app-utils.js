"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.extractAppDisplayName = extractAppDisplayName;
exports.extractBundleId = extractBundleId;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _logger = _interopRequireDefault(require("./logger.js"));

let plistObjects = {};

function extractPlist(_x) {
  return _extractPlist.apply(this, arguments);
}

function _extractPlist() {
  _extractPlist = (0, _asyncToGenerator2.default)(function* (app) {
    let plistFile = _path.default.resolve(app, 'Info.plist');

    try {
      return yield _appiumSupport.plist.parsePlistFile(plistFile);
    } catch (err) {
      _logger.default.errorAndThrow(`Could not extract Info.plist from application: ${err.message}`);
    }
  });
  return _extractPlist.apply(this, arguments);
}

function extractPlistEntry(_x2, _x3) {
  return _extractPlistEntry.apply(this, arguments);
}

function _extractPlistEntry() {
  _extractPlistEntry = (0, _asyncToGenerator2.default)(function* (app, entryName) {
    if (_lodash.default.isUndefined(plistObjects[app])) {
      plistObjects[app] = yield extractPlist(app);
    }

    return plistObjects[app][entryName];
  });
  return _extractPlistEntry.apply(this, arguments);
}

function extractAppDisplayName(_x4) {
  return _extractAppDisplayName.apply(this, arguments);
}

function _extractAppDisplayName() {
  _extractAppDisplayName = (0, _asyncToGenerator2.default)(function* (app) {
    _logger.default.debug("Getting application name from app");

    return yield extractPlistEntry(app, 'CFBundleDisplayName');
  });
  return _extractAppDisplayName.apply(this, arguments);
}

function extractBundleId(_x5) {
  return _extractBundleId.apply(this, arguments);
}

function _extractBundleId() {
  _extractBundleId = (0, _asyncToGenerator2.default)(function* (app) {
    let bundleId = yield extractPlistEntry(app, 'CFBundleIdentifier');

    _logger.default.debug(`Getting bundle ID from app '${app}': '${bundleId}'`);

    return bundleId;
  });
  return _extractBundleId.apply(this, arguments);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hcHAtdXRpbHMuanMiXSwibmFtZXMiOlsicGxpc3RPYmplY3RzIiwiZXh0cmFjdFBsaXN0IiwiYXBwIiwicGxpc3RGaWxlIiwicGF0aCIsInJlc29sdmUiLCJwbGlzdCIsInBhcnNlUGxpc3RGaWxlIiwiZXJyIiwibG9nIiwiZXJyb3JBbmRUaHJvdyIsIm1lc3NhZ2UiLCJleHRyYWN0UGxpc3RFbnRyeSIsImVudHJ5TmFtZSIsIl8iLCJpc1VuZGVmaW5lZCIsImV4dHJhY3RBcHBEaXNwbGF5TmFtZSIsImRlYnVnIiwiZXh0cmFjdEJ1bmRsZUlkIiwiYnVuZGxlSWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLElBQUlBLFlBQVksR0FBRyxFQUFuQjs7U0FFZUMsWTs7Ozs7a0RBQWYsV0FBNkJDLEdBQTdCLEVBQWtDO0FBQ2hDLFFBQUlDLFNBQVMsR0FBR0MsY0FBS0MsT0FBTCxDQUFhSCxHQUFiLEVBQWtCLFlBQWxCLENBQWhCOztBQUNBLFFBQUk7QUFDRixtQkFBYUkscUJBQU1DLGNBQU4sQ0FBcUJKLFNBQXJCLENBQWI7QUFDRCxLQUZELENBRUUsT0FBT0ssR0FBUCxFQUFZO0FBQ1pDLHNCQUFJQyxhQUFKLENBQW1CLGtEQUFpREYsR0FBRyxDQUFDRyxPQUFRLEVBQWhGO0FBQ0Q7QUFDRixHOzs7O1NBRWNDLGlCOzs7Ozt1REFBZixXQUFrQ1YsR0FBbEMsRUFBdUNXLFNBQXZDLEVBQWtEO0FBQ2hELFFBQUlDLGdCQUFFQyxXQUFGLENBQWNmLFlBQVksQ0FBQ0UsR0FBRCxDQUExQixDQUFKLEVBQXNDO0FBQ3BDRixNQUFBQSxZQUFZLENBQUNFLEdBQUQsQ0FBWixTQUEwQkQsWUFBWSxDQUFDQyxHQUFELENBQXRDO0FBQ0Q7O0FBRUQsV0FBT0YsWUFBWSxDQUFDRSxHQUFELENBQVosQ0FBa0JXLFNBQWxCLENBQVA7QUFDRCxHOzs7O1NBRWNHLHFCOzs7OzsyREFBZixXQUFzQ2QsR0FBdEMsRUFBMkM7QUFDekNPLG9CQUFJUSxLQUFKLENBQVUsbUNBQVY7O0FBQ0EsaUJBQWFMLGlCQUFpQixDQUFDVixHQUFELEVBQU0scUJBQU4sQ0FBOUI7QUFDRCxHOzs7O1NBRWNnQixlOzs7OztxREFBZixXQUFnQ2hCLEdBQWhDLEVBQXFDO0FBQ25DLFFBQUlpQixRQUFRLFNBQVNQLGlCQUFpQixDQUFDVixHQUFELEVBQU0sb0JBQU4sQ0FBdEM7O0FBQ0FPLG9CQUFJUSxLQUFKLENBQVcsK0JBQThCZixHQUFJLE9BQU1pQixRQUFTLEdBQTVEOztBQUNBLFdBQU9BLFFBQVA7QUFDRCxHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgcGxpc3QgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyLmpzJztcblxuXG5sZXQgcGxpc3RPYmplY3RzID0ge307XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RQbGlzdCAoYXBwKSB7XG4gIGxldCBwbGlzdEZpbGUgPSBwYXRoLnJlc29sdmUoYXBwLCAnSW5mby5wbGlzdCcpO1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShwbGlzdEZpbGUpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGV4dHJhY3QgSW5mby5wbGlzdCBmcm9tIGFwcGxpY2F0aW9uOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RQbGlzdEVudHJ5IChhcHAsIGVudHJ5TmFtZSkge1xuICBpZiAoXy5pc1VuZGVmaW5lZChwbGlzdE9iamVjdHNbYXBwXSkpIHtcbiAgICBwbGlzdE9iamVjdHNbYXBwXSA9IGF3YWl0IGV4dHJhY3RQbGlzdChhcHApO1xuICB9XG5cbiAgcmV0dXJuIHBsaXN0T2JqZWN0c1thcHBdW2VudHJ5TmFtZV07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RBcHBEaXNwbGF5TmFtZSAoYXBwKSB7XG4gIGxvZy5kZWJ1ZyhcIkdldHRpbmcgYXBwbGljYXRpb24gbmFtZSBmcm9tIGFwcFwiKTtcbiAgcmV0dXJuIGF3YWl0IGV4dHJhY3RQbGlzdEVudHJ5KGFwcCwgJ0NGQnVuZGxlRGlzcGxheU5hbWUnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXh0cmFjdEJ1bmRsZUlkIChhcHApIHtcbiAgbGV0IGJ1bmRsZUlkID0gYXdhaXQgZXh0cmFjdFBsaXN0RW50cnkoYXBwLCAnQ0ZCdW5kbGVJZGVudGlmaWVyJyk7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBidW5kbGUgSUQgZnJvbSBhcHAgJyR7YXBwfSc6ICcke2J1bmRsZUlkfSdgKTtcbiAgcmV0dXJuIGJ1bmRsZUlkO1xufVxuXG5cbmV4cG9ydCB7IGV4dHJhY3RBcHBEaXNwbGF5TmFtZSwgZXh0cmFjdEJ1bmRsZUlkIH07XG4iXSwiZmlsZSI6ImxpYi9hcHAtdXRpbHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
