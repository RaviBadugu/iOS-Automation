"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _appiumBaseDriver = require("appium-base-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _utils = require("../utils");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getAttribute = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (attribute, el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.getAtomsElement(el);

      if (_lodash.default.isNull(atomsElement)) {
        throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
      } else {
        return yield this.executeAtom('get_attribute_value', [atomsElement, attribute]);
      }
    } else {
      if (attribute === 'contentSize') {
        return yield this.getElementContentSize(el);
      }

      if (_lodash.default.includes(['label', 'name', 'value', 'values', 'hint'], attribute)) {
        let command = `au.getElement('${el}').${attribute}()`;
        return yield this.uiAutoClient.sendCommand(command);
      } else {
        throw new _appiumBaseDriver.errors.UnknownCommandError(`UIAElements don't have the attribute '${attribute}'`);
      }
    }
  });

  return function (_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

commands.clear = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      yield this.executeAtom('clear', [atomsElement]);
    } else {
      let command = `au.getElement('${el}').setValue('')`;
      yield this.uiAutoClient.sendCommand(command);
    }
  });

  return function (_x3) {
    return _ref2.apply(this, arguments);
  };
}();

commands.setValueImmediate = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (value, el) {
    el = (0, _utils.unwrapEl)(el);
    value = _appiumSupport.util.escapeSpecialChars(value, "'");
    let command = `au.getElement('${el}').setValue('${value}')`;
    yield this.uiAutoClient.sendCommand(command);
  });

  return function (_x4, _x5) {
    return _ref3.apply(this, arguments);
  };
}();

commands.setValue = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (value, el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      yield this.executeAtom('click', [atomsElement]);
      yield this.executeAtom('type', [atomsElement, value]);
    } else {
      if (value instanceof Array) {
        value = value.join("");
      }

      if (typeof value !== 'string') {
        value = value.toString();
      }

      value = _appiumSupport.util.escapeSpecialChars(value, "'");
      value = value.replace(/\\\\n/g, "\\n");

      if (this.opts.useRobot) {
        throw new _appiumBaseDriver.errors.NotYetImplementedError();
      } else {
        let command = `au.getElement('${el}').setValueByType('${value}')`;
        yield this.uiAutoClient.sendCommand(command);
      }
    }
  });

  return function (_x6, _x7) {
    return _ref4.apply(this, arguments);
  };
}();

commands.getText = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      return yield this.executeAtom('get_text', [atomsElement]);
    } else {
      let command = `au.getElement('${el}').text()`;
      let res = yield this.uiAutoClient.sendCommand(command);
      res = res ? res.toString() : '';
      return res;
    }
  });

  return function (_x8) {
    return _ref5.apply(this, arguments);
  };
}();

commands.elementDisplayed = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      return yield this.executeAtom('is_displayed', [atomsElement]);
    } else {
      let command = `au.getElement('${el}').isDisplayed()`;
      return yield this.uiAutoClient.sendCommand(command);
    }
  });

  return function (_x9) {
    return _ref6.apply(this, arguments);
  };
}();

commands.elementEnabled = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      return yield this.executeAtom('is_enabled', [atomsElement]);
    } else {
      let command = `au.getElement('${el}').isEnabled() === 1`;
      return yield this.uiAutoClient.sendCommand(command);
    }
  });

  return function (_x10) {
    return _ref7.apply(this, arguments);
  };
}();

commands.elementSelected = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      return yield this.executeAtom('is_selected', [atomsElement]);
    } else {
      let command = `au.getElement('${el}').isSelected()`;
      return yield this.uiAutoClient.sendCommand(command);
    }
  });

  return function (_x11) {
    return _ref8.apply(this, arguments);
  };
}();

commands.getName = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.useAtomsElement(el);
      let script = 'return arguments[0].tagName.toLowerCase()';
      return yield this.executeAtom('execute_script', [script, [atomsElement]]);
    } else {
      let command = `au.getElement('${el}').type()`;
      return yield this.uiAutoClient.sendCommand(command);
    }
  });

  return function (_x12) {
    return _ref9.apply(this, arguments);
  };
}();

commands.getLocation = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = yield this.useAtomsElement(el);
      return yield this.executeAtom('get_top_left_coordinates', [atomsElement]);
    } else {
      let command = `au.getElement('${el}').getElementLocation()`;
      return yield this.uiAutoClient.sendCommand(command);
    }
  });

  return function (_x13) {
    return _ref10.apply(this, arguments);
  };
}();

commands.getLocationInView = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (el) {
    return yield this.getLocation(el);
  });

  return function (_x14) {
    return _ref11.apply(this, arguments);
  };
}();

commands.getSize = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);

    if (this.isWebContext()) {
      let atomsElement = this.getAtomsElement(el);

      if (atomsElement === null) {
        throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
      } else {
        return yield this.executeAtom('get_size', [atomsElement]);
      }
    } else {
      let command = `au.getElement('${el}').getElementSize()`;
      return yield this.uiAutoClient.sendCommand(command);
    }
  });

  return function (_x15) {
    return _ref12.apply(this, arguments);
  };
}();

commands.getElementContentSize = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (el) {
    el = (0, _utils.unwrapEl)(el);
    const command = `au.getElement('${el}').childElementsFrames()`;
    const frames = yield this.uiAutoClient.sendCommand(command);
    const type = yield this.getName(el);
    let contentHeight = 0;

    switch (type) {
      case "UIATableView":
        {
          const firstElementFrame = _lodash.default.first(frames);

          const lastElementFrame = _lodash.default.last(frames);

          contentHeight = lastElementFrame.origin.y + lastElementFrame.size.height - firstElementFrame.origin.y;
          break;
        }

      case "UIACollectionView":
        {
          let firstElementFrame = _lodash.default.first(frames);

          let elementsInRow = 0;
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = frames.entries()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              const _step$value = (0, _slicedToArray2.default)(_step.value, 2),
                    i = _step$value[0],
                    frame = _step$value[1];

              if (frame.origin.y !== firstElementFrame.origin.y) {
                elementsInRow = i;
                break;
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return != null) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }

          const spaceBetweenElements = frames[elementsInRow].origin.y - frames[elementsInRow - 1].origin.y - frames[elementsInRow - 1].size.height;
          const numberOfRows = Math.ceil(frames.length / elementsInRow);
          contentHeight = numberOfRows * firstElementFrame.size.height + spaceBetweenElements * (numberOfRows - 1);
          break;
        }

      default:
        {
          return null;
        }
    }

    const size = yield this.getSize(el);
    const topLeftCoord = yield this.getLocationInView(el);
    return JSON.stringify({
      width: size.width,
      height: size.height,
      top: topLeftCoord.y,
      left: topLeftCoord.x,
      scrollableOffset: contentHeight
    });
  });

  return function (_x16) {
    return _ref13.apply(this, arguments);
  };
}();

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbCIsImlzV2ViQ29udGV4dCIsImF0b21zRWxlbWVudCIsImdldEF0b21zRWxlbWVudCIsIl8iLCJpc051bGwiLCJlcnJvcnMiLCJVbmtub3duRXJyb3IiLCJleGVjdXRlQXRvbSIsImdldEVsZW1lbnRDb250ZW50U2l6ZSIsImluY2x1ZGVzIiwiY29tbWFuZCIsInVpQXV0b0NsaWVudCIsInNlbmRDb21tYW5kIiwiVW5rbm93bkNvbW1hbmRFcnJvciIsImNsZWFyIiwidXNlQXRvbXNFbGVtZW50Iiwic2V0VmFsdWVJbW1lZGlhdGUiLCJ2YWx1ZSIsInV0aWwiLCJlc2NhcGVTcGVjaWFsQ2hhcnMiLCJzZXRWYWx1ZSIsIkFycmF5Iiwiam9pbiIsInRvU3RyaW5nIiwicmVwbGFjZSIsIm9wdHMiLCJ1c2VSb2JvdCIsIk5vdFlldEltcGxlbWVudGVkRXJyb3IiLCJnZXRUZXh0IiwicmVzIiwiZWxlbWVudERpc3BsYXllZCIsImVsZW1lbnRFbmFibGVkIiwiZWxlbWVudFNlbGVjdGVkIiwiZ2V0TmFtZSIsInNjcmlwdCIsImdldExvY2F0aW9uIiwiZ2V0TG9jYXRpb25JblZpZXciLCJnZXRTaXplIiwiZnJhbWVzIiwidHlwZSIsImNvbnRlbnRIZWlnaHQiLCJmaXJzdEVsZW1lbnRGcmFtZSIsImZpcnN0IiwibGFzdEVsZW1lbnRGcmFtZSIsImxhc3QiLCJvcmlnaW4iLCJ5Iiwic2l6ZSIsImhlaWdodCIsImVsZW1lbnRzSW5Sb3ciLCJlbnRyaWVzIiwiaSIsImZyYW1lIiwic3BhY2VCZXR3ZWVuRWxlbWVudHMiLCJudW1iZXJPZlJvd3MiLCJNYXRoIiwiY2VpbCIsImxlbmd0aCIsInRvcExlZnRDb29yZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ3aWR0aCIsInRvcCIsImxlZnQiLCJ4Iiwic2Nyb2xsYWJsZU9mZnNldCIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLFFBQVEsR0FBRyxFQUFmO0FBQUEsSUFBbUJDLE9BQU8sR0FBRyxFQUE3QjtBQUFBLElBQWlDQyxVQUFVLEdBQUcsRUFBOUM7Ozs7QUFFQUYsUUFBUSxDQUFDRyxZQUFUO0FBQUEsNkNBQXdCLFdBQWdCQyxTQUFoQixFQUEyQkMsRUFBM0IsRUFBK0I7QUFDckRBLElBQUFBLEVBQUUsR0FBRyxxQkFBU0EsRUFBVCxDQUFMOztBQUNBLFFBQUksS0FBS0MsWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFVBQUlDLFlBQVksR0FBRyxLQUFLQyxlQUFMLENBQXFCSCxFQUFyQixDQUFuQjs7QUFDQSxVQUFJSSxnQkFBRUMsTUFBRixDQUFTSCxZQUFULENBQUosRUFBNEI7QUFDMUIsY0FBTSxJQUFJSSx5QkFBT0MsWUFBWCxDQUF5Qix1REFBc0RQLEVBQUcsR0FBbEYsQ0FBTjtBQUNELE9BRkQsTUFFTztBQUNMLHFCQUFhLEtBQUtRLFdBQUwsQ0FBaUIscUJBQWpCLEVBQXdDLENBQUNOLFlBQUQsRUFBZUgsU0FBZixDQUF4QyxDQUFiO0FBQ0Q7QUFDRixLQVBELE1BT087QUFDTCxVQUFJQSxTQUFTLEtBQUssYUFBbEIsRUFBaUM7QUFDL0IscUJBQWEsS0FBS1UscUJBQUwsQ0FBMkJULEVBQTNCLENBQWI7QUFDRDs7QUFDRCxVQUFJSSxnQkFBRU0sUUFBRixDQUFXLENBQUMsT0FBRCxFQUFVLE1BQVYsRUFBa0IsT0FBbEIsRUFBMkIsUUFBM0IsRUFBcUMsTUFBckMsQ0FBWCxFQUF5RFgsU0FBekQsQ0FBSixFQUF5RTtBQUN2RSxZQUFJWSxPQUFPLEdBQUksa0JBQWlCWCxFQUFHLE1BQUtELFNBQVUsSUFBbEQ7QUFDQSxxQkFBYSxLQUFLYSxZQUFMLENBQWtCQyxXQUFsQixDQUE4QkYsT0FBOUIsQ0FBYjtBQUNELE9BSEQsTUFHTztBQUNMLGNBQU0sSUFBSUwseUJBQU9RLG1CQUFYLENBQWdDLHlDQUF3Q2YsU0FBVSxHQUFsRixDQUFOO0FBQ0Q7QUFDRjtBQUNGLEdBcEJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQXNCQUosUUFBUSxDQUFDb0IsS0FBVDtBQUFBLDhDQUFpQixXQUFnQmYsRUFBaEIsRUFBb0I7QUFDbkNBLElBQUFBLEVBQUUsR0FBRyxxQkFBU0EsRUFBVCxDQUFMOztBQUNBLFFBQUksS0FBS0MsWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFVBQUlDLFlBQVksR0FBRyxLQUFLYyxlQUFMLENBQXFCaEIsRUFBckIsQ0FBbkI7QUFDQSxZQUFNLEtBQUtRLFdBQUwsQ0FBaUIsT0FBakIsRUFBMEIsQ0FBQ04sWUFBRCxDQUExQixDQUFOO0FBQ0QsS0FIRCxNQUdPO0FBQ0wsVUFBSVMsT0FBTyxHQUFJLGtCQUFpQlgsRUFBRyxpQkFBbkM7QUFDQSxZQUFNLEtBQUtZLFlBQUwsQ0FBa0JDLFdBQWxCLENBQThCRixPQUE5QixDQUFOO0FBQ0Q7QUFDRixHQVREOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVdBaEIsUUFBUSxDQUFDc0IsaUJBQVQ7QUFBQSw4Q0FBNkIsV0FBZ0JDLEtBQWhCLEVBQXVCbEIsRUFBdkIsRUFBMkI7QUFDdERBLElBQUFBLEVBQUUsR0FBRyxxQkFBU0EsRUFBVCxDQUFMO0FBQ0FrQixJQUFBQSxLQUFLLEdBQUdDLG9CQUFLQyxrQkFBTCxDQUF3QkYsS0FBeEIsRUFBK0IsR0FBL0IsQ0FBUjtBQUNBLFFBQUlQLE9BQU8sR0FBSSxrQkFBaUJYLEVBQUcsZ0JBQWVrQixLQUFNLElBQXhEO0FBQ0EsVUFBTSxLQUFLTixZQUFMLENBQWtCQyxXQUFsQixDQUE4QkYsT0FBOUIsQ0FBTjtBQUNELEdBTEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBT0FoQixRQUFRLENBQUMwQixRQUFUO0FBQUEsOENBQW9CLFdBQWdCSCxLQUFoQixFQUF1QmxCLEVBQXZCLEVBQTJCO0FBQzdDQSxJQUFBQSxFQUFFLEdBQUcscUJBQVNBLEVBQVQsQ0FBTDs7QUFDQSxRQUFJLEtBQUtDLFlBQUwsRUFBSixFQUF5QjtBQUN2QixVQUFJQyxZQUFZLEdBQUcsS0FBS2MsZUFBTCxDQUFxQmhCLEVBQXJCLENBQW5CO0FBQ0EsWUFBTSxLQUFLUSxXQUFMLENBQWlCLE9BQWpCLEVBQTBCLENBQUNOLFlBQUQsQ0FBMUIsQ0FBTjtBQUNBLFlBQU0sS0FBS00sV0FBTCxDQUFpQixNQUFqQixFQUF5QixDQUFDTixZQUFELEVBQWVnQixLQUFmLENBQXpCLENBQU47QUFDRCxLQUpELE1BSU87QUFDTCxVQUFJQSxLQUFLLFlBQVlJLEtBQXJCLEVBQTRCO0FBQzFCSixRQUFBQSxLQUFLLEdBQUdBLEtBQUssQ0FBQ0ssSUFBTixDQUFXLEVBQVgsQ0FBUjtBQUNEOztBQUNELFVBQUksT0FBT0wsS0FBUCxLQUFpQixRQUFyQixFQUErQjtBQUM3QkEsUUFBQUEsS0FBSyxHQUFHQSxLQUFLLENBQUNNLFFBQU4sRUFBUjtBQUNEOztBQUNETixNQUFBQSxLQUFLLEdBQUdDLG9CQUFLQyxrQkFBTCxDQUF3QkYsS0FBeEIsRUFBK0IsR0FBL0IsQ0FBUjtBQUVBQSxNQUFBQSxLQUFLLEdBQUdBLEtBQUssQ0FBQ08sT0FBTixDQUFjLFFBQWQsRUFBd0IsS0FBeEIsQ0FBUjs7QUFDQSxVQUFJLEtBQUtDLElBQUwsQ0FBVUMsUUFBZCxFQUF3QjtBQUNaLGNBQU0sSUFBSXJCLHlCQUFPc0Isc0JBQVgsRUFBTjtBQUNYLE9BRkQsTUFFTztBQUNMLFlBQUlqQixPQUFPLEdBQUksa0JBQWlCWCxFQUFHLHNCQUFxQmtCLEtBQU0sSUFBOUQ7QUFDQSxjQUFNLEtBQUtOLFlBQUwsQ0FBa0JDLFdBQWxCLENBQThCRixPQUE5QixDQUFOO0FBQ0Q7QUFDRjtBQUNGLEdBdkJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQXlCQWhCLFFBQVEsQ0FBQ2tDLE9BQVQ7QUFBQSw4Q0FBbUIsV0FBZ0I3QixFQUFoQixFQUFvQjtBQUNyQ0EsSUFBQUEsRUFBRSxHQUFHLHFCQUFTQSxFQUFULENBQUw7O0FBQ0EsUUFBSSxLQUFLQyxZQUFMLEVBQUosRUFBeUI7QUFDdkIsVUFBSUMsWUFBWSxHQUFHLEtBQUtjLGVBQUwsQ0FBcUJoQixFQUFyQixDQUFuQjtBQUNBLG1CQUFhLEtBQUtRLFdBQUwsQ0FBaUIsVUFBakIsRUFBNkIsQ0FBQ04sWUFBRCxDQUE3QixDQUFiO0FBQ0QsS0FIRCxNQUdPO0FBQ0wsVUFBSVMsT0FBTyxHQUFJLGtCQUFpQlgsRUFBRyxXQUFuQztBQUNBLFVBQUk4QixHQUFHLFNBQVMsS0FBS2xCLFlBQUwsQ0FBa0JDLFdBQWxCLENBQThCRixPQUE5QixDQUFoQjtBQUVBbUIsTUFBQUEsR0FBRyxHQUFHQSxHQUFHLEdBQUdBLEdBQUcsQ0FBQ04sUUFBSixFQUFILEdBQW9CLEVBQTdCO0FBQ0EsYUFBT00sR0FBUDtBQUNEO0FBQ0YsR0FaRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFjQW5DLFFBQVEsQ0FBQ29DLGdCQUFUO0FBQUEsOENBQTRCLFdBQWdCL0IsRUFBaEIsRUFBb0I7QUFDOUNBLElBQUFBLEVBQUUsR0FBRyxxQkFBU0EsRUFBVCxDQUFMOztBQUNBLFFBQUksS0FBS0MsWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFVBQUlDLFlBQVksR0FBRyxLQUFLYyxlQUFMLENBQXFCaEIsRUFBckIsQ0FBbkI7QUFDQSxtQkFBYSxLQUFLUSxXQUFMLENBQWlCLGNBQWpCLEVBQWlDLENBQUNOLFlBQUQsQ0FBakMsQ0FBYjtBQUNELEtBSEQsTUFHTztBQUNMLFVBQUlTLE9BQU8sR0FBSSxrQkFBaUJYLEVBQUcsa0JBQW5DO0FBQ0EsbUJBQWEsS0FBS1ksWUFBTCxDQUFrQkMsV0FBbEIsQ0FBOEJGLE9BQTlCLENBQWI7QUFDRDtBQUNGLEdBVEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBV0FoQixRQUFRLENBQUNxQyxjQUFUO0FBQUEsOENBQTBCLFdBQWdCaEMsRUFBaEIsRUFBb0I7QUFDNUNBLElBQUFBLEVBQUUsR0FBRyxxQkFBU0EsRUFBVCxDQUFMOztBQUNBLFFBQUksS0FBS0MsWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFVBQUlDLFlBQVksR0FBRyxLQUFLYyxlQUFMLENBQXFCaEIsRUFBckIsQ0FBbkI7QUFDQSxtQkFBYSxLQUFLUSxXQUFMLENBQWlCLFlBQWpCLEVBQStCLENBQUNOLFlBQUQsQ0FBL0IsQ0FBYjtBQUNELEtBSEQsTUFHTztBQUNMLFVBQUlTLE9BQU8sR0FBSSxrQkFBaUJYLEVBQUcsc0JBQW5DO0FBQ0EsbUJBQWEsS0FBS1ksWUFBTCxDQUFrQkMsV0FBbEIsQ0FBOEJGLE9BQTlCLENBQWI7QUFDRDtBQUNGLEdBVEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBV0FoQixRQUFRLENBQUNzQyxlQUFUO0FBQUEsOENBQTJCLFdBQWdCakMsRUFBaEIsRUFBb0I7QUFDN0NBLElBQUFBLEVBQUUsR0FBRyxxQkFBU0EsRUFBVCxDQUFMOztBQUNBLFFBQUksS0FBS0MsWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFVBQUlDLFlBQVksR0FBRyxLQUFLYyxlQUFMLENBQXFCaEIsRUFBckIsQ0FBbkI7QUFDQSxtQkFBYSxLQUFLUSxXQUFMLENBQWlCLGFBQWpCLEVBQWdDLENBQUNOLFlBQUQsQ0FBaEMsQ0FBYjtBQUNELEtBSEQsTUFHTztBQUNMLFVBQUlTLE9BQU8sR0FBSSxrQkFBaUJYLEVBQUcsaUJBQW5DO0FBQ0EsbUJBQWEsS0FBS1ksWUFBTCxDQUFrQkMsV0FBbEIsQ0FBOEJGLE9BQTlCLENBQWI7QUFDRDtBQUNGLEdBVEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBV0FoQixRQUFRLENBQUN1QyxPQUFUO0FBQUEsOENBQW1CLFdBQWdCbEMsRUFBaEIsRUFBb0I7QUFDckNBLElBQUFBLEVBQUUsR0FBRyxxQkFBU0EsRUFBVCxDQUFMOztBQUNBLFFBQUksS0FBS0MsWUFBTCxFQUFKLEVBQXlCO0FBQ3ZCLFVBQUlDLFlBQVksR0FBRyxLQUFLYyxlQUFMLENBQXFCaEIsRUFBckIsQ0FBbkI7QUFDQSxVQUFJbUMsTUFBTSxHQUFHLDJDQUFiO0FBQ0EsbUJBQWEsS0FBSzNCLFdBQUwsQ0FBaUIsZ0JBQWpCLEVBQW1DLENBQUMyQixNQUFELEVBQVMsQ0FBQ2pDLFlBQUQsQ0FBVCxDQUFuQyxDQUFiO0FBQ0QsS0FKRCxNQUlPO0FBQ0wsVUFBSVMsT0FBTyxHQUFJLGtCQUFpQlgsRUFBRyxXQUFuQztBQUNBLG1CQUFhLEtBQUtZLFlBQUwsQ0FBa0JDLFdBQWxCLENBQThCRixPQUE5QixDQUFiO0FBQ0Q7QUFDRixHQVZEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVlBaEIsUUFBUSxDQUFDeUMsV0FBVDtBQUFBLCtDQUF1QixXQUFnQnBDLEVBQWhCLEVBQW9CO0FBQ3pDQSxJQUFBQSxFQUFFLEdBQUcscUJBQVNBLEVBQVQsQ0FBTDs7QUFDQSxRQUFJLEtBQUtDLFlBQUwsRUFBSixFQUF5QjtBQUN2QixVQUFJQyxZQUFZLFNBQVMsS0FBS2MsZUFBTCxDQUFxQmhCLEVBQXJCLENBQXpCO0FBQ0EsbUJBQWEsS0FBS1EsV0FBTCxDQUFpQiwwQkFBakIsRUFBNkMsQ0FBQ04sWUFBRCxDQUE3QyxDQUFiO0FBQ0QsS0FIRCxNQUdPO0FBQ0wsVUFBSVMsT0FBTyxHQUFJLGtCQUFpQlgsRUFBRyx5QkFBbkM7QUFDQSxtQkFBYSxLQUFLWSxZQUFMLENBQWtCQyxXQUFsQixDQUE4QkYsT0FBOUIsQ0FBYjtBQUNEO0FBQ0YsR0FURDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFXQWhCLFFBQVEsQ0FBQzBDLGlCQUFUO0FBQUEsK0NBQTZCLFdBQWdCckMsRUFBaEIsRUFBb0I7QUFDL0MsaUJBQWEsS0FBS29DLFdBQUwsQ0FBaUJwQyxFQUFqQixDQUFiO0FBQ0QsR0FGRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFJQUwsUUFBUSxDQUFDMkMsT0FBVDtBQUFBLCtDQUFtQixXQUFnQnRDLEVBQWhCLEVBQW9CO0FBQ3JDQSxJQUFBQSxFQUFFLEdBQUcscUJBQVNBLEVBQVQsQ0FBTDs7QUFDQSxRQUFJLEtBQUtDLFlBQUwsRUFBSixFQUF5QjtBQUN2QixVQUFJQyxZQUFZLEdBQUcsS0FBS0MsZUFBTCxDQUFxQkgsRUFBckIsQ0FBbkI7O0FBQ0EsVUFBSUUsWUFBWSxLQUFLLElBQXJCLEVBQTJCO0FBQ3pCLGNBQU0sSUFBSUkseUJBQU9DLFlBQVgsQ0FBeUIsdURBQXNEUCxFQUFHLEdBQWxGLENBQU47QUFDRCxPQUZELE1BRU87QUFDTCxxQkFBYSxLQUFLUSxXQUFMLENBQWlCLFVBQWpCLEVBQTZCLENBQUNOLFlBQUQsQ0FBN0IsQ0FBYjtBQUNEO0FBQ0YsS0FQRCxNQU9PO0FBQ0wsVUFBSVMsT0FBTyxHQUFJLGtCQUFpQlgsRUFBRyxxQkFBbkM7QUFDQSxtQkFBYSxLQUFLWSxZQUFMLENBQWtCQyxXQUFsQixDQUE4QkYsT0FBOUIsQ0FBYjtBQUNEO0FBQ0YsR0FiRDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFlQWhCLFFBQVEsQ0FBQ2MscUJBQVQ7QUFBQSwrQ0FBaUMsV0FBZ0JULEVBQWhCLEVBQW9CO0FBQ25EQSxJQUFBQSxFQUFFLEdBQUcscUJBQVNBLEVBQVQsQ0FBTDtBQUNBLFVBQU1XLE9BQU8sR0FBSSxrQkFBaUJYLEVBQUcsMEJBQXJDO0FBQ0EsVUFBTXVDLE1BQU0sU0FBUyxLQUFLM0IsWUFBTCxDQUFrQkMsV0FBbEIsQ0FBOEJGLE9BQTlCLENBQXJCO0FBQ0EsVUFBTTZCLElBQUksU0FBUyxLQUFLTixPQUFMLENBQWFsQyxFQUFiLENBQW5CO0FBRUEsUUFBSXlDLGFBQWEsR0FBRyxDQUFwQjs7QUFDQSxZQUFRRCxJQUFSO0FBQ0UsV0FBSyxjQUFMO0FBQXFCO0FBQ25CLGdCQUFNRSxpQkFBaUIsR0FBR3RDLGdCQUFFdUMsS0FBRixDQUFRSixNQUFSLENBQTFCOztBQUNBLGdCQUFNSyxnQkFBZ0IsR0FBR3hDLGdCQUFFeUMsSUFBRixDQUFPTixNQUFQLENBQXpCOztBQUNBRSxVQUFBQSxhQUFhLEdBQUdHLGdCQUFnQixDQUFDRSxNQUFqQixDQUF3QkMsQ0FBeEIsR0FBNEJILGdCQUFnQixDQUFDSSxJQUFqQixDQUFzQkMsTUFBbEQsR0FBMkRQLGlCQUFpQixDQUFDSSxNQUFsQixDQUF5QkMsQ0FBcEc7QUFDQTtBQUNEOztBQUNELFdBQUssbUJBQUw7QUFBMEI7QUFDeEIsY0FBSUwsaUJBQWlCLEdBQUd0QyxnQkFBRXVDLEtBQUYsQ0FBUUosTUFBUixDQUF4Qjs7QUFDQSxjQUFJVyxhQUFhLEdBQUcsQ0FBcEI7QUFGd0I7QUFBQTtBQUFBOztBQUFBO0FBS3hCLGlDQUF5QlgsTUFBTSxDQUFDWSxPQUFQLEVBQXpCLDhIQUEyQztBQUFBO0FBQUEsb0JBQS9CQyxDQUErQjtBQUFBLG9CQUE1QkMsS0FBNEI7O0FBQ3pDLGtCQUFJQSxLQUFLLENBQUNQLE1BQU4sQ0FBYUMsQ0FBYixLQUFtQkwsaUJBQWlCLENBQUNJLE1BQWxCLENBQXlCQyxDQUFoRCxFQUFtRDtBQUNqREcsZ0JBQUFBLGFBQWEsR0FBR0UsQ0FBaEI7QUFDQTtBQUNEO0FBQ0Y7QUFWdUI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFZeEIsZ0JBQU1FLG9CQUFvQixHQUFHZixNQUFNLENBQUNXLGFBQUQsQ0FBTixDQUFzQkosTUFBdEIsQ0FBNkJDLENBQTdCLEdBQWlDUixNQUFNLENBQUNXLGFBQWEsR0FBRyxDQUFqQixDQUFOLENBQTBCSixNQUExQixDQUFpQ0MsQ0FBbEUsR0FBc0VSLE1BQU0sQ0FBQ1csYUFBYSxHQUFHLENBQWpCLENBQU4sQ0FBMEJGLElBQTFCLENBQStCQyxNQUFsSTtBQUNBLGdCQUFNTSxZQUFZLEdBQUdDLElBQUksQ0FBQ0MsSUFBTCxDQUFVbEIsTUFBTSxDQUFDbUIsTUFBUCxHQUFnQlIsYUFBMUIsQ0FBckI7QUFHQVQsVUFBQUEsYUFBYSxHQUFHYyxZQUFZLEdBQUdiLGlCQUFpQixDQUFDTSxJQUFsQixDQUF1QkMsTUFBdEMsR0FBK0NLLG9CQUFvQixJQUFJQyxZQUFZLEdBQUcsQ0FBbkIsQ0FBbkY7QUFDQTtBQUNEOztBQUNEO0FBQVM7QUFFUCxpQkFBTyxJQUFQO0FBQ0Q7QUE3Qkg7O0FBZ0NBLFVBQU1QLElBQUksU0FBUyxLQUFLVixPQUFMLENBQWF0QyxFQUFiLENBQW5CO0FBQ0EsVUFBTTJELFlBQVksU0FBUyxLQUFLdEIsaUJBQUwsQ0FBdUJyQyxFQUF2QixDQUEzQjtBQUVBLFdBQU80RCxJQUFJLENBQUNDLFNBQUwsQ0FBZTtBQUNwQkMsTUFBQUEsS0FBSyxFQUFFZCxJQUFJLENBQUNjLEtBRFE7QUFFcEJiLE1BQUFBLE1BQU0sRUFBRUQsSUFBSSxDQUFDQyxNQUZPO0FBR3BCYyxNQUFBQSxHQUFHLEVBQUVKLFlBQVksQ0FBQ1osQ0FIRTtBQUlwQmlCLE1BQUFBLElBQUksRUFBRUwsWUFBWSxDQUFDTSxDQUpDO0FBS3BCQyxNQUFBQSxnQkFBZ0IsRUFBRXpCO0FBTEUsS0FBZixDQUFQO0FBT0QsR0FqREQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBbURBMEIsTUFBTSxDQUFDQyxNQUFQLENBQWN2RSxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHVud3JhcEVsIH0gZnJvbSAnLi4vdXRpbHMnO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmdldEF0dHJpYnV0ZSA9IGFzeW5jIGZ1bmN0aW9uIChhdHRyaWJ1dGUsIGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLmdldEF0b21zRWxlbWVudChlbCk7XG4gICAgaWYgKF8uaXNOdWxsKGF0b21zRWxlbWVudCkpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKGBFcnJvciBjb252ZXJ0aW5nIGVsZW1lbnQgSUQgZm9yIHVzaW5nIGluIFdEIGF0b21zOiAnJHtlbH0nYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfYXR0cmlidXRlX3ZhbHVlJywgW2F0b21zRWxlbWVudCwgYXR0cmlidXRlXSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGlmIChhdHRyaWJ1dGUgPT09ICdjb250ZW50U2l6ZScpIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldEVsZW1lbnRDb250ZW50U2l6ZShlbCk7XG4gICAgfVxuICAgIGlmIChfLmluY2x1ZGVzKFsnbGFiZWwnLCAnbmFtZScsICd2YWx1ZScsICd2YWx1ZXMnLCAnaGludCddLCBhdHRyaWJ1dGUpKSB7XG4gICAgICBsZXQgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLiR7YXR0cmlidXRlfSgpYDtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKGBVSUFFbGVtZW50cyBkb24ndCBoYXZlIHRoZSBhdHRyaWJ1dGUgJyR7YXR0cmlidXRlfSdgKTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbW1hbmRzLmNsZWFyID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xlYXInLCBbYXRvbXNFbGVtZW50XSk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5zZXRWYWx1ZSgnJylgO1xuICAgIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICB9XG59O1xuXG5jb21tYW5kcy5zZXRWYWx1ZUltbWVkaWF0ZSA9IGFzeW5jIGZ1bmN0aW9uICh2YWx1ZSwgZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIHZhbHVlID0gdXRpbC5lc2NhcGVTcGVjaWFsQ2hhcnModmFsdWUsIFwiJ1wiKTtcbiAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5zZXRWYWx1ZSgnJHt2YWx1ZX0nKWA7XG4gIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWUgPSBhc3luYyBmdW5jdGlvbiAodmFsdWUsIGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xpY2snLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgndHlwZScsIFthdG9tc0VsZW1lbnQsIHZhbHVlXSk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUuam9pbihcIlwiKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgdmFsdWUgPSB1dGlsLmVzY2FwZVNwZWNpYWxDaGFycyh2YWx1ZSwgXCInXCIpO1xuICAgIC8vIGRlLWVzY2FwZSBcXG4gc28gaXQgY2FuIGJlIHVzZWQgc3BlY2lhbGx5XG4gICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXFxcXFxcXG4vZywgXCJcXFxcblwiKTtcbiAgICBpZiAodGhpcy5vcHRzLnVzZVJvYm90KSB7XG4gICAgICAvKiBUT0RPICovdGhyb3cgbmV3IGVycm9ycy5Ob3RZZXRJbXBsZW1lbnRlZEVycm9yKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9Jykuc2V0VmFsdWVCeVR5cGUoJyR7dmFsdWV9JylgO1xuICAgICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gICAgfVxuICB9XG59O1xuXG5jb21tYW5kcy5nZXRUZXh0ID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF90ZXh0JywgW2F0b21zRWxlbWVudF0pO1xuICB9IGVsc2Uge1xuICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykudGV4dCgpYDtcbiAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gICAgLy8gaW4gc29tZSBjYXNlcyBpbnN0cnVtZW50cyByZXR1cm5zIGluIGludGVnZXIuIHdlIG9ubHkgd2FudCBhIHN0cmluZ1xuICAgIHJlcyA9IHJlcyA/IHJlcy50b1N0cmluZygpIDogJyc7XG4gICAgcmV0dXJuIHJlcztcbiAgfVxufTtcblxuY29tbWFuZHMuZWxlbWVudERpc3BsYXllZCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdpc19kaXNwbGF5ZWQnLCBbYXRvbXNFbGVtZW50XSk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5pc0Rpc3BsYXllZCgpYDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRFbmFibGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2lzX2VuYWJsZWQnLCBbYXRvbXNFbGVtZW50XSk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5pc0VuYWJsZWQoKSA9PT0gMWA7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICB9XG59O1xuXG5jb21tYW5kcy5lbGVtZW50U2VsZWN0ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnaXNfc2VsZWN0ZWQnLCBbYXRvbXNFbGVtZW50XSk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5pc1NlbGVjdGVkKClgO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0TmFtZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIGxldCBzY3JpcHQgPSAncmV0dXJuIGFyZ3VtZW50c1swXS50YWdOYW1lLnRvTG93ZXJDYXNlKCknO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtzY3JpcHQsIFthdG9tc0VsZW1lbnRdXSk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS50eXBlKClgO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IGF3YWl0IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3RvcF9sZWZ0X2Nvb3JkaW5hdGVzJywgW2F0b21zRWxlbWVudF0pO1xuICB9IGVsc2Uge1xuICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykuZ2V0RWxlbWVudExvY2F0aW9uKClgO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb25JblZpZXcgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TG9jYXRpb24oZWwpO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy5nZXRBdG9tc0VsZW1lbnQoZWwpO1xuICAgIGlmIChhdG9tc0VsZW1lbnQgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKGBFcnJvciBjb252ZXJ0aW5nIGVsZW1lbnQgSUQgZm9yIHVzaW5nIGluIFdEIGF0b21zOiAnJHtlbH0nYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfc2l6ZScsIFthdG9tc0VsZW1lbnRdKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5nZXRFbGVtZW50U2l6ZSgpYDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldEVsZW1lbnRDb250ZW50U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgY29uc3QgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLmNoaWxkRWxlbWVudHNGcmFtZXMoKWA7XG4gIGNvbnN0IGZyYW1lcyA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICBjb25zdCB0eXBlID0gYXdhaXQgdGhpcy5nZXROYW1lKGVsKTtcblxuICBsZXQgY29udGVudEhlaWdodCA9IDA7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgXCJVSUFUYWJsZVZpZXdcIjoge1xuICAgICAgY29uc3QgZmlyc3RFbGVtZW50RnJhbWUgPSBfLmZpcnN0KGZyYW1lcyk7XG4gICAgICBjb25zdCBsYXN0RWxlbWVudEZyYW1lID0gXy5sYXN0KGZyYW1lcyk7XG4gICAgICBjb250ZW50SGVpZ2h0ID0gbGFzdEVsZW1lbnRGcmFtZS5vcmlnaW4ueSArIGxhc3RFbGVtZW50RnJhbWUuc2l6ZS5oZWlnaHQgLSBmaXJzdEVsZW1lbnRGcmFtZS5vcmlnaW4ueTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwiVUlBQ29sbGVjdGlvblZpZXdcIjoge1xuICAgICAgbGV0IGZpcnN0RWxlbWVudEZyYW1lID0gXy5maXJzdChmcmFtZXMpO1xuICAgICAgbGV0IGVsZW1lbnRzSW5Sb3cgPSAwO1xuXG4gICAgICAvLyBHZXQgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGEgcm93XG4gICAgICBmb3IgKGNvbnN0IFtpLCBmcmFtZV0gb2YgZnJhbWVzLmVudHJpZXMoKSkge1xuICAgICAgICBpZiAoZnJhbWUub3JpZ2luLnkgIT09IGZpcnN0RWxlbWVudEZyYW1lLm9yaWdpbi55KSB7XG4gICAgICAgICAgZWxlbWVudHNJblJvdyA9IGk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3BhY2VCZXR3ZWVuRWxlbWVudHMgPSBmcmFtZXNbZWxlbWVudHNJblJvd10ub3JpZ2luLnkgLSBmcmFtZXNbZWxlbWVudHNJblJvdyAtIDFdLm9yaWdpbi55IC0gZnJhbWVzW2VsZW1lbnRzSW5Sb3cgLSAxXS5zaXplLmhlaWdodDtcbiAgICAgIGNvbnN0IG51bWJlck9mUm93cyA9IE1hdGguY2VpbChmcmFtZXMubGVuZ3RoIC8gZWxlbWVudHNJblJvdyk7XG5cbiAgICAgIC8vIEFzc3VtZSB0aGF0IGFsbCBjZWxscyBhcmUgb2YgdGhlIHNhbWUgc2l6ZVxuICAgICAgY29udGVudEhlaWdodCA9IG51bWJlck9mUm93cyAqIGZpcnN0RWxlbWVudEZyYW1lLnNpemUuaGVpZ2h0ICsgc3BhY2VCZXR3ZWVuRWxlbWVudHMgKiAobnVtYmVyT2ZSb3dzIC0gMSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgLy8gVGhpcyBtZXRob2QgY2FsY3VsYXRlcyBjb250ZW50IHNpemUgb25seSBmb3IgVUlBVGFibGVWaWV3IGFuZCBVSUFDb2xsZWN0aW9uVmlldy4gVUlBV2ViVmlldyBpcyBjb21taW5nIHNvb24uXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBjb25zdCBzaXplID0gYXdhaXQgdGhpcy5nZXRTaXplKGVsKTtcbiAgY29uc3QgdG9wTGVmdENvb3JkID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbkluVmlldyhlbCk7XG5cbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHtcbiAgICB3aWR0aDogc2l6ZS53aWR0aCxcbiAgICBoZWlnaHQ6IHNpemUuaGVpZ2h0LFxuICAgIHRvcDogdG9wTGVmdENvb3JkLnksXG4gICAgbGVmdDogdG9wTGVmdENvb3JkLngsXG4gICAgc2Nyb2xsYWJsZU9mZnNldDogY29udGVudEhlaWdodFxuICB9KTtcbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
