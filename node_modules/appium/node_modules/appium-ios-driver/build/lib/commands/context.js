"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WEBVIEW_BASE = exports.WEBVIEW_WIN = exports.NATIVE_WIN = exports.helpers = exports.commands = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncbox = require("asyncbox");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));

var _appiumBaseDriver = require("appium-base-driver");

var _logger = _interopRequireDefault(require("../logger"));

var _appiumSupport = require("appium-support");

const NATIVE_WIN = 'NATIVE_APP';
exports.NATIVE_WIN = NATIVE_WIN;
const WEBVIEW_WIN = 'WEBVIEW';
exports.WEBVIEW_WIN = WEBVIEW_WIN;
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
exports.WEBVIEW_BASE = WEBVIEW_BASE;
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;
commands.getCurrentContext = (0, _asyncToGenerator2.default)(function* () {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  } else {
    return NATIVE_WIN;
  }
});
commands.getContexts = (0, _asyncToGenerator2.default)(function* () {
  _logger.default.debug('Getting list of available contexts');

  let contexts = yield this.getContextsAndViews(false);

  let mapFn = context => context.id.toString();

  if (this.opts.fullContextList) {
    mapFn = context => {
      return {
        id: context.id.toString(),
        title: context.view.title,
        url: context.view.url
      };
    };
  }

  return contexts.map(mapFn);
});

commands.setContext = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (name, callback, skipReadyCheck) {
    function alreadyInContext(desired, current) {
      return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
    }

    _logger.default.debug(`Attempting to set context to '${name}'`);

    if (alreadyInContext(name, this.curContext)) {} else if (name === NATIVE_WIN || name === null) {
      this.curContext = null;

      if (this.isRealDevice()) {
        this.remote.disconnect();
      }
    } else {
      if (_lodash.default.isUndefined(this.contexts)) {
        yield this.getContexts();
      }

      let contextId = name.replace(WEBVIEW_BASE, '');

      if (contextId === '') {
        contextId = this.contexts[1];
      }

      if (!_lodash.default.includes(this.contexts, contextId)) {
        throw new _appiumBaseDriver.errors.NoSuchContextError();
      }

      if (this.isRealDevice()) {
        if (this.remote) {
          yield this.remote.disconnect();
        }

        this.curContext = contextId;
        yield this.remote.connect(contextId);
      } else {
        let _$map = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10)),
            _$map2 = (0, _slicedToArray2.default)(_$map, 2),
            appIdKey = _$map2[0],
            pageIdKey = _$map2[1];

        yield this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
        this.curContext = contextId;
      }
    }

    if (this.opts.enablePerformanceLogging && this.remote) {
      _logger.default.debug(`Starting performance log on '${this.curContext}'`);

      this.logs.performance = new _iosPerformanceLog.default(this.remote);
      yield this.logs.performance.startCapture();
    }
  });

  return function (_x, _x2, _x3) {
    return _ref3.apply(this, arguments);
  };
}();

commands.getWindowHandle = (0, _asyncToGenerator2.default)(function* () {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  return this.curContext.toString();
});
commands.getWindowHandles = (0, _asyncToGenerator2.default)(function* () {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  this.windowHandleCache = yield this.listWebFrames(false);

  const idArray = _lodash.default.map(this.windowHandleCache, 'id');

  if (!this.contexts) {
    this.contexts = idArray;
  }

  return _lodash.default.map(idArray, id => id.toString());
});

commands.setWindow = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (name, skipReadyCheck) {
    if (!this.isWebContext()) {
      throw new _appiumBaseDriver.errors.NotImplementedError();
    }

    if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
      throw new _appiumBaseDriver.errors.NoSuchWindowError();
    }

    let pageIdKey = parseInt(name, 10);

    if (!this.isRealDevice()) {
      yield this.remote.selectPage(pageIdKey, skipReadyCheck);
      this.curContext = this.curWindowHandle = name;
    } else {
      if (name === this.curWindowHandle) {
        _logger.default.debug(`Remote debugger is already connected to window '${name}'`);
      } else if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
        throw new _appiumBaseDriver.errors.NoSuchWindowError();
      } else {
        yield this.remote.disconnect();
        this.curContext = this.curWindowHandle = name;
        yield this.remote.connect(name);
      }
    }
  });

  return function (_x4, _x5) {
    return _ref6.apply(this, arguments);
  };
}();

helpers.webContextIndex = function () {
  return this.curContext.replace(WEBVIEW_BASE, '') - 1;
};

extensions.initAutoWebview = (0, _asyncToGenerator2.default)(function* () {
  if (this.opts.autoWebview) {
    _logger.default.debug('Setting auto webview');

    yield this.navToInitialWebview(this);
  }
});

extensions.getContextsAndViews = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (useUrl = true) {
    _logger.default.debug('Retrieving contexts and views');

    let webviews = yield this.listWebFrames(useUrl);
    let ctxs = [{
      id: NATIVE_WIN,
      view: {}
    }];
    this.contexts = [NATIVE_WIN];
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = webviews[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let view = _step.value;
        ctxs.push({
          id: `${WEBVIEW_BASE}${view.id}`,
          view
        });
        this.contexts.push(view.id.toString());
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return ctxs;
  });

  return function () {
    return _ref8.apply(this, arguments);
  };
}();

extensions.getNewRemoteDebugger = (0, _asyncToGenerator2.default)(function* () {
  return new _appiumRemoteDebugger.RemoteDebugger({
    bundleId: this.opts.bundleId,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _appiumSupport.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : true
  });
});

extensions.listWebFrames = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (useUrl = true) {
    var _this = this;

    if (!this.opts.bundleId) {
      _logger.default.errorAndThrow('Cannot enter web frame without a bundle ID');
    }

    useUrl = useUrl && !!this.getCurrentUrl();

    _logger.default.debug(`Selecting by url: ${useUrl} ${useUrl ? `(expected url: '${this.getCurrentUrl()}')` : ''}`);

    let currentUrl = useUrl ? this.getCurrentUrl() : undefined;
    let pageArray;

    if (this.isRealDevice() && this.remote && this.opts.bundleId) {
      pageArray = yield this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
    } else if (this.remote && this.remote.appIdKey) {
      pageArray = yield this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    } else if (this.isRealDevice()) {
      try {
        this.remote = new _appiumRemoteDebugger.WebKitRemoteDebugger({
          port: this.opts.webkitDebugProxyPort,
          webkitResponseTimeout: this.opts.webkitResponseTimeout
        });
        pageArray = yield this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
      } catch (err) {
        if (!_lodash.default.includes(err.message, 'connect ECONNREFUSED')) throw err;

        _logger.default.warn('Attempted to get a list of webview contexts but could not connect to ' + 'ios-webkit-debug-proxy. If you expect to find webviews, please ensure ' + 'that the proxy is running and accessible');

        this.remote = null;
        pageArray = [];
      }
    } else {
      this.remote = yield this.getNewRemoteDebugger();
      let appInfo = yield this.remote.connect();

      if (!appInfo) {
        _logger.default.debug('Unable to connect to the remote debugger.');

        return [];
      }

      pageArray = yield this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
      this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
      this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
        if (!_lodash.default.isEmpty(this.curWebFrames)) {
          _logger.default.debug(`Clearing ${this.curWebFrames.length} frames: ${this.curWebFrames.join(', ')}`);
        }

        this.curWebFrames = [];
      });

      let tryClosingAlert = function () {
        var _ref11 = (0, _asyncToGenerator2.default)(function* () {
          let didDismiss = yield _this.closeAlertBeforeTest();

          if (!didDismiss) {
            throw new Error('Close alert failed. Retry.');
          }
        });

        return function tryClosingAlert() {
          return _ref11.apply(this, arguments);
        };
      }();

      try {
        yield (0, _asyncbox.retryInterval)(3, 4000, tryClosingAlert);
      } catch (err) {
        if (err.message !== 'Close alert failed. Retry.') {
          _logger.default.errorAndThrow(err);
        }
      }
    }

    if (pageArray.length === 0) {
      _logger.default.debug('No web frames found.');
    }

    return pageArray;
  });

  return function () {
    return _ref10.apply(this, arguments);
  };
}();

extensions.onPageChange = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (pageChangeNotification) {
    _logger.default.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

    if (this.selectingNewPage) {
      _logger.default.debug('We are in the middle of selecting a page, ignoring');

      return;
    }

    if (!this.remote || !this.remote.isConnected()) {
      _logger.default.debug('We have not yet connected, ignoring');

      return;
    }

    const appIdKey = pageChangeNotification.appIdKey,
          pageArray = pageChangeNotification.pageArray;
    let newIds = [];
    let newPages = [];
    let keyId = null;
    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = pageArray[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        const page = _step2.value;
        const id = page.id.toString();
        newIds.push(id);

        if (page.isKey) {
          keyId = id;
        }

        const contextId = `${appIdKey}.${id}`;

        if (!_lodash.default.includes(this.contexts, contextId)) {
          newPages.push(id);
          this.contexts.push(contextId);
        }
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    if (!keyId) {
      _logger.default.debug('No key id found. Choosing first id from page array');

      keyId = newIds[0] || null;
    }

    if (!_appiumSupport.util.hasValue(this.curContext)) {
      _logger.default.debug('We do not appear to have window set yet, ignoring');

      return;
    }

    const _this$curContext$spli = this.curContext.split('.'),
          _this$curContext$spli2 = (0, _slicedToArray2.default)(_this$curContext$spli, 2),
          curAppIdKey = _this$curContext$spli2[0],
          curPageIdKey = _this$curContext$spli2[1];

    if (curAppIdKey !== appIdKey) {
      _logger.default.debug('Page change not referring to currently selected app, ignoring.');

      return;
    }

    let newPage = null;

    if (newPages.length) {
      newPage = _lodash.default.last(newPages);

      _logger.default.debug(`We have new pages, selecting page '${newPage}'`);
    } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
      _logger.default.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

      if (!_appiumSupport.util.hasValue(keyId)) {
        _logger.default.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');

        this.setCurrentUrl(undefined);
        return;
      }

      _logger.default.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);

      this.curContext = `${appIdKey}.${keyId}`;
      newPage = keyId;
    } else {
      _logger.default.debug('Checking if page needs to load');

      const needsPageLoad = (() => {
        const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

        return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
      })();

      if (needsPageLoad) {
        _logger.default.debug('Page load needed. Loading...');

        yield this.remote.pageLoad();
      }

      _logger.default.debug('New page listing is same as old, doing nothing');
    }

    if (_appiumSupport.util.hasValue(this.curContext)) {
      let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

      let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

      if (page && page.url !== this.getCurrentUrl()) {
        _logger.default.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);

        this.setCurrentUrl(page.url);
      }
    }

    if (_appiumSupport.util.hasValue(newPage)) {
      this.selectingNewPage = true;
      yield this.remote.selectPage(appIdKey, parseInt(newPage, 10));
      this.selectingNewPage = false;
      this.curContext = `${appIdKey}.${newPage}`;
    }

    this.windowHandleCache = pageArray;
  });

  return function (_x6) {
    return _ref12.apply(this, arguments);
  };
}();

extensions.getLatestWebviewContextForTitle = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (regExp) {
    let contexts = yield this.getContextsAndViews();
    let matchingCtx;
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = contexts[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        let ctx = _step3.value;

        if (ctx.view && (ctx.view.title && ctx.view.title.match(regExp) || ctx.view.url && ctx.view.url.match(regExp))) {
          if (ctx.view.url !== 'about:blank') {
            matchingCtx = ctx;
          } else {
            if (parseFloat(this.iosSdkVersion) < 7 || parseFloat(this.iosSdkVersion) >= 9 || this.opts.platformVersion === '7.1' && this.opts.app && this.opts.app.toLowerCase() !== 'safari') {
              matchingCtx = ctx;
            }
          }

          break;
        }
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    return matchingCtx ? matchingCtx.id : undefined;
  });

  return function (_x7) {
    return _ref13.apply(this, arguments);
  };
}();

extensions.useNewSafari = function () {
  return parseFloat(this.iosSdkVersion) >= 8.1 && parseFloat(this.opts.platformVersion) >= 8.1 && !this.isRealDevice() && this.opts.safari;
};

extensions.navToInitialWebview = (0, _asyncToGenerator2.default)(function* () {
  let timeout = 0;

  if (this.isRealDevice()) {
    timeout = 3000;

    _logger.default.debug(`Waiting for ${timeout} ms before navigating to view.`);
  }

  yield _bluebird.default.delay(timeout);

  if (this.useNewSafari()) {
    yield this.typeAndNavToUrl();
  } else if (parseInt(this.iosSdkVersion, 10) >= 7 && !this.isRealDevice() && this.opts.safari) {
    yield this.navToViewThroughFavorites();
  } else {
    yield this.navToViewWithTitle(/.*/);
  }
});

function openNewPage() {
  return _openNewPage.apply(this, arguments);
}

function _openNewPage() {
  _openNewPage = (0, _asyncToGenerator2.default)(function* () {
    let newPageButton = yield this.findElement('xpath', "//UIAButton[contains(@name,'New page')]");
    yield this.nativeTap(newPageButton.ELEMENT);
  });
  return _openNewPage.apply(this, arguments);
}

extensions.typeAndNavToUrl = (0, _asyncToGenerator2.default)(function* () {
  var _this2 = this;

  let address = this.opts.address ? this.opts.address : '127.0.0.1';
  this.setCurrentUrl(this.caps.safariInitialUrl || `http://${address}:${this.opts.port}/welcome`);
  let tries = 0;
  const MAX_TRIES = 2;

  let navigate = function () {
    var _ref16 = (0, _asyncToGenerator2.default)(function* () {
      let oldImpWait = _this2.implicitWaitMs;
      _this2.implicitWaitMs = 7000;
      let el = yield (0, _asyncbox.retryInterval)(3, 1000, (0, _asyncToGenerator2.default)(function* () {
        return yield _this2.findElement('accessibility id', 'URL');
      }));
      _this2.implicitWaitMs = oldImpWait;

      try {
        yield _this2.nativeTap(el.ELEMENT);
      } catch (err) {
        if (_lodash.default.includes(err.message, 'could not be tapped')) {
          if (tries++ >= MAX_TRIES) throw err;
          yield openNewPage();
          return yield navigate();
        } else {
          throw err;
        }
      }

      try {
        let el = yield _this2.findElement('class name', 'UIATextField');
        yield _this2.setValueImmediate(_this2.getCurrentUrl(), el);
      } catch (err) {
        if (tries++ >= MAX_TRIES) throw err;
        return yield navigate();
      }

      try {
        el = yield _this2.findElement('accessibility id', 'Go');
        yield _this2.nativeTap(el.ELEMENT);
      } catch (err) {
        if (_lodash.default.includes(err.message, 'could not be tapped')) {
          _logger.default.error('Unable to submit URL because \'Go\' button could not be tapped. ' + 'Please make sure your keyboard is toggled on.');
        }

        throw err;
      }

      yield _this2.navToViewWithTitle(undefined, new RegExp(_this2.getCurrentUrl(), 'i'));
      yield _this2.remote.pageUnload();
    });

    return function navigate() {
      return _ref16.apply(this, arguments);
    };
  }();

  yield navigate();
});
extensions.navToViewThroughFavorites = (0, _asyncToGenerator2.default)(function* () {
  _logger.default.debug('We are on iOS7+ simulator: clicking apple button to get into a webview');

  let oldImpWait = this.implicitWaitMs;
  this.implicitWaitMs = 7000;
  let el;

  try {
    el = yield this.findElement('xpath', '//UIAScrollView[1]/UIAButton[1]');
  } catch (err) {
    let msg = 'Could not find button to click to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);

    this.implicitWaitMs = oldImpWait;
    return yield this.navToViewWithTitle(/.*/i);
  }

  this.implicitWaitMs = oldImpWait;

  try {
    yield this.nativeTap(el.ELEMENT);
  } catch (err) {
    let msg = 'Could not click button to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);
  }

  yield this.navToViewWithTitle(/apple/i);
});

extensions.navToViewWithTitle = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (titleRegex, urlRegExp) {
    var _this3 = this;

    _logger.default.debug('Navigating to most recently opened webview');

    let start = Date.now();
    let spinTime = 500;

    let spinHandles = function () {
      var _ref20 = (0, _asyncToGenerator2.default)(function* () {
        let res;

        try {
          res = yield _this3.getLatestWebviewContextForTitle(titleRegex || urlRegExp);
        } catch (err) {
          if (!err.message.includes('Could not connect to a valid app after')) {
            const error = new Error(`Could not navigate to webview! Err: ${err.message}`);
            error.stack += `\nCaused by: ${err.stack}`;
            throw error;
          }

          _logger.default.debug('Could not navigate to webview. Retrying if possible.');
        }

        if (res) {
          let latestWindow = res;

          _logger.default.debug(`Picking webview '${latestWindow}'`);

          yield _this3.setContext(latestWindow);
          yield _this3.remote.cancelPageLoad();
          return;
        }

        if (Date.now() - start >= 90000) {
          throw new Error('Could not navigate to webview; there are none!');
        }

        _logger.default.warn("Could not find any webviews yet, refreshing/retrying");

        if (_this3.isRealDevice() || !_this3.opts.safari) {
          yield _bluebird.default.delay(spinTime);
          return yield spinHandles();
        }

        let element;

        try {
          _logger.default.debug('Finding and tapping reload button');

          element = yield _this3.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
          yield _this3.nativeTap(element.ELEMENT);
        } catch (err) {
          _logger.default.warn(`Error finding and tapping reload button: ${err.message}`);

          _logger.default.warn('Retrying.');

          yield _bluebird.default.delay(spinTime);
        }

        return yield spinHandles();
      });

      return function spinHandles() {
        return _ref20.apply(this, arguments);
      };
    }();

    yield spinHandles();
  });

  return function (_x8, _x9) {
    return _ref19.apply(this, arguments);
  };
}();

helpers.closeAlertBeforeTest = (0, _asyncToGenerator2.default)(function* () {
  let present = yield this.uiAutoClient.sendCommand('au.alertIsPresent()');

  if (!present) {
    return false;
  }

  _logger.default.debug('Alert present before starting test, let us banish it');

  yield this.uiAutoClient.sendCommand('au.dismissAlert()');

  _logger.default.debug('Alert banished!');

  return true;
});

helpers.stopRemote = function () {
  var _ref22 = (0, _asyncToGenerator2.default)(function* (closeWindowBeforeDisconnecting = false) {
    if (!this.remote) {
      _logger.default.errorAndThrow('Tried to leave a web frame but were not in one');
    }

    if (closeWindowBeforeDisconnecting) {
      yield this.closeWindow();
    }

    yield this.remote.disconnect();
    this.curContext = null;
    this.curWebFrames = [];
    this.curWebCoords = null;
    this.remote = null;
  });

  return function () {
    return _ref22.apply(this, arguments);
  };
}();

helpers.isWebContext = function () {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};

helpers.setCurrentUrl = function (url) {
  this._currentUrl = url;
};

helpers.getCurrentUrl = function () {
  return this._currentUrl;
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbIk5BVElWRV9XSU4iLCJXRUJWSUVXX1dJTiIsIldFQlZJRVdfQkFTRSIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0cyIsImxvZ2dlciIsImRlYnVnIiwiY29udGV4dHMiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwibWFwRm4iLCJjb250ZXh0IiwiaWQiLCJ0b1N0cmluZyIsIm9wdHMiLCJmdWxsQ29udGV4dExpc3QiLCJ0aXRsZSIsInZpZXciLCJ1cmwiLCJtYXAiLCJzZXRDb250ZXh0IiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc1JlYWxEZXZpY2UiLCJyZW1vdGUiLCJkaXNjb25uZWN0IiwiXyIsImlzVW5kZWZpbmVkIiwiY29udGV4dElkIiwicmVwbGFjZSIsImluY2x1ZGVzIiwiZXJyb3JzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwiY29ubmVjdCIsInNwbGl0IiwicGFyc2VJbnQiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsInNlbGVjdFBhZ2UiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsImdldFdpbmRvd0hhbmRsZSIsImlzV2ViQ29udGV4dCIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJnZXRXaW5kb3dIYW5kbGVzIiwid2luZG93SGFuZGxlQ2FjaGUiLCJsaXN0V2ViRnJhbWVzIiwiaWRBcnJheSIsInNldFdpbmRvdyIsIk5vU3VjaFdpbmRvd0Vycm9yIiwiY3VyV2luZG93SGFuZGxlIiwid2ViQ29udGV4dEluZGV4IiwiaW5pdEF1dG9XZWJ2aWV3IiwiYXV0b1dlYnZpZXciLCJuYXZUb0luaXRpYWxXZWJ2aWV3IiwidXNlVXJsIiwid2Vidmlld3MiLCJjdHhzIiwicHVzaCIsImdldE5ld1JlbW90ZURlYnVnZ2VyIiwiUmVtb3RlRGVidWdnZXIiLCJidW5kbGVJZCIsInVzZU5ld1NhZmFyaSIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJ1dGlsIiwiaGFzVmFsdWUiLCJzYWZhcmlHYXJiYWdlQ29sbGVjdCIsImVycm9yQW5kVGhyb3ciLCJnZXRDdXJyZW50VXJsIiwiY3VycmVudFVybCIsInVuZGVmaW5lZCIsInBhZ2VBcnJheSIsInBhZ2VBcnJheUZyb21Kc29uIiwiaWdub3JlQWJvdXRCbGFua1VybCIsInNlbGVjdEFwcCIsIndlYnZpZXdDb25uZWN0UmV0cmllcyIsIldlYktpdFJlbW90ZURlYnVnZ2VyIiwicG9ydCIsIndlYmtpdERlYnVnUHJveHlQb3J0Iiwid2Via2l0UmVzcG9uc2VUaW1lb3V0IiwiZXJyIiwibWVzc2FnZSIsIndhcm4iLCJhcHBJbmZvIiwib24iLCJFVkVOVF9QQUdFX0NIQU5HRSIsIm9uUGFnZUNoYW5nZSIsImJpbmQiLCJFVkVOVF9GUkFNRVNfREVUQUNIRUQiLCJpc0VtcHR5IiwiY3VyV2ViRnJhbWVzIiwibGVuZ3RoIiwiam9pbiIsInRyeUNsb3NpbmdBbGVydCIsImRpZERpc21pc3MiLCJjbG9zZUFsZXJ0QmVmb3JlVGVzdCIsIkVycm9yIiwicGFnZUNoYW5nZU5vdGlmaWNhdGlvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZWxlY3RpbmdOZXdQYWdlIiwiaXNDb25uZWN0ZWQiLCJuZXdJZHMiLCJuZXdQYWdlcyIsImtleUlkIiwicGFnZSIsImlzS2V5IiwiY3VyQXBwSWRLZXkiLCJjdXJQYWdlSWRLZXkiLCJuZXdQYWdlIiwibGFzdCIsImVycm9yIiwic2V0Q3VycmVudFVybCIsIm5lZWRzUGFnZUxvYWQiLCJjb250ZXh0QXJyYXkiLCJpc0VxdWFsIiwiZmluZCIsInBhZ2VMb2FkIiwiY3VycmVudFBhZ2VJZCIsInAiLCJnZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlIiwicmVnRXhwIiwibWF0Y2hpbmdDdHgiLCJjdHgiLCJtYXRjaCIsInBhcnNlRmxvYXQiLCJpb3NTZGtWZXJzaW9uIiwiYXBwIiwidG9Mb3dlckNhc2UiLCJzYWZhcmkiLCJ0aW1lb3V0IiwiQiIsImRlbGF5IiwidHlwZUFuZE5hdlRvVXJsIiwibmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcyIsIm5hdlRvVmlld1dpdGhUaXRsZSIsIm9wZW5OZXdQYWdlIiwibmV3UGFnZUJ1dHRvbiIsImZpbmRFbGVtZW50IiwibmF0aXZlVGFwIiwiRUxFTUVOVCIsImFkZHJlc3MiLCJjYXBzIiwic2FmYXJpSW5pdGlhbFVybCIsInRyaWVzIiwiTUFYX1RSSUVTIiwibmF2aWdhdGUiLCJvbGRJbXBXYWl0IiwiaW1wbGljaXRXYWl0TXMiLCJlbCIsInNldFZhbHVlSW1tZWRpYXRlIiwiUmVnRXhwIiwicGFnZVVubG9hZCIsIm1zZyIsInRpdGxlUmVnZXgiLCJ1cmxSZWdFeHAiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJzcGluVGltZSIsInNwaW5IYW5kbGVzIiwicmVzIiwic3RhY2siLCJsYXRlc3RXaW5kb3ciLCJjYW5jZWxQYWdlTG9hZCIsImVsZW1lbnQiLCJmaW5kVUlFbGVtZW50T3JFbGVtZW50cyIsInByZXNlbnQiLCJ1aUF1dG9DbGllbnQiLCJzZW5kQ29tbWFuZCIsInN0b3BSZW1vdGUiLCJjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmciLCJjbG9zZVdpbmRvdyIsImN1cldlYkNvb3JkcyIsIl9jdXJyZW50VXJsIiwiT2JqZWN0IiwiYXNzaWduIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsVUFBVSxHQUFHLFlBQW5COztBQUNBLE1BQU1DLFdBQVcsR0FBRyxTQUFwQjs7QUFDQSxN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QUNBLFFBQU0sS0FBSzJLLFlBQUwsQ0FBa0JDLFdBQWxCLENBQThCLG1CQUE5QixDQUFOOztBQUNBN0ssa0JBQU9DLEtBQVAsQ0FBYSxpQkFBYjs7QUFDQSxTQUFPLElBQVA7QUFDRCxDQVZEOztBQVlBTixPQUFPLENBQUNtTCxVQUFSO0FBQUEsK0NBQXFCLFdBQWdCQyw4QkFBOEIsR0FBRyxLQUFqRCxFQUF3RDtBQUMzRSxRQUFJLENBQUMsS0FBS3pKLE1BQVYsRUFBa0I7QUFDaEJ0QixzQkFBT3VFLGFBQVAsQ0FBcUIsZ0RBQXJCO0FBQ0Q7O0FBRUQsUUFBSXdHLDhCQUFKLEVBQW9DO0FBQ2xDLFlBQU0sS0FBS0MsV0FBTCxFQUFOO0FBQ0Q7O0FBQ0QsVUFBTSxLQUFLMUosTUFBTCxDQUFZQyxVQUFaLEVBQU47QUFDQSxTQUFLekIsVUFBTCxHQUFrQixJQUFsQjtBQUNBLFNBQUtnRyxZQUFMLEdBQW9CLEVBQXBCO0FBQ0EsU0FBS21GLFlBQUwsR0FBb0IsSUFBcEI7QUFDQSxTQUFLM0osTUFBTCxHQUFjLElBQWQ7QUFDRCxHQWJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWVBM0IsT0FBTyxDQUFDZ0QsWUFBUixHQUF1QixZQUFZO0FBQ2pDLFNBQU8sQ0FBQyxDQUFDLEtBQUs3QyxVQUFQLElBQXFCLEtBQUtBLFVBQUwsS0FBb0JQLFVBQWhEO0FBQ0QsQ0FGRDs7QUFJQUksT0FBTyxDQUFDeUgsYUFBUixHQUF3QixVQUFVeEcsR0FBVixFQUFlO0FBQ3JDLE9BQUtzSyxXQUFMLEdBQW1CdEssR0FBbkI7QUFDRCxDQUZEOztBQUlBakIsT0FBTyxDQUFDNkUsYUFBUixHQUF3QixZQUFZO0FBQ2xDLFNBQU8sS0FBSzBHLFdBQVo7QUFDRCxDQUZEOztBQUtBQyxNQUFNLENBQUNDLE1BQVAsQ0FBY3hMLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBSZW1vdGVEZWJ1Z2dlciwgV2ViS2l0UmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCBJT1NQZXJmb3JtYW5jZUxvZyBmcm9tICcuLi9kZXZpY2UtbG9nL2lvcy1wZXJmb3JtYW5jZS1sb2cnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuY29uc3QgTkFUSVZFX1dJTiA9ICdOQVRJVkVfQVBQJztcbmNvbnN0IFdFQlZJRVdfV0lOID0gJ1dFQlZJRVcnO1xuY29uc3QgV0VCVklFV19CQVNFID0gYCR7V0VCVklFV19XSU59X2A7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICBpZiAodGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTikge1xuICAgIHJldHVybiBgJHtXRUJWSUVXX0JBU0V9JHt0aGlzLmN1ckNvbnRleHR9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gTkFUSVZFX1dJTjtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0Q29udGV4dHMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnR2V0dGluZyBsaXN0IG9mIGF2YWlsYWJsZSBjb250ZXh0cycpO1xuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpO1xuXG4gIGxldCBtYXBGbiA9IChjb250ZXh0KSA9PiBjb250ZXh0LmlkLnRvU3RyaW5nKCk7XG4gIGlmICh0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0KSB7XG4gICAgbWFwRm4gPSAoY29udGV4dCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGNvbnRleHQuaWQudG9TdHJpbmcoKSxcbiAgICAgICAgdGl0bGU6IGNvbnRleHQudmlldy50aXRsZSxcbiAgICAgICAgdXJsOiBjb250ZXh0LnZpZXcudXJsLFxuICAgICAgfTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBjb250ZXh0cy5tYXAobWFwRm4pO1xufTtcblxuY29tbWFuZHMuc2V0Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChuYW1lLCBjYWxsYmFjaywgc2tpcFJlYWR5Q2hlY2spIHtcbiAgZnVuY3Rpb24gYWxyZWFkeUluQ29udGV4dCAoZGVzaXJlZCwgY3VycmVudCkge1xuICAgIHJldHVybiAoZGVzaXJlZCA9PT0gY3VycmVudCB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gbnVsbCAmJiBjdXJyZW50ID09PSBOQVRJVkVfV0lOKSB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gTkFUSVZFX1dJTiAmJiBjdXJyZW50ID09PSBudWxsKSk7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoYEF0dGVtcHRpbmcgdG8gc2V0IGNvbnRleHQgdG8gJyR7bmFtZX0nYCk7XG4gIGlmIChhbHJlYWR5SW5Db250ZXh0KG5hbWUsIHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICAvLyBhbHJlYWR5IGluIHRoZSBuYW1lZCBjb250ZXh0LCBubyBuZWVkIHRvIGRvIGFueXRoaW5nXG4gIH0gZWxzZSBpZiAobmFtZSA9PT0gTkFUSVZFX1dJTiB8fCBuYW1lID09PSBudWxsKSB7XG4gICAgLy8gc3dpdGNoaW5nIGludG8gdGhlIG5hdGl2ZSBjb250ZXh0XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBzd2l0Y2hpbmcgaW50byBhIHdlYnZpZXcgY29udGV4dFxuXG4gICAgLy8gaWYgY29udGV4dHMgaGF2ZSBub3QgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCwgZ2V0IHRoZW1cbiAgICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLmNvbnRleHRzKSkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuICAgIH1cblxuICAgIGxldCBjb250ZXh0SWQgPSBuYW1lLnJlcGxhY2UoV0VCVklFV19CQVNFLCAnJyk7XG4gICAgaWYgKGNvbnRleHRJZCA9PT0gJycpIHtcbiAgICAgIC8vIGFsbG93IHVzZXIgdG8gcGFzcyBpbiBcIldFQlZJRVdcIiB3aXRob3V0IGFuIGluZGV4XG4gICAgICAvLyB0aGUgc2Vjb25kIGNvbnRleHQgd2lsbCBiZSB0aGUgZmlyc3Qgd2VidmlldyBhc1xuICAgICAgLy8gdGhlIGZpcnN0IGlzIGFsd2F5cyBOQVRJVkVfQVBQXG4gICAgICBjb250ZXh0SWQgPSB0aGlzLmNvbnRleHRzWzFdO1xuICAgIH1cbiAgICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgaWYgKHRoaXMucmVtb3RlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IGNvbnRleHRJZDtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QoY29udGV4dElkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYGNvbnRleHRJZGAgd2lsbCBiZSBpbiB0aGUgZm9ybSBvZiBgYXBwSWQucGFnZUlkYCBpbiB0aGlzIGNhc2VcbiAgICAgIGxldCBbYXBwSWRLZXksIHBhZ2VJZEtleV0gPSBfLm1hcChjb250ZXh0SWQuc3BsaXQoJy4nKSwgKGlkKSA9PiBwYXJzZUludChpZCwgMTApKTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2spO1xuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gY29udGV4dElkO1xuICAgIH1cbiAgfVxuXG4gIC8vIGF0dGVtcHQgdG8gc3RhcnQgcGVyZm9ybWFuY2UgbG9nZ2luZywgaWYgcmVxdWVzdGVkXG4gIGlmICh0aGlzLm9wdHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nICYmIHRoaXMucmVtb3RlKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBTdGFydGluZyBwZXJmb3JtYW5jZSBsb2cgb24gJyR7dGhpcy5jdXJDb250ZXh0fSdgKTtcbiAgICB0aGlzLmxvZ3MucGVyZm9ybWFuY2UgPSBuZXcgSU9TUGVyZm9ybWFuY2VMb2codGhpcy5yZW1vdGUpO1xuICAgIGF3YWl0IHRoaXMubG9ncy5wZXJmb3JtYW5jZS5zdGFydENhcHR1cmUoKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlID0gYXN5bmMgZnVuY3Rpb24gKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dC50b1N0cmluZygpO1xufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlcyA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gYXdhaXQgdGhpcy5saXN0V2ViRnJhbWVzKGZhbHNlKTtcbiAgY29uc3QgaWRBcnJheSA9IF8ubWFwKHRoaXMud2luZG93SGFuZGxlQ2FjaGUsICdpZCcpO1xuICAvLyBzaW5jZSB3ZSB1c2UgdGhpcy5jb250ZXh0cyB0byBtYW5hZ2Ugc2VsZWN0aW5nIGRlYnVnZ2VyIHBhZ2VzLCBtYWtlXG4gIC8vIHN1cmUgaXQgZ2V0cyBwb3B1bGF0ZWQgZXZlbiBpZiBzb21lb25lIGRpZCBub3QgdXNlIHRoZVxuICAvLyBnZXRDb250ZXh0cyBtZXRob2RcbiAgaWYgKCF0aGlzLmNvbnRleHRzKSB7XG4gICAgdGhpcy5jb250ZXh0cyA9IGlkQXJyYXk7XG4gIH1cbiAgcmV0dXJuIF8ubWFwKGlkQXJyYXksIChpZCkgPT4gaWQudG9TdHJpbmcoKSk7XG59O1xuXG5jb21tYW5kcy5zZXRXaW5kb3cgPSBhc3luYyBmdW5jdGlvbiAobmFtZSwgc2tpcFJlYWR5Q2hlY2spIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpO1xuICB9XG4gIGxldCBwYWdlSWRLZXkgPSBwYXJzZUludChuYW1lLCAxMCk7XG4gIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UocGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBuYW1lO1xuICB9IGVsc2Uge1xuICAgIGlmIChuYW1lID09PSB0aGlzLmN1cldpbmRvd0hhbmRsZSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBSZW1vdGUgZGVidWdnZXIgaXMgYWxyZWFkeSBjb25uZWN0ZWQgdG8gd2luZG93ICcke25hbWV9J2ApO1xuICAgIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IHRoaXMuY3VyV2luZG93SGFuZGxlID0gbmFtZTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QobmFtZSk7XG4gICAgfVxuICB9XG59O1xuXG5oZWxwZXJzLndlYkNvbnRleHRJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dC5yZXBsYWNlKFdFQlZJRVdfQkFTRSwgJycpIC0gMTtcbn07XG5cbmV4dGVuc2lvbnMuaW5pdEF1dG9XZWJ2aWV3ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBpZiAodGhpcy5vcHRzLmF1dG9XZWJ2aWV3KSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdTZXR0aW5nIGF1dG8gd2VidmlldycpO1xuICAgIGF3YWl0IHRoaXMubmF2VG9Jbml0aWFsV2Vidmlldyh0aGlzKTtcbiAgfVxufTtcblxuZXh0ZW5zaW9ucy5nZXRDb250ZXh0c0FuZFZpZXdzID0gYXN5bmMgZnVuY3Rpb24gKHVzZVVybCA9IHRydWUpIHtcbiAgbG9nZ2VyLmRlYnVnKCdSZXRyaWV2aW5nIGNvbnRleHRzIGFuZCB2aWV3cycpO1xuICBsZXQgd2Vidmlld3MgPSBhd2FpdCB0aGlzLmxpc3RXZWJGcmFtZXModXNlVXJsKTtcblxuICBsZXQgY3R4cyA9IFt7aWQ6IE5BVElWRV9XSU4sIHZpZXc6IHt9fV07XG4gIHRoaXMuY29udGV4dHMgPSBbTkFUSVZFX1dJTl07XG4gIGZvciAobGV0IHZpZXcgb2Ygd2Vidmlld3MpIHtcbiAgICBjdHhzLnB1c2goe2lkOiBgJHtXRUJWSUVXX0JBU0V9JHt2aWV3LmlkfWAsIHZpZXd9KTtcbiAgICB0aGlzLmNvbnRleHRzLnB1c2godmlldy5pZC50b1N0cmluZygpKTtcbiAgfVxuICByZXR1cm4gY3R4cztcbn07XG5cbmV4dGVuc2lvbnMuZ2V0TmV3UmVtb3RlRGVidWdnZXIgPSBhc3luYyBmdW5jdGlvbiAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICByZXR1cm4gbmV3IFJlbW90ZURlYnVnZ2VyKHtcbiAgICBidW5kbGVJZDogdGhpcy5vcHRzLmJ1bmRsZUlkLFxuICAgIHVzZU5ld1NhZmFyaTogdGhpcy51c2VOZXdTYWZhcmkoKSxcbiAgICBwYWdlTG9hZE1zOiB0aGlzLnBhZ2VMb2FkTXMsXG4gICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgIHJlbW90ZURlYnVnUHJveHk6IHRoaXMub3B0cy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgIGdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlOiB1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5zYWZhcmlHYXJiYWdlQ29sbGVjdClcbiAgICAgID8gISF0aGlzLm9wdHMuc2FmYXJpR2FyYmFnZUNvbGxlY3RcbiAgICAgIDogdHJ1ZSxcbiAgfSk7XG59O1xuXG5leHRlbnNpb25zLmxpc3RXZWJGcmFtZXMgPSBhc3luYyBmdW5jdGlvbiAodXNlVXJsID0gdHJ1ZSkge1xuICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCkge1xuICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdDYW5ub3QgZW50ZXIgd2ViIGZyYW1lIHdpdGhvdXQgYSBidW5kbGUgSUQnKTtcbiAgfVxuXG4gIHVzZVVybCA9IHVzZVVybCAmJiAhIXRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICBsb2dnZXIuZGVidWcoYFNlbGVjdGluZyBieSB1cmw6ICR7dXNlVXJsfSAke3VzZVVybCA/IGAoZXhwZWN0ZWQgdXJsOiAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nKWAgOiAnJ31gKTtcblxuICBsZXQgY3VycmVudFVybCA9IHVzZVVybCA/IHRoaXMuZ2V0Q3VycmVudFVybCgpIDogdW5kZWZpbmVkO1xuICBsZXQgcGFnZUFycmF5O1xuICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSAmJiB0aGlzLnJlbW90ZSAmJiB0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAvLyByZWFsIGRldmljZSwgYW5kIGFscmVhZHkgY29ubmVjdGVkXG4gICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUucGFnZUFycmF5RnJvbUpzb24odGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICB9IGVsc2UgaWYgKHRoaXMucmVtb3RlICYmIHRoaXMucmVtb3RlLmFwcElkS2V5KSB7XG4gICAgLy8gc2ltdWxhdG9yLCBhbmQgYWxyZWFkeSBjb25uZWN0ZWRcbiAgICBwYWdlQXJyYXkgPSBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RBcHAoY3VycmVudFVybCwgdGhpcy5vcHRzLndlYnZpZXdDb25uZWN0UmV0cmllcywgdGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICB9IGVsc2UgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAvLyByZWFsIGRldmljZSwgYW5kIG5vdCBjb25uZWN0ZWRcbiAgICB0cnkge1xuICAgICAgdGhpcy5yZW1vdGUgPSBuZXcgV2ViS2l0UmVtb3RlRGVidWdnZXIoe1xuICAgICAgICBwb3J0OiB0aGlzLm9wdHMud2Via2l0RGVidWdQcm94eVBvcnQsXG4gICAgICAgIHdlYmtpdFJlc3BvbnNlVGltZW91dDogdGhpcy5vcHRzLndlYmtpdFJlc3BvbnNlVGltZW91dCxcbiAgICAgIH0pO1xuICAgICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUucGFnZUFycmF5RnJvbUpzb24odGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaXQgaXMgcmVhc29uYWJsZSB0byBleHBlY3QgdGhhdCB0aGlzIG1pZ2h0IGJlIGNhbGxlZCB3aGVuIHRoZXJlIGlzIG5vXG4gICAgICAvLyB3ZWJraXQgcmVtb3RlIGRlYnVnZ2VyIHRvIGNvbm5lY3QgdG9cbiAgICAgIGlmICghXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2Nvbm5lY3QgRUNPTk5SRUZVU0VEJykpIHRocm93IGVycjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgICBsb2dnZXIud2FybignQXR0ZW1wdGVkIHRvIGdldCBhIGxpc3Qgb2Ygd2VidmlldyBjb250ZXh0cyBidXQgY291bGQgbm90IGNvbm5lY3QgdG8gJyArXG4gICAgICAgICAgICAgICAgICAnaW9zLXdlYmtpdC1kZWJ1Zy1wcm94eS4gSWYgeW91IGV4cGVjdCB0byBmaW5kIHdlYnZpZXdzLCBwbGVhc2UgZW5zdXJlICcgK1xuICAgICAgICAgICAgICAgICAgJ3RoYXQgdGhlIHByb3h5IGlzIHJ1bm5pbmcgYW5kIGFjY2Vzc2libGUnKTtcbiAgICAgIHRoaXMucmVtb3RlID0gbnVsbDtcbiAgICAgIHBhZ2VBcnJheSA9IFtdO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBzaW11bGF0b3IsIGFuZCBub3QgY29ubmVjdGVkXG4gICAgdGhpcy5yZW1vdGUgPSBhd2FpdCB0aGlzLmdldE5ld1JlbW90ZURlYnVnZ2VyKCk7XG5cbiAgICBsZXQgYXBwSW5mbyA9IGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QoKTtcbiAgICBpZiAoIWFwcEluZm8pIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnVW5hYmxlIHRvIGNvbm5lY3QgdG8gdGhlIHJlbW90ZSBkZWJ1Z2dlci4nKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0QXBwKGN1cnJlbnRVcmwsIHRoaXMub3B0cy53ZWJ2aWV3Q29ubmVjdFJldHJpZXMsIHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICB0aGlzLnJlbW90ZS5vbihSZW1vdGVEZWJ1Z2dlci5FVkVOVF9QQUdFX0NIQU5HRSwgdGhpcy5vblBhZ2VDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVELCAoKSA9PiB7XG4gICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmN1cldlYkZyYW1lcykpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBDbGVhcmluZyAke3RoaXMuY3VyV2ViRnJhbWVzLmxlbmd0aH0gZnJhbWVzOiAke3RoaXMuY3VyV2ViRnJhbWVzLmpvaW4oJywgJyl9YCk7XG4gICAgICB9XG4gICAgICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICAgIH0pO1xuXG4gICAgbGV0IHRyeUNsb3NpbmdBbGVydCA9IGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBkaWREaXNtaXNzID0gYXdhaXQgdGhpcy5jbG9zZUFsZXJ0QmVmb3JlVGVzdCgpO1xuICAgICAgaWYgKCFkaWREaXNtaXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2xvc2UgYWxlcnQgZmFpbGVkLiBSZXRyeS4nKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCByZXRyeUludGVydmFsKDMsIDQwMDAsIHRyeUNsb3NpbmdBbGVydCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyBpZiB0aGUgbG9vcCB0byBjbG9zZSBhbGVydHMgZmFpbGVkIHRvIGRpc21pc3MsIGlnbm9yZSxcbiAgICAgIC8vIG90aGVyd2lzZSBsb2cgYW5kIHRocm93IHRoZSBlcnJvclxuICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAnQ2xvc2UgYWxlcnQgZmFpbGVkLiBSZXRyeS4nKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGVycik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKHBhZ2VBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAvLyB3ZSBoYXZlIG5vIHdlYiBmcmFtZXMsIGJ1dCBjb250aW51ZSBhbnl3YXlcbiAgICBsb2dnZXIuZGVidWcoJ05vIHdlYiBmcmFtZXMgZm91bmQuJyk7XG4gIH1cbiAgcmV0dXJuIHBhZ2VBcnJheTtcbn07XG5cbmV4dGVuc2lvbnMub25QYWdlQ2hhbmdlID0gYXN5bmMgZnVuY3Rpb24gKHBhZ2VDaGFuZ2VOb3RpZmljYXRpb24pIHtcbiAgbG9nZ2VyLmRlYnVnKGBSZW1vdGUgZGVidWdnZXIgbm90aWZpZWQgdXMgb2YgYSBuZXcgcGFnZSBsaXN0aW5nOiAke0pTT04uc3RyaW5naWZ5KHBhZ2VDaGFuZ2VOb3RpZmljYXRpb24pfWApO1xuICBpZiAodGhpcy5zZWxlY3RpbmdOZXdQYWdlKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdXZSBhcmUgaW4gdGhlIG1pZGRsZSBvZiBzZWxlY3RpbmcgYSBwYWdlLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIXRoaXMucmVtb3RlIHx8ICF0aGlzLnJlbW90ZS5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdXZSBoYXZlIG5vdCB5ZXQgY29ubmVjdGVkLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHthcHBJZEtleSwgcGFnZUFycmF5fSA9IHBhZ2VDaGFuZ2VOb3RpZmljYXRpb247XG5cbiAgbGV0IG5ld0lkcyA9IFtdO1xuICBsZXQgbmV3UGFnZXMgPSBbXTtcbiAgbGV0IGtleUlkID0gbnVsbDtcbiAgZm9yIChjb25zdCBwYWdlIG9mIHBhZ2VBcnJheSkge1xuICAgIGNvbnN0IGlkID0gcGFnZS5pZC50b1N0cmluZygpO1xuICAgIG5ld0lkcy5wdXNoKGlkKTtcbiAgICBpZiAocGFnZS5pc0tleSkge1xuICAgICAga2V5SWQgPSBpZDtcbiAgICB9XG4gICAgY29uc3QgY29udGV4dElkID0gYCR7YXBwSWRLZXl9LiR7aWR9YDtcblxuICAgIC8vIGFkZCBpZiB0aGlzIGlzIGEgbmV3IHBhZ2VcbiAgICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgICAgbmV3UGFnZXMucHVzaChpZCk7XG4gICAgICB0aGlzLmNvbnRleHRzLnB1c2goY29udGV4dElkKTtcbiAgICB9XG4gIH1cblxuICBpZiAoIWtleUlkKSB7XG4gICAgLy8gaWYgdGhlcmUgaXMgbm8ga2V5IGlkLCBwdWxsIHRoZSBmaXJzdCBpZCBmcm9tIHRoZSBwYWdlIGFycmF5IGFuZCB1c2UgdGhhdFxuICAgIC8vIGFzIGEgc3RhbmQgaW5cbiAgICBsb2dnZXIuZGVidWcoJ05vIGtleSBpZCBmb3VuZC4gQ2hvb3NpbmcgZmlyc3QgaWQgZnJvbSBwYWdlIGFycmF5Jyk7XG4gICAga2V5SWQgPSBuZXdJZHNbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIGlmICghdXRpbC5oYXNWYWx1ZSh0aGlzLmN1ckNvbnRleHQpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdXZSBkbyBub3QgYXBwZWFyIHRvIGhhdmUgd2luZG93IHNldCB5ZXQsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgW2N1ckFwcElkS2V5LCBjdXJQYWdlSWRLZXldID0gdGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJyk7XG5cbiAgaWYgKGN1ckFwcElkS2V5ICE9PSBhcHBJZEtleSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnUGFnZSBjaGFuZ2Ugbm90IHJlZmVycmluZyB0byBjdXJyZW50bHkgc2VsZWN0ZWQgYXBwLCBpZ25vcmluZy4nKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgbmV3UGFnZSA9IG51bGw7XG4gIGlmIChuZXdQYWdlcy5sZW5ndGgpIHtcbiAgICBuZXdQYWdlID0gXy5sYXN0KG5ld1BhZ2VzKTtcbiAgICBsb2dnZXIuZGVidWcoYFdlIGhhdmUgbmV3IHBhZ2VzLCBzZWxlY3RpbmcgcGFnZSAnJHtuZXdQYWdlfSdgKTtcbiAgfSBlbHNlIGlmICghXy5pbmNsdWRlcyhuZXdJZHMsIGN1clBhZ2VJZEtleSkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ05ldyBwYWdlIGxpc3RpbmcgZnJvbSByZW1vdGUgZGVidWdnZXIgZG9lcyBub3QgY29udGFpbiAnICtcbiAgICAgICAgICAgICAgICAgJ2N1cnJlbnQgd2luZG93OyBhc3N1bWluZyBpdCBpcyBjbG9zZWQnKTtcbiAgICBpZiAoIXV0aWwuaGFzVmFsdWUoa2V5SWQpKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0RvIG5vdCBoYXZlIG91ciBjdXJyZW50IHdpbmRvdyBhbnltb3JlLCBhbmQgdGhlcmUgJyArXG4gICAgICAgICAgICAgICAgICAgJ2FyZSBub3QgYW55IG1vcmUgdG8gbG9hZCEgRG9pbmcgbm90aGluZy4uLicpO1xuICAgICAgdGhpcy5zZXRDdXJyZW50VXJsKHVuZGVmaW5lZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbG9nZ2VyLmRlYnVnKGBEZWJ1Z2dlciBhbHJlYWR5IHNlbGVjdGVkIHBhZ2UgJyR7a2V5SWR9JywgYCArXG4gICAgICAgICAgICAgICAgIGBjb25maXJtaW5nIHRoYXQgY2hvaWNlLmApO1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IGAke2FwcElkS2V5fS4ke2tleUlkfWA7XG4gICAgbmV3UGFnZSA9IGtleUlkO1xuICB9IGVsc2Uge1xuICAgIC8vIGF0IHRoaXMgcG9pbnQsIHRoZXJlIGFyZSBubyBuZXcgcGFnZXMsIGFuZCB0aGUgY3VycmVudCBwYWdlIHN0aWxsIGV4aXN0c1xuICAgIGxvZ2dlci5kZWJ1ZygnQ2hlY2tpbmcgaWYgcGFnZSBuZWVkcyB0byBsb2FkJyk7XG4gICAgLy8gSWYgYSB3aW5kb3cgbmF2aWdhdGVzIHRvIGFuIGFuY2hvciBpdCBkb2Vzbid0IGFsd2F5cyBmaXJlIGEgcGFnZVxuICAgIC8vIGNhbGxiYWNrIGV2ZW50LiBMZXQncyBjaGVjayBpZiB3ZSB3b3VuZCB1cCBpbiBzdWNoIGEgc2l0dWF0aW9uLlxuICAgIGNvbnN0IG5lZWRzUGFnZUxvYWQgPSAoKCkgPT4ge1xuICAgICAgLy8gbmVlZCB0byBtYXAgdGhlIHBhZ2UgaWRzIHRvIGNvbnRleHQgaWRzXG4gICAgICBjb25zdCBjb250ZXh0QXJyYXkgPSBfLm1hcChwYWdlQXJyYXksIChwYWdlKSA9PiBgJHthcHBJZEtleX0uJHtwYWdlLmlkfWApO1xuICAgICAgLy8gY2hlY2sgaWYgdGhlIGN1cnJlbnQgY29udGV4dCBleGlzdHMgaW4gYm90aCBvdXIgcmVjb3JkZWQgY29udGV4dHMsXG4gICAgICAvLyBhbmQgdGhlIHBhZ2UgYXJyYXlcbiAgICAgIHJldHVybiAhXy5pc0VxdWFsKF8uZmluZCh0aGlzLmNvbnRleHRzLCB0aGlzLmN1ckNvbnRleHQpLCBfLmZpbmQoY29udGV4dEFycmF5LCB0aGlzLmN1ckNvbnRleHQpKTtcbiAgICB9KSgpO1xuXG4gICAgaWYgKG5lZWRzUGFnZUxvYWQpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnUGFnZSBsb2FkIG5lZWRlZC4gTG9hZGluZy4uLicpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUucGFnZUxvYWQoKTtcbiAgICB9XG5cbiAgICBsb2dnZXIuZGVidWcoJ05ldyBwYWdlIGxpc3RpbmcgaXMgc2FtZSBhcyBvbGQsIGRvaW5nIG5vdGhpbmcnKTtcbiAgfVxuXG4gIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBwYWdlIGxpc3RpbmcgaXNuJ3QgaW5kaWNhdGluZyBhIHJlZGlyZWN0XG4gIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICBsZXQgY3VycmVudFBhZ2VJZCA9IHBhcnNlSW50KF8ubGFzdCh0aGlzLmN1ckNvbnRleHQuc3BsaXQoJy4nKSksIDEwKTtcbiAgICBsZXQgcGFnZSA9IF8uZmluZChwYWdlQXJyYXksIChwKSA9PiBwYXJzZUludChwLmlkLCAxMCkgPT09IGN1cnJlbnRQYWdlSWQpO1xuICAgIGlmIChwYWdlICYmIHBhZ2UudXJsICE9PSB0aGlzLmdldEN1cnJlbnRVcmwoKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBSZWRpcmVjdGVkIGZyb20gJyR7dGhpcy5nZXRDdXJyZW50VXJsKCl9JyB0byAnJHtwYWdlLnVybH0nYCk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwocGFnZS51cmwpO1xuICAgIH1cbiAgfVxuXG4gIGlmICh1dGlsLmhhc1ZhbHVlKG5ld1BhZ2UpKSB7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gdHJ1ZTtcbiAgICBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RQYWdlKGFwcElkS2V5LCBwYXJzZUludChuZXdQYWdlLCAxMCkpO1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IGZhbHNlO1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IGAke2FwcElkS2V5fS4ke25ld1BhZ2V9YDtcbiAgfVxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gcGFnZUFycmF5O1xufTtcblxuZXh0ZW5zaW9ucy5nZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlID0gYXN5bmMgZnVuY3Rpb24gKHJlZ0V4cCkge1xuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoKTtcbiAgbGV0IG1hdGNoaW5nQ3R4O1xuICBmb3IgKGxldCBjdHggb2YgY29udGV4dHMpIHtcbiAgICBpZiAoY3R4LnZpZXcgJiYgKChjdHgudmlldy50aXRsZSAmJiBjdHgudmlldy50aXRsZS5tYXRjaChyZWdFeHApKSB8fCAoY3R4LnZpZXcudXJsICYmIGN0eC52aWV3LnVybC5tYXRjaChyZWdFeHApKSkpIHtcbiAgICAgIGlmIChjdHgudmlldy51cmwgIT09ICdhYm91dDpibGFuaycpIHtcbiAgICAgICAgbWF0Y2hpbmdDdHggPSBjdHg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpbiB0aGUgY2FzZXMgb2YgWGNvZGUgPCA1IChpLmUuLCBpT1MgU0RLIFZlcnNpb24gbGVzcyB0aGFuIDcpXG4gICAgICAgIC8vIGlPUyA3LjEsIGlPUyA5LjAgJiBpT1MgOS4xIGluIGEgd2VidmlldyAobm90IGluIFNhZmFyaSlcbiAgICAgICAgLy8gd2UgY2FuIGhhdmUgdGhlIHVybCBiZSBgYWJvdXQ6YmxhbmtgXG4gICAgICAgIGlmIChwYXJzZUZsb2F0KHRoaXMuaW9zU2RrVmVyc2lvbikgPCA3IHx8IHBhcnNlRmxvYXQodGhpcy5pb3NTZGtWZXJzaW9uKSA+PSA5IHx8XG4gICAgICAgICAgICAodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiA9PT0gJzcuMScgJiYgdGhpcy5vcHRzLmFwcCAmJiB0aGlzLm9wdHMuYXBwLnRvTG93ZXJDYXNlKCkgIT09ICdzYWZhcmknKSkge1xuICAgICAgICAgIG1hdGNoaW5nQ3R4ID0gY3R4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1hdGNoaW5nQ3R4ID8gbWF0Y2hpbmdDdHguaWQgOiB1bmRlZmluZWQ7XG59O1xuXG4vLyBSaWdodCBub3cgd2UgZG9uJ3QgbmVjZXNzYXJpbHkgd2FpdCBmb3Igd2Vidmlld1xuLy8gYW5kIGZyYW1lIHRvIGxvYWQsIHdoaWNoIGxlYWRzIHRvIHJhY2UgY29uZGl0aW9ucyBhbmQgZmxha2luZXNzLFxuLy8gbGV0J3Mgc2VlIGlmIHdlIGNhbiB0cmFuc2l0aW9uIHRvIHNvbWV0aGluZyBiZXR0ZXJcbmV4dGVuc2lvbnMudXNlTmV3U2FmYXJpID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gcGFyc2VGbG9hdCh0aGlzLmlvc1Nka1ZlcnNpb24pID49IDguMSAmJlxuICAgICAgICAgcGFyc2VGbG9hdCh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uKSA+PSA4LjEgJiZcbiAgICAgICAgICF0aGlzLmlzUmVhbERldmljZSgpICYmXG4gICAgICAgICB0aGlzLm9wdHMuc2FmYXJpO1xufTtcblxuZXh0ZW5zaW9ucy5uYXZUb0luaXRpYWxXZWJ2aWV3ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQgdGltZW91dCA9IDA7XG4gIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgdGltZW91dCA9IDMwMDA7XG4gICAgbG9nZ2VyLmRlYnVnKGBXYWl0aW5nIGZvciAke3RpbWVvdXR9IG1zIGJlZm9yZSBuYXZpZ2F0aW5nIHRvIHZpZXcuYCk7XG4gIH1cbiAgYXdhaXQgQi5kZWxheSh0aW1lb3V0KTtcbiAgaWYgKHRoaXMudXNlTmV3U2FmYXJpKCkpIHtcbiAgICBhd2FpdCB0aGlzLnR5cGVBbmROYXZUb1VybCgpO1xuICB9IGVsc2UgaWYgKHBhcnNlSW50KHRoaXMuaW9zU2RrVmVyc2lvbiwgMTApID49IDcgJiYgIXRoaXMuaXNSZWFsRGV2aWNlKCkgJiYgdGhpcy5vcHRzLnNhZmFyaSkge1xuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcygpO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC8uKi8pO1xuICB9XG59O1xuXG5hc3luYyBmdW5jdGlvbiBvcGVuTmV3UGFnZSAoKSB7XG4gIGxldCBuZXdQYWdlQnV0dG9uID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgneHBhdGgnLCBcIi8vVUlBQnV0dG9uW2NvbnRhaW5zKEBuYW1lLCdOZXcgcGFnZScpXVwiKTtcbiAgYXdhaXQgdGhpcy5uYXRpdmVUYXAobmV3UGFnZUJ1dHRvbi5FTEVNRU5UKTtcbn1cblxuZXh0ZW5zaW9ucy50eXBlQW5kTmF2VG9VcmwgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBhZGRyZXNzID0gdGhpcy5vcHRzLmFkZHJlc3MgPyB0aGlzLm9wdHMuYWRkcmVzcyA6ICcxMjcuMC4wLjEnO1xuICB0aGlzLnNldEN1cnJlbnRVcmwodGhpcy5jYXBzLnNhZmFyaUluaXRpYWxVcmwgfHwgYGh0dHA6Ly8ke2FkZHJlc3N9OiR7dGhpcy5vcHRzLnBvcnR9L3dlbGNvbWVgKTtcblxuICBsZXQgdHJpZXMgPSAwO1xuICBjb25zdCBNQVhfVFJJRVMgPSAyO1xuICBsZXQgbmF2aWdhdGUgPSBhc3luYyAoKSA9PiB7XG4gICAgbGV0IG9sZEltcFdhaXQgPSB0aGlzLmltcGxpY2l0V2FpdE1zO1xuICAgIHRoaXMuaW1wbGljaXRXYWl0TXMgPSA3MDAwO1xuXG4gICAgLy8gZmluZCB0aGUgdXJsIGJhciwgYW5kIHRhcCBvbiBpdC4gcmV0cnkgdG8gbWFrZSBzdXJlIHdlIGRvbid0IHRyeVxuICAgIC8vIHRvbyBzb29uIHdoaWxlIHRoZSB2aWV3IGlzIHN0aWxsIGxvYWRpbmdcbiAgICBsZXQgZWwgPSBhd2FpdCByZXRyeUludGVydmFsKDMsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCdhY2Nlc3NpYmlsaXR5IGlkJywgJ1VSTCcpO1xuICAgIH0pO1xuICAgIHRoaXMuaW1wbGljaXRXYWl0TXMgPSBvbGRJbXBXYWl0O1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMubmF0aXZlVGFwKGVsLkVMRU1FTlQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKF8uaW5jbHVkZXMoZXJyLm1lc3NhZ2UsICdjb3VsZCBub3QgYmUgdGFwcGVkJykpIHtcbiAgICAgICAgaWYgKHRyaWVzKysgPj0gTUFYX1RSSUVTKSB0aHJvdyBlcnI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgICAvLyBnZW5lcmFsbHkgdGhpcyBtZWFucyB0aGF0IFNhZmFyaSBpcyBpbiBwYWdlIHZpZXdpbmcgbW9kZVxuICAgICAgICAvLyBzbyB0cnkgdG8gb3BlbiBhIG5ldyBwYWdlIGFuZCB0aGVuIHJlZG8gdGhlIG5hdmlnYXRpb25cbiAgICAgICAgYXdhaXQgb3Blbk5ld1BhZ2UoKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5hdmlnYXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZ2V0IHRoZSBsYXN0IGFkZHJlc3MgZWxlbWVudCBhbmQgc2V0IHRoZSB1cmxcbiAgICB0cnkge1xuICAgICAgbGV0IGVsID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgnY2xhc3MgbmFtZScsICdVSUFUZXh0RmllbGQnKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0VmFsdWVJbW1lZGlhdGUodGhpcy5nZXRDdXJyZW50VXJsKCksIGVsKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIHRoaXMgaXMgZmxha2V5IG9uIGNlcnRhaW4gc3lzdGVtcyBzbyB3ZSByZXRyeSB1bnRpbCB3ZSBnZXQgc29tZXRoaW5nXG4gICAgICAvLyBpb3Mgc2ltczogc2FmYXJpIG9wZW5zIGJ1dCB0aGUgdGV4dCBmaWVsZCBjYW4ndCBiZSBmb3VuZFxuICAgICAgaWYgKHRyaWVzKysgPj0gTUFYX1RSSUVTKSB0aHJvdyBlcnI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICAgIHJldHVybiBhd2FpdCBuYXZpZ2F0ZSgpO1xuICAgIH1cblxuICAgIC8vIG1ha2UgaXQgaGFwcGVuXG4gICAgdHJ5IHtcbiAgICAgIGVsID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdHbycpO1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVUYXAoZWwuRUxFTUVOVCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2NvdWxkIG5vdCBiZSB0YXBwZWQnKSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ1VuYWJsZSB0byBzdWJtaXQgVVJMIGJlY2F1c2UgXFwnR29cXCcgYnV0dG9uIGNvdWxkIG5vdCBiZSB0YXBwZWQuICcgK1xuICAgICAgICAgICAgICAgICAgICAgJ1BsZWFzZSBtYWtlIHN1cmUgeW91ciBrZXlib2FyZCBpcyB0b2dnbGVkIG9uLicpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSh1bmRlZmluZWQsIG5ldyBSZWdFeHAodGhpcy5nZXRDdXJyZW50VXJsKCksICdpJykpO1xuXG4gICAgLy8gd2FpdCBmb3IgcGFnZSB0byBmaW5pc2ggbG9hZGluZy5cbiAgICBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlVW5sb2FkKCk7XG4gIH07XG4gIGF3YWl0IG5hdmlnYXRlKCk7XG59O1xuXG5leHRlbnNpb25zLm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnV2UgYXJlIG9uIGlPUzcrIHNpbXVsYXRvcjogY2xpY2tpbmcgYXBwbGUgYnV0dG9uIHRvIGdldCBpbnRvIGEgd2VidmlldycpO1xuICBsZXQgb2xkSW1wV2FpdCA9IHRoaXMuaW1wbGljaXRXYWl0TXM7XG4gIHRoaXMuaW1wbGljaXRXYWl0TXMgPSA3MDAwOyAvLyB3YWl0IDdzIGZvciBhcHBsZSBidXR0b24gdG8gZXhpc3RcblxuICBsZXQgZWw7XG4gIHRyeSB7XG4gICAgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCd4cGF0aCcsICcvL1VJQVNjcm9sbFZpZXdbMV0vVUlBQnV0dG9uWzFdJyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxldCBtc2cgPSAnQ291bGQgbm90IGZpbmQgYnV0dG9uIHRvIGNsaWNrIHRvIGdldCBpbnRvIHdlYnZpZXcuICcgK1xuICAgICAgICAgICAgICAnUHJvY2VlZGluZyBvbiB0aGUgYXNzdW1wdGlvbiB3ZSBoYXZlIGEgd29ya2luZyBvbmUuJztcbiAgICBsb2dnZXIuZXJyb3IobXNnKTtcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gb2xkSW1wV2FpdDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXZUb1ZpZXdXaXRoVGl0bGUoLy4qL2kpO1xuICB9XG4gIHRoaXMuaW1wbGljaXRXYWl0TXMgPSBvbGRJbXBXYWl0O1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMubmF0aXZlVGFwKGVsLkVMRU1FTlQpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsZXQgbXNnID0gJ0NvdWxkIG5vdCBjbGljayBidXR0b24gdG8gZ2V0IGludG8gd2Vidmlldy4gJyArXG4gICAgICAgICAgICAgICdQcm9jZWVkaW5nIG9uIHRoZSBhc3N1bXB0aW9uIHdlIGhhdmUgYSB3b3JraW5nIG9uZS4nO1xuICAgIGxvZ2dlci5lcnJvcihtc2cpO1xuICB9XG4gIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC9hcHBsZS9pKTtcbn07XG5cbmV4dGVuc2lvbnMubmF2VG9WaWV3V2l0aFRpdGxlID0gYXN5bmMgZnVuY3Rpb24gKHRpdGxlUmVnZXgsIHVybFJlZ0V4cCkge1xuICBsb2dnZXIuZGVidWcoJ05hdmlnYXRpbmcgdG8gbW9zdCByZWNlbnRseSBvcGVuZWQgd2VidmlldycpO1xuICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICBsZXQgc3BpblRpbWUgPSA1MDA7XG4gIGxldCBzcGluSGFuZGxlcyA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgcmVzO1xuICAgIHRyeSB7XG4gICAgICByZXMgPSBhd2FpdCB0aGlzLmdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUodGl0bGVSZWdleCB8fCB1cmxSZWdFeHApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcygnQ291bGQgbm90IGNvbm5lY3QgdG8gYSB2YWxpZCBhcHAgYWZ0ZXInKSkge1xuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihgQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXchIEVycjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgZXJyb3Iuc3RhY2sgKz0gYFxcbkNhdXNlZCBieTogJHtlcnIuc3RhY2t9YDtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICBsb2dnZXIuZGVidWcoJ0NvdWxkIG5vdCBuYXZpZ2F0ZSB0byB3ZWJ2aWV3LiBSZXRyeWluZyBpZiBwb3NzaWJsZS4nKTtcbiAgICB9XG4gICAgaWYgKHJlcykge1xuICAgICAgbGV0IGxhdGVzdFdpbmRvdyA9IHJlcztcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUGlja2luZyB3ZWJ2aWV3ICcke2xhdGVzdFdpbmRvd30nYCk7XG4gICAgICBhd2FpdCB0aGlzLnNldENvbnRleHQobGF0ZXN0V2luZG93KTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNhbmNlbFBhZ2VMb2FkKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gbm8gd2VidmlldyB3YXMgZm91bmRcbiAgICBpZiAoKERhdGUubm93KCkgLSBzdGFydCkgPj0gOTAwMDApIHtcbiAgICAgIC8vIHRvbyBzbG93LCBnZXQgb3V0XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBuYXZpZ2F0ZSB0byB3ZWJ2aWV3OyB0aGVyZSBhcmUgbm9uZSEnKTtcbiAgICB9XG5cbiAgICBsb2dnZXIud2FybihcIkNvdWxkIG5vdCBmaW5kIGFueSB3ZWJ2aWV3cyB5ZXQsIHJlZnJlc2hpbmcvcmV0cnlpbmdcIik7XG4gICAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkgfHwgIXRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICAgIC8vIG9uIGEgcmVhbCBkZXZpY2UsIHdoZW4gbm90IHVzaW5nIFNhZmFyaSwgd2UganVzdCB3YW50IHRvIHRyeSBhZ2FpblxuICAgICAgYXdhaXQgQi5kZWxheShzcGluVGltZSk7XG4gICAgICByZXR1cm4gYXdhaXQgc3BpbkhhbmRsZXMoKTtcbiAgICB9XG5cbiAgICAvLyBmaW5kIHRoZSByZWxvYWQgYnV0dG9uIGFuZCB0YXAgaXQsIGlmIHBvc3NpYmxlXG4gICAgbGV0IGVsZW1lbnQ7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnRmluZGluZyBhbmQgdGFwcGluZyByZWxvYWQgYnV0dG9uJyk7XG4gICAgICBlbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kVUlFbGVtZW50T3JFbGVtZW50cygnYWNjZXNzaWJpbGl0eSBpZCcsICdSZWxvYWRCdXR0b24nLCAnJywgZmFsc2UpO1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVUYXAoZWxlbWVudC5FTEVNRU5UKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBFcnJvciBmaW5kaW5nIGFuZCB0YXBwaW5nIHJlbG9hZCBidXR0b246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2dnZXIud2FybignUmV0cnlpbmcuJyk7XG4gICAgICBhd2FpdCBCLmRlbGF5KHNwaW5UaW1lKTtcbiAgICB9XG5cbiAgICAvLyB0cnkgaXQgYWxsIGFnYWluXG4gICAgcmV0dXJuIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG4gIH07XG4gIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG59O1xuXG5oZWxwZXJzLmNsb3NlQWxlcnRCZWZvcmVUZXN0ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQgcHJlc2VudCA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKCdhdS5hbGVydElzUHJlc2VudCgpJyk7XG4gIGlmICghcHJlc2VudCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZygnQWxlcnQgcHJlc2VudCBiZWZvcmUgc3RhcnRpbmcgdGVzdCwgbGV0IHVzIGJhbmlzaCBpdCcpO1xuICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZCgnYXUuZGlzbWlzc0FsZXJ0KCknKTtcbiAgbG9nZ2VyLmRlYnVnKCdBbGVydCBiYW5pc2hlZCEnKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5oZWxwZXJzLnN0b3BSZW1vdGUgPSBhc3luYyBmdW5jdGlvbiAoY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nID0gZmFsc2UpIHtcbiAgaWYgKCF0aGlzLnJlbW90ZSkge1xuICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdUcmllZCB0byBsZWF2ZSBhIHdlYiBmcmFtZSBidXQgd2VyZSBub3QgaW4gb25lJyk7XG4gIH1cblxuICBpZiAoY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nKSB7XG4gICAgYXdhaXQgdGhpcy5jbG9zZVdpbmRvdygpO1xuICB9XG4gIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgdGhpcy5jdXJXZWJGcmFtZXMgPSBbXTtcbiAgdGhpcy5jdXJXZWJDb29yZHMgPSBudWxsO1xuICB0aGlzLnJlbW90ZSA9IG51bGw7XG59O1xuXG5oZWxwZXJzLmlzV2ViQ29udGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuICEhdGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTjtcbn07XG5cbmhlbHBlcnMuc2V0Q3VycmVudFVybCA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgdGhpcy5fY3VycmVudFVybCA9IHVybDtcbn07XG5cbmhlbHBlcnMuZ2V0Q3VycmVudFVybCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMuX2N1cnJlbnRVcmw7XG59O1xuXG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMsIE5BVElWRV9XSU4sIFdFQlZJRVdfV0lOLCBXRUJWSUVXX0JBU0UgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
