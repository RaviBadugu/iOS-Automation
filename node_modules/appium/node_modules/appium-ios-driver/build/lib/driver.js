"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.defaultServerCaps = exports.IosDriver = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _appiumBaseDriver = require("appium-base-driver");

var utils = _interopRequireWildcard(require("./utils"));

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumSupport = require("appium-support");

var _appiumIosSimulator = require("appium-ios-simulator");

var _uiauto = require("./uiauto/uiauto");

var _instruments = require("./instruments");

var _asyncbox = require("asyncbox");

var _index = _interopRequireDefault(require("./commands/index"));

var _desiredCaps = require("./desired-caps");

var _nodeIdevice = _interopRequireDefault(require("node-idevice"));

var _safari = require("./commands/safari");

var _safariLauncher = require("./safari-launcher");

var _settings = require("./settings");

var _device = require("./device");

var _iwdp = require("./iwdp");

let iDevice = function iDevice(...args) {
  let device = (0, _nodeIdevice.default)(...args);
  let promisified = {};
  var _arr = ['install', 'installAndWait', 'remove', 'isInstalled'];

  for (var _i = 0; _i < _arr.length; _i++) {
    let m = _arr[_i];
    promisified[m] = _bluebird.default.promisify(device[m].bind(device));
  }

  return promisified;
};

const defaultServerCaps = {
  webStorageEnabled: false,
  locationContextEnabled: false,
  browserName: '',
  platform: 'MAC',
  javascriptEnabled: true,
  databaseEnabled: false,
  takesScreenshot: true,
  networkConnectionEnabled: false
};
exports.defaultServerCaps = defaultServerCaps;
const LOG_LOCATIONS = [_path.default.resolve('/', 'Library', 'Caches', 'com.apple.dt.instruments')];

if (process.env.HOME) {
  LOG_LOCATIONS.push(_path.default.resolve(process.env.HOME, 'Library', 'Logs', 'CoreSimulator'));
}

class IosDriver extends _appiumBaseDriver.BaseDriver {
  resetIos() {
    this.appExt = ".app";
    this.xcodeVersion = null;
    this.iosSdkVersion = null;
    this.logs = {};
    this.instruments = null;
    this.uiAutoClient = null;

    this.onInstrumentsDie = function () {};

    this.stopping = false;
    this.cbForCurrentCmd = null;
    this.remote = null;
    this.curContext = null;
    this.curWebFrames = [];
    this.selectingNewPage = false;
    this.windowHandleCache = [];
    this.webElementIds = [];
    this.implicitWaitMs = 0;
    this.asynclibWaitMs = 0;
    this.pageLoadMs = 6000;
    this.asynclibResponseCb = null;
    this.returnedFromExecuteAtom = {};
    this.executedAtomsCounter = 0;
    this.curCoords = null;
    this.curWebCoords = null;
    this.landscapeWebCoordsOffset = 0;
    this.keepAppToRetainPrefs = false;
    this.ready = false;
    this.asyncWaitMs = 0;
    this.settings = new _appiumBaseDriver.DeviceSettings({}, _lodash.default.noop);
    this.locatorStrategies = ['xpath', 'id', 'class name', '-ios uiautomation', 'accessibility id'];
    this.webLocatorStrategies = ['link text', 'css selector', 'tag name', 'partial link text'];
  }

  constructor(opts, shouldValidateCaps) {
    super(opts, shouldValidateCaps);
    this.desiredCapConstraints = _desiredCaps.desiredCapConstraints;
    this.resetIos();
    this.getDevicePixelRatio = _lodash.default.memoize(this.getDevicePixelRatio);
  }

  validateLocatorStrategy(strategy) {
    super.validateLocatorStrategy(strategy, this.isWebContext());
  }

  start() {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this.isRealDevice()) {
        yield _this.startRealDevice();
      } else {
        yield _this.startSimulator();
      }

      _this.ready = true;
    })();
  }

  createSession(...args) {
    var _this2 = this,
        _superprop_callCreateSession = (..._args) => super.createSession(..._args);

    return (0, _asyncToGenerator2.default)(function* () {
      let _ref = yield _superprop_callCreateSession(...args),
          _ref2 = (0, _slicedToArray2.default)(_ref, 2),
          sessionId = _ref2[0],
          caps = _ref2[1];

      _this2.xcodeVersion = yield utils.getAndCheckXcodeVersion(_this2.opts);

      _logger.default.debug(`Xcode version set to ${_this2.xcodeVersion.versionString}`);

      if (_this2.xcodeVersion.major >= 8) {
        let msg = `Appium's IosDriver does not support Xcode version ${_this2.xcodeVersion.versionString}. ` + 'Apple has deprecated UIAutomation. Use the "XCUITest" automationName capability instead.';

        _logger.default.errorAndThrow(new _appiumBaseDriver.errors.SessionNotCreatedError(msg));
      }

      _this2.caps = Object.assign({}, defaultServerCaps, _this2.caps);
      _this2.caps.desired = caps;
      yield utils.detectUdid(_this2.opts);
      yield utils.prepareIosOpts(_this2.opts);
      _this2.realDevice = null;
      _this2.useRobot = _this2.opts.useRobot;
      _this2.safari = _this2.opts.safari;
      _this2.opts.curOrientation = _this2.opts.initialOrientation;
      _this2.sock = _path.default.resolve(_this2.opts.tmpDir || '/tmp', 'instruments_sock');

      try {
        yield _this2.configureApp();
      } catch (err) {
        _logger.default.error(`Bad app: '${_this2.opts.app}'. App paths need to ` + `be absolute, or relative to the appium server ` + `install dir, or a URL to compressed file, or a ` + `special app name.`);

        throw err;
      }

      yield _this2.start();

      _this2.startNewCommandTimeout('createSession');

      return [sessionId, _this2.caps];
    })();
  }

  stop() {
    var _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this3.ready = false;

      if (_this3.uiAutoClient) {
        yield _this3.uiAutoClient.shutdown();
      }

      if (_this3.instruments) {
        try {
          yield _this3.instruments.shutdown();
        } catch (err) {
          _logger.default.error(`Instruments didn't shut down. ${err}`);
        }
      }

      if (_this3.caps && _this3.caps.customSSLCert && !_this3.isRealDevice()) {
        _logger.default.debug(`Uninstalling ssl certificate for udid '${_this3.sim.udid}'`);

        yield (0, _appiumIosSimulator.uninstallSSLCert)(_this3.caps.customSSLCert, _this3.sim.udid);
      }

      if (_this3.opts.enableAsyncExecuteFromHttps && !_this3.isRealDevice()) {
        yield _this3.stopHttpsAsyncServer();
      }

      _this3.uiAutoClient = null;
      _this3.instruments = null;
      _this3.realDevice = null;
      _this3.curCoords = null;
      _this3.opts.curOrientation = null;

      if (!_lodash.default.isEmpty(_this3.logs)) {
        yield _this3.logs.syslog.stopCapture();
        _this3.logs = {};
      }

      if (_this3.remote) {
        yield _this3.stopRemote();
      }

      yield _this3.stopIWDP();
    })();
  }

  deleteSession() {
    var _this4 = this,
        _superprop_callDeleteSession = (..._args2) => super.deleteSession(..._args2);

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug("Deleting ios session");

      yield _this4.stop();

      if (_this4.opts.clearSystemFiles) {
        yield utils.clearLogs(LOG_LOCATIONS);
      } else {
        _logger.default.debug('Not clearing log files. Use `clearSystemFiles` capability to turn on.');
      }

      if (_this4.isRealDevice()) {
        yield (0, _device.runRealDeviceReset)(_this4.realDevice, _this4.opts);
      } else {
        yield (0, _device.runSimulatorReset)(_this4.sim, _this4.opts, _this4.keepAppToRetainPrefs);
      }

      yield _superprop_callDeleteSession();
    })();
  }

  getSession() {
    var _this5 = this,
        _superprop_callGetSession = (..._args3) => super.getSession(..._args3);

    return (0, _asyncToGenerator2.default)(function* () {
      let caps = yield _superprop_callGetSession();
      const viewportRect = yield _this5.getViewportRect();
      const pixelRatio = yield _this5.getDevicePixelRatio();
      const statBarHeight = yield _this5.getStatusBarHeight();
      caps.viewportRect = viewportRect;
      caps.pixelRatio = pixelRatio;
      caps.statBarHeight = statBarHeight;
      return caps;
    })();
  }

  executeCommand(cmd, ...args) {
    var _this6 = this,
        _superprop_callExecuteCommand = (..._args4) => super.executeCommand(..._args4);

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug(`Executing iOS command '${cmd}'`);

      if (cmd === 'receiveAsyncResponse') {
        return yield _this6.receiveAsyncResponse(...args);
      } else if (_this6.ready || _lodash.default.includes(['launchApp'], cmd)) {
        return yield _superprop_callExecuteCommand(cmd, ...args);
      }

      throw new _appiumBaseDriver.errors.NoSuchDriverError(`Driver is not ready, cannot execute ${cmd}.`);
    })();
  }

  configureApp() {
    var _this7 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      try {
        if (!_this7.opts.bundleId && utils.appIsPackageOrBundle(_this7.opts.app)) {
          _this7.opts.bundleId = _this7.opts.app;
        }

        if (_this7.opts.app && _this7.opts.app.toLowerCase() === "settings") {
          if (parseFloat(_this7.opts.platformVersion) >= 8) {
            _logger.default.debug("We are on iOS8+ so not copying preferences app");

            _this7.opts.bundleId = "com.apple.Preferences";
            _this7.opts.app = null;
          }
        } else if (_this7.opts.app && _this7.opts.app.toLowerCase() === "calendar") {
          if (parseFloat(_this7.opts.platformVersion) >= 8) {
            _logger.default.debug("We are on iOS8+ so not copying calendar app");

            _this7.opts.bundleId = "com.apple.mobilecal";
            _this7.opts.app = null;
          }
        } else if (_this7.isSafari()) {
          if (!_this7.isRealDevice()) {
            if (parseFloat(_this7.opts.platformVersion) >= 8) {
              _logger.default.debug("We are on iOS8+ so not copying Safari app");

              _this7.opts.bundleId = _safari.SAFARI_BUNDLE;
              _this7.opts.app = null;
            }
          } else {
            if (!(yield _this7.realDevice.isInstalled(_this7.opts.bundleId))) {
              if (yield (0, _safariLauncher.needsInstall)()) {
                _logger.default.debug('SafariLauncher not found, building...');

                yield (0, _safariLauncher.install)();
              }

              _this7.opts.bundleId = _safariLauncher.SAFARI_LAUNCHER_BUNDLE;
            }
          }
        } else if (_this7.opts.bundleId && utils.appIsPackageOrBundle(_this7.opts.bundleId) && (_this7.opts.app === "" || utils.appIsPackageOrBundle(_this7.opts.app))) {
          _logger.default.debug("App is an iOS bundle, will attempt to run as pre-existing");
        } else {
          _this7.opts.app = yield _this7.helpers.configureApp(_this7.opts.app, '.app');
        }
      } catch (err) {
        _logger.default.error(err);

        throw new Error(`Bad app: ${_this7.opts.app}. App paths need to be absolute, or relative to the appium ` + "server install dir, or a URL to compressed file, or a special app name.");
      }
    })();
  }

  startSimulator() {
    var _this8 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield utils.removeInstrumentsSocket(_this8.sock);

      if (!_this8.xcodeVersion) {
        _logger.default.debug("Setting Xcode version");

        _this8.xcodeVersion = yield utils.getAndCheckXcodeVersion(_this8.opts);

        _logger.default.debug(`Xcode version set to ${_this8.xcodeVersion.versionString}`);
      }

      _logger.default.debug("Setting iOS SDK Version");

      _this8.iosSdkVersion = yield utils.getAndCheckIosSdkVersion();

      _logger.default.debug(`iOS SDK Version set to ${_this8.iosSdkVersion}`);

      let timeout = _lodash.default.isObject(_this8.opts.launchTimeout) ? _this8.opts.launchTimeout.global : _this8.opts.launchTimeout;
      let availableDevices = yield (0, _asyncbox.retry)(3, _instruments.instrumentsUtils.getAvailableDevices, timeout);
      let iosSimUdid = yield (0, _device.checkSimulatorAvailable)(_this8.opts, _this8.iosSdkVersion, availableDevices);
      _this8.sim = yield (0, _appiumIosSimulator.getSimulator)(iosSimUdid, _this8.xcodeVersion.versionString);
      yield (0, _device.moveBuiltInApp)(_this8.sim);
      _this8.opts.localizableStrings = yield utils.parseLocalizableStrings(_this8.opts);
      yield utils.setBundleIdFromApp(_this8.opts);
      yield _this8.createInstruments();
      {
        _this8.shouldPrelaunchSimulator = utils.shouldPrelaunchSimulator(_this8.opts, _this8.iosSdkVersion);
        let dString = yield (0, _device.getAdjustedDeviceName)(_this8.opts);

        if (_this8.caps.app) {
          yield utils.setDeviceTypeInInfoPlist(_this8.opts.app, dString);
        }
      }
      yield (0, _device.runSimulatorReset)(_this8.sim, _this8.opts, _this8.keepAppToRetainPrefs);

      if (_this8.caps.customSSLCert && !_this8.isRealDevice()) {
        yield (0, _appiumIosSimulator.installSSLCert)(_this8.caps.customSSLCert, _this8.sim.udid);
      }

      if (_this8.opts.enableAsyncExecuteFromHttps && !_this8.isRealDevice()) {
        yield _this8.startHttpsAsyncServer();
      }

      yield (0, _device.isolateSimulatorDevice)(_this8.sim, _this8.opts);
      _this8.localConfig = yield (0, _settings.setLocaleAndPreferences)(_this8.sim, _this8.opts, _this8.isSafari(), _device.endSimulator);
      yield _this8.startLogCapture(_this8.sim);
      yield _this8.prelaunchSimulator();
      yield _this8.startInstruments();
      yield _this8.onInstrumentsLaunch();
      yield _this8.configureBootstrap();
      yield _this8.setBundleId();
      yield _this8.setInitialOrientation();
      yield _this8.initAutoWebview();
      yield _this8.waitForAppLaunched();
    })();
  }

  startRealDevice() {
    var _this9 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield utils.removeInstrumentsSocket(_this9.sock);
      _this9.opts.localizableStrings = yield utils.parseLocalizableStrings(_this9.opts);
      yield utils.setBundleIdFromApp(_this9.opts);
      yield _this9.createInstruments();
      yield (0, _device.runRealDeviceReset)(_this9.realDevice, _this9.opts);
      yield _this9.startLogCapture();
      yield _this9.installToRealDevice();
      yield _this9.startInstruments();
      yield _this9.onInstrumentsLaunch();
      yield _this9.configureBootstrap();
      yield _this9.setBundleId();
      yield _this9.setInitialOrientation();
      yield _this9.initAutoWebview();
      yield _this9.waitForAppLaunched();
    })();
  }

  installToRealDevice() {
    var _this10 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this10.opts.autoLaunch === false) {
        return;
      }

      if (_this10.opts.app) {
        let ext = _this10.opts.app.substring(_this10.opts.app.length - 3).toLowerCase();

        if (ext === 'ipa') {
          _this10.opts.ipa = _this10.opts.app;
        }
      }

      if (_this10.opts.udid) {
        if (yield _this10.realDevice.isInstalled(_this10.opts.bundleId)) {
          _logger.default.debug("App is installed.");

          if (_this10.opts.fullReset) {
            _logger.default.debug("fullReset requested. Forcing app install.");
          } else {
            _logger.default.debug("fullReset not requested. No need to install.");

            return;
          }
        } else {
          _logger.default.debug("App is not installed. Will try to install.");
        }

        if (_this10.opts.ipa && _this10.opts.bundleId) {
          yield _this10.installIpa();

          _logger.default.debug('App installed.');
        } else if (_this10.opts.ipa) {
          let msg = "You specified a UDID and ipa but did not include the bundle id";

          _logger.default.warn(msg);

          throw new _appiumBaseDriver.errors.UnknownError(msg);
        } else if (_this10.opts.app) {
          yield _this10.realDevice.install(_this10.opts.app);

          _logger.default.debug('App installed.');
        } else {
          _logger.default.debug("Real device specified but no ipa or app path, assuming bundle ID is " + "on device");
        }
      } else {
        _logger.default.debug("No device id or app, not installing to real device.");
      }
    })();
  }

  getIDeviceObj() {
    let idiPath = _path.default.resolve(__dirname, "../../../build/", "libimobiledevice-macosx/ideviceinstaller");

    _logger.default.debug(`Creating iDevice object with udid ${this.opts.udid}`);

    try {
      return iDevice(this.opts.udid);
    } catch (e1) {
      _logger.default.debug(`Couldn't find ideviceinstaller, trying built-in at ${idiPath}`);

      try {
        return iDevice(this.opts.udid, {
          cmd: idiPath
        });
      } catch (e2) {
        let msg = "Could not initialize ideviceinstaller; make sure it is " + "installed and works on your system";

        _logger.default.error(msg);

        throw new Error(msg);
      }
    }
  }

  installIpa() {
    var _this11 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug(`Installing ipa found at ${_this11.opts.ipa}`);

      if (yield _this11.realDevice.isInstalled(_this11.opts.bundleId)) {
        _logger.default.debug("Bundle found on device, removing before reinstalling.");

        yield _this11.realDevice.remove(_this11.opts.bundleId);
      } else {
        _logger.default.debug("Nothing found on device, going ahead and installing.");
      }

      yield _this11.realDevice.installAndWait(_this11.opts.ipa, _this11.opts.bundleId);
    })();
  }

  validateDesiredCaps(caps) {
    let res = super.validateDesiredCaps(caps);
    if (!res) return res;
    return (0, _desiredCaps.desiredCapValidation)(caps);
  }

  prelaunchSimulator() {
    var _this12 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (!_this12.shouldPrelaunchSimulator) {
        _logger.default.debug("Not pre-launching simulator");

        return;
      }

      yield (0, _device.endSimulator)(_this12.sim);
    })();
  }

  onInstrumentsLaunch() {
    var _this13 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug('Instruments launched. Starting poll loop for new commands.');

      if (_this13.opts.origAppPath) {
        _logger.default.debug("Copying app back to its original place");

        return yield _appiumSupport.fs.copyFile(_this13.opts.app, _this13.opts.origAppPath);
      }
    })();
  }

  setBundleId() {
    var _this14 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this14.opts.bundleId) {
        return;
      } else {
        let bId = yield _this14.uiAutoClient.sendCommand('au.bundleId()');

        _logger.default.debug(`Bundle ID for open app is ${bId.value}`);

        _this14.opts.bundleId = bId.value;
      }
    })();
  }

  startIWDP() {
    var _this15 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this15.opts.startIWDP) {
        _this15.iwdpServer = new _iwdp.IWDP(_this15.opts.webkitDebugProxyPort, _this15.opts.udid);
        yield _this15.iwdpServer.start();
      }
    })();
  }

  stopIWDP() {
    var _this16 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this16.iwdpServer) {
        yield _this16.iwdpServer.stop();
        delete _this16.iwdpServer;
      }
    })();
  }

  setInitialOrientation() {
    var _this17 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_lodash.default.isString(_this17.opts.initialOrientation) && _lodash.default.includes(["LANDSCAPE", "PORTRAIT"], _this17.opts.initialOrientation.toUpperCase())) {
        _logger.default.debug(`Setting initial orientation to ${_this17.opts.initialOrientation}`);

        let command = `au.setScreenOrientation('${_this17.opts.initialOrientation.toUpperCase()}')`;

        try {
          yield _this17.uiAutoClient.sendCommand(command);
          _this17.opts.curOrientation = _this17.opts.initialOrientation;
        } catch (err) {
          _logger.default.warn(`Setting initial orientation failed with: ${err}`);
        }
      }
    })();
  }

  isRealDevice() {
    return !!this.opts.udid;
  }

  isSafari() {
    return this.opts.safari;
  }

  waitForAppLaunched() {
    var _this18 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let condFn;

      if (_this18.opts.waitForAppScript) {
        _logger.default.debug(`Using custom script to wait for app start: ${_this18.opts.waitForAppScript}`);

        condFn = function () {
          var _ref3 = (0, _asyncToGenerator2.default)(function* () {
            let res;

            try {
              res = yield _this18.uiAutoClient.sendCommand(`try{\n${_this18.opts.waitForAppScript}` + `\n} catch(err) { $.log("waitForAppScript err: " + error); false; };`);
            } catch (err) {
              _logger.default.debug(`Cannot eval waitForAppScript script, err: ${err}`);

              return false;
            }

            if (typeof res !== 'boolean') {
              _logger.default.debug('Unexpected return type in waitForAppScript script');

              return false;
            }

            return res;
          });

          return function condFn() {
            return _ref3.apply(this, arguments);
          };
        }();
      } else if (_this18.isSafari()) {
        if (_this18.isRealDevice()) {
          yield _this18.clickButtonToLaunchSafari();
        }

        _logger.default.debug('Waiting for initial webview');

        yield _this18.navToInitialWebview();

        condFn = function () {
          var _ref4 = (0, _asyncToGenerator2.default)(function* () {
            return true;
          });

          return function condFn() {
            return _ref4.apply(this, arguments);
          };
        }();
      } else {
        _logger.default.debug("Waiting for app source to contain elements");

        condFn = function () {
          var _ref5 = (0, _asyncToGenerator2.default)(function* () {
            try {
              let source = yield _this18.getSourceForElementForXML();
              source = JSON.parse(source || "{}");
              let appEls = (source.UIAApplication || {})['>'];
              return appEls && appEls.length > 0 && !IosDriver.isSpringBoard(source.UIAApplication);
            } catch (e) {
              _logger.default.warn(`Couldn't extract app element from source, error was: ${e}`);

              return false;
            }
          });

          return function condFn() {
            return _ref5.apply(this, arguments);
          };
        }();
      }

      try {
        yield (0, _asyncbox.waitForCondition)(condFn, {
          logger: _logger.default,
          waitMs: 10000,
          intervalMs: 500
        });
      } catch (err) {
        if (err.message && err.message.match(/Condition unmet/)) {
          _logger.default.warn('Initial spin timed out, continuing but the app might not be ready.');

          _logger.default.debug(`Initial spin error was: ${err}`);
        } else {
          throw err;
        }
      }
    })();
  }

  static isSpringBoard(uiAppObj) {
    return _lodash.default.propertyOf(uiAppObj['@'])('name') === 'SpringBoard';
  }

  createInstruments() {
    var _this19 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug("Creating instruments");

      _this19.uiAutoClient = new _uiauto.UIAutoClient(_this19.sock);
      _this19.instruments = yield _this19.makeInstruments();

      _this19.instruments.onShutdown.catch((0, _asyncToGenerator2.default)(function* () {
        yield _this19.startUnexpectedShutdown(new _appiumBaseDriver.errors.UnknownError('Abnormal Instruments termination!'));
      })).done();
    })();
  }

  shouldIgnoreInstrumentsExit() {
    return this.safari && this.isRealDevice();
  }

  makeInstruments() {
    var _this20 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let bootstrapPath = yield (0, _uiauto.prepareBootstrap)({
        sock: _this20.sock,
        interKeyDelay: _this20.opts.interKeyDelay,
        justLoopInfinitely: false,
        autoAcceptAlerts: _this20.opts.autoAcceptAlerts,
        autoDismissAlerts: _this20.opts.autoDismissAlerts,
        sendKeyStrategy: _this20.opts.sendKeyStrategy || (_this20.isRealDevice() ? 'grouped' : 'oneByOne')
      });
      let instruments = new _instruments.Instruments({
        app: (!_this20.isRealDevice() ? _this20.opts.app : null) || _this20.opts.bundleId,
        udid: _this20.opts.udid,
        processArguments: _this20.opts.processArguments,
        ignoreStartupExit: _this20.shouldIgnoreInstrumentsExit(),
        bootstrap: bootstrapPath,
        template: _this20.opts.automationTraceTemplatePath,
        instrumentsPath: _this20.opts.instrumentsPath,
        withoutDelay: _this20.opts.withoutDelay,
        platformVersion: _this20.opts.platformVersion,
        webSocket: _this20.opts.webSocket,
        launchTimeout: _this20.opts.launchTimeout,
        flakeyRetries: _this20.opts.backendRetries,
        realDevice: _this20.isRealDevice(),
        simulatorSdkAndDevice: _this20.iosSdkVersion >= 7.1 ? yield (0, _device.getAdjustedDeviceName)(_this20.opts) : null,
        tmpDir: _path.default.resolve(_this20.opts.tmpDir || '/tmp', 'appium-instruments'),
        traceDir: _this20.opts.traceDir,
        locale: _this20.opts.locale,
        language: _this20.opts.language
      });
      return instruments;
    })();
  }

  startInstruments() {
    var _this21 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug("Starting UIAutoClient, and launching Instruments.");

      yield _bluebird.default.all([_this21.uiAutoClient.start().then(() => {
        _this21.instruments.registerLaunch();
      }), _this21.instruments.launch()]);
    })();
  }

  configureBootstrap() {
    var _this22 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug("Setting bootstrap config keys/values");

      let isVerbose = true;
      let cmd = 'target = $.target();\n';
      cmd += 'au = $;\n';
      cmd += `$.isVerbose = ${isVerbose};\n`;
      yield _this22.uiAutoClient.sendCommand(cmd);
    })();
  }

  getSourceForElementForXML(ctx) {
    var _this23 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let source;

      if (!ctx) {
        source = yield _this23.uiAutoClient.sendCommand("au.mainApp().getTreeForXML()");
      } else {
        source = yield _this23.uiAutoClient.sendCommand(`au.getElement('${ctx}').getTreeForXML()`);
      }

      if (source) {
        return JSON.stringify(source);
      } else {
        throw new Error(`Bad response from getTreeForXML. res was ${JSON.stringify(source)}`);
      }
    })();
  }

  get realDevice() {
    this._realDevice = this._realDevice || this.getIDeviceObj();
    return this._realDevice;
  }

  set realDevice(rd) {
    this._realDevice = rd;
  }

}

exports.IosDriver = IosDriver;
var _iteratorNormalCompletion = true;
var _didIteratorError = false;
var _iteratorError = undefined;

try {
  for (var _iterator = _lodash.default.toPairs(_index.default)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
    let _step$value = (0, _slicedToArray2.default)(_step.value, 2),
        cmd = _step$value[0],
        fn = _step$value[1];

    IosDriver.prototype[cmd] = fn;
  }
} catch (err) {
  _didIteratorError = true;
  _iteratorError = err;
} finally {
  try {
    if (!_iteratorNormalCompletion && _iterator.return != null) {
      _iterator.return();
    }
  } finally {
    if (_didIteratorError) {
      throw _iteratorError;
    }
  }
}

var _default = IosDriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kcml2ZXIuanMiXSwibmFtZXMiOlsiaURldmljZSIsImFyZ3MiLCJkZXZpY2UiLCJwcm9taXNpZmllZCIsIm0iLCJCIiwicHJvbWlzaWZ5IiwiYmluZCIsImRlZmF1bHRTZXJ2ZXJDYXBzIiwid2ViU3RvcmFnZUVuYWJsZWQiLCJsb2NhdGlvbkNvbnRleHRFbmFibGVkIiwiYnJvd3Nlck5hbWUiLCJwbGF0Zm9ybSIsImphdmFzY3JpcHRFbmFibGVkIiwiZGF0YWJhc2VFbmFibGVkIiwidGFrZXNTY3JlZW5zaG90IiwibmV0d29ya0Nvbm5lY3Rpb25FbmFibGVkIiwiTE9HX0xPQ0FUSU9OUyIsInBhdGgiLCJyZXNvbHZlIiwicHJvY2VzcyIsImVudiIsIkhPTUUiLCJwdXNoIiwiSW9zRHJpdmVyIiwiQmFzZURyaXZlciIsInJlc2V0SW9zIiwiYXBwRXh0IiwieGNvZGVWZXJzaW9uIiwiaW9zU2RrVmVyc2lvbiIsImxvZ3MiLCJpbnN0cnVtZW50cyIsInVpQXV0b0NsaWVudCIsIm9uSW5zdHJ1bWVudHNEaWUiLCJzdG9wcGluZyIsImNiRm9yQ3VycmVudENtZCIsInJlbW90ZSIsImN1ckNvbnRleHQiLCJjdXJXZWJGcmFtZXMiLCJzZWxlY3RpbmdOZXdQYWdlIiwid2luZG93SGFuZGxlQ2FjaGUiLCJ3ZWJFbGVtZW50SWRzIiwiaW1wbGljaXRXYWl0TXMiLCJhc3luY2xpYldhaXRNcyIsInBhZ2VMb2FkTXMiLCJhc3luY2xpYlJlc3BvbnNlQ2IiLCJyZXR1cm5lZEZyb21FeGVjdXRlQXRvbSIsImV4ZWN1dGVkQXRvbXNDb3VudGVyIiwiY3VyQ29vcmRzIiwiY3VyV2ViQ29vcmRzIiwibGFuZHNjYXBlV2ViQ29vcmRzT2Zmc2V0Iiwia2VlcEFwcFRvUmV0YWluUHJlZnMiLCJyZWFkeSIsImFzeW5jV2FpdE1zIiwic2V0dGluZ3MiLCJEZXZpY2VTZXR0aW5ncyIsIl8iLCJub29wIiwibG9jYXRvclN0cmF0ZWdpZXMiLCJ3ZWJMb2NhdG9yU3RyYXRlZ2llcyIsImNvbnN0cnVjdG9yIiwib3B0cyIsInNob3VsZFZhbGlkYXRlQ2FwcyIsImRlc2lyZWRDYXBDb25zdHJhaW50cyIsImdldERldmljZVBpeGVsUmF0aW8iLCJtZW1vaXplIiwidmFsaWRhdGVMb2NhdG9yU3RyYXRlZ3kiLCJzdHJhdGVneSIsImlzV2ViQ29udGV4dCIsInN0YXJ0IiwiaXNSZWFsRGV2aWNlIiwic3RhcnRSZWFsRGV2aWNlIiwic3RhcnRTaW11bGF0b3IiLCJjcmVhdGVTZXNzaW9uIiwic2Vzc2lvbklkIiwiY2FwcyIsInV0aWxzIiwiZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24iLCJsb2dnZXIiLCJkZWJ1ZyIsInZlcnNpb25TdHJpbmciLCJtYWpvciIsIm1zZyIsImVycm9yQW5kVGhyb3ciLCJlcnJvcnMiLCJTZXNzaW9uTm90Q3JlYXRlZEVycm9yIiwiT2JqZWN0IiwiYXNzaWduIiwiZGVzaXJlZCIsImRldGVjdFVkaWQiLCJwcmVwYXJlSW9zT3B0cyIsInJlYWxEZXZpY2UiLCJ1c2VSb2JvdCIsInNhZmFyaSIsImN1ck9yaWVudGF0aW9uIiwiaW5pdGlhbE9yaWVudGF0aW9uIiwic29jayIsInRtcERpciIsImNvbmZpZ3VyZUFwcCIsImVyciIsImVycm9yIiwiYXBwIiwic3RhcnROZXdDb21tYW5kVGltZW91dCIsInN0b3AiLCJzaHV0ZG93biIsImN1c3RvbVNTTENlcnQiLCJzaW0iLCJ1ZGlkIiwiZW5hYmxlQXN5bmNFeGVjdXRlRnJvbUh0dHBzIiwic3RvcEh0dHBzQXN5bmNTZXJ2ZXIiLCJpc0VtcHR5Iiwic3lzbG9nIiwic3RvcENhcHR1cmUiLCJzdG9wUmVtb3RlIiwic3RvcElXRFAiLCJkZWxldGVTZXNzaW9uIiwiY2xlYXJTeXN0ZW1GaWxlcyIsImNsZWFyTG9ncyIsImdldFNlc3Npb24iLCJ2aWV3cG9ydFJlY3QiLCJnZXRWaWV3cG9ydFJlY3QiLCJwaXhlbFJhdGlvIiwic3RhdEJhckhlaWdodCIsImdldFN0YXR1c0JhckhlaWdodCIsImV4ZWN1dGVDb21tYW5kIiwiY21kIiwicmVjZWl2ZUFzeW5jUmVzcG9uc2UiLCJpbmNsdWRlcyIsIk5vU3VjaERyaXZlckVycm9yIiwiYnVuZGxlSWQiLCJhcHBJc1BhY2thZ2VPckJ1bmRsZSIsInRvTG93ZXJDYXNlIiwicGFyc2VGbG9hdCIsInBsYXRmb3JtVmVyc2lvbiIsImlzU2FmYXJpIiwiU0FGQVJJX0JVTkRMRSIsImlzSW5zdGFsbGVkIiwiU0FGQVJJX0xBVU5DSEVSX0JVTkRMRSIsImhlbHBlcnMiLCJFcnJvciIsInJlbW92ZUluc3RydW1lbnRzU29ja2V0IiwiZ2V0QW5kQ2hlY2tJb3NTZGtWZXJzaW9uIiwidGltZW91dCIsImlzT2JqZWN0IiwibGF1bmNoVGltZW91dCIsImdsb2JhbCIsImF2YWlsYWJsZURldmljZXMiLCJpbnN0cnVtZW50c1V0aWxzIiwiZ2V0QXZhaWxhYmxlRGV2aWNlcyIsImlvc1NpbVVkaWQiLCJsb2NhbGl6YWJsZVN0cmluZ3MiLCJwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyIsInNldEJ1bmRsZUlkRnJvbUFwcCIsImNyZWF0ZUluc3RydW1lbnRzIiwic2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yIiwiZFN0cmluZyIsInNldERldmljZVR5cGVJbkluZm9QbGlzdCIsInN0YXJ0SHR0cHNBc3luY1NlcnZlciIsImxvY2FsQ29uZmlnIiwiZW5kU2ltdWxhdG9yIiwic3RhcnRMb2dDYXB0dXJlIiwicHJlbGF1bmNoU2ltdWxhdG9yIiwic3RhcnRJbnN0cnVtZW50cyIsIm9uSW5zdHJ1bWVudHNMYXVuY2giLCJjb25maWd1cmVCb290c3RyYXAiLCJzZXRCdW5kbGVJZCIsInNldEluaXRpYWxPcmllbnRhdGlvbiIsImluaXRBdXRvV2VidmlldyIsIndhaXRGb3JBcHBMYXVuY2hlZCIsImluc3RhbGxUb1JlYWxEZXZpY2UiLCJhdXRvTGF1bmNoIiwiZXh0Iiwic3Vic3RyaW5nIiwibGVuZ3RoIiwiaXBhIiwiZnVsbFJlc2V0IiwiaW5zdGFsbElwYSIsIndhcm4iLCJVbmtub3duRXJyb3IiLCJpbnN0YWxsIiwiZ2V0SURldmljZU9iaiIsImlkaVBhdGgiLCJfX2Rpcm5hbWUiLCJlMSIsImUyIiwicmVtb3ZlIiwiaW5zdGFsbEFuZFdhaXQiLCJ2YWxpZGF0ZURlc2lyZWRDYXBzIiwicmVzIiwib3JpZ0FwcFBhdGgiLCJmcyIsImNvcHlGaWxlIiwiYklkIiwic2VuZENvbW1hbmQiLCJ2YWx1ZSIsInN0YXJ0SVdEUCIsIml3ZHBTZXJ2ZXIiLCJJV0RQIiwid2Via2l0RGVidWdQcm94eVBvcnQiLCJpc1N0cmluZyIsInRvVXBwZXJDYXNlIiwiY29tbWFuZCIsImNvbmRGbiIsIndhaXRGb3JBcHBTY3JpcHQiLCJjbGlja0J1dHRvblRvTGF1bmNoU2FmYXJpIiwibmF2VG9Jbml0aWFsV2VidmlldyIsInNvdXJjZSIsImdldFNvdXJjZUZvckVsZW1lbnRGb3JYTUwiLCJKU09OIiwicGFyc2UiLCJhcHBFbHMiLCJVSUFBcHBsaWNhdGlvbiIsImlzU3ByaW5nQm9hcmQiLCJlIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsIm1lc3NhZ2UiLCJtYXRjaCIsInVpQXBwT2JqIiwicHJvcGVydHlPZiIsIlVJQXV0b0NsaWVudCIsIm1ha2VJbnN0cnVtZW50cyIsIm9uU2h1dGRvd24iLCJjYXRjaCIsInN0YXJ0VW5leHBlY3RlZFNodXRkb3duIiwiZG9uZSIsInNob3VsZElnbm9yZUluc3RydW1lbnRzRXhpdCIsImJvb3RzdHJhcFBhdGgiLCJpbnRlcktleURlbGF5IiwianVzdExvb3BJbmZpbml0ZWx5IiwiYXV0b0FjY2VwdEFsZXJ0cyIsImF1dG9EaXNtaXNzQWxlcnRzIiwic2VuZEtleVN0cmF0ZWd5IiwiSW5zdHJ1bWVudHMiLCJwcm9jZXNzQXJndW1lbnRzIiwiaWdub3JlU3RhcnR1cEV4aXQiLCJib290c3RyYXAiLCJ0ZW1wbGF0ZSIsImF1dG9tYXRpb25UcmFjZVRlbXBsYXRlUGF0aCIsImluc3RydW1lbnRzUGF0aCIsIndpdGhvdXREZWxheSIsIndlYlNvY2tldCIsImZsYWtleVJldHJpZXMiLCJiYWNrZW5kUmV0cmllcyIsInNpbXVsYXRvclNka0FuZERldmljZSIsInRyYWNlRGlyIiwibG9jYWxlIiwibGFuZ3VhZ2UiLCJhbGwiLCJ0aGVuIiwicmVnaXN0ZXJMYXVuY2giLCJsYXVuY2giLCJpc1ZlcmJvc2UiLCJjdHgiLCJzdHJpbmdpZnkiLCJfcmVhbERldmljZSIsInJkIiwidG9QYWlycyIsImNvbW1hbmRzIiwiZm4iLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUlBLElBQUlBLE9BQU8sR0FBRyxTQUFWQSxPQUFVLENBQVUsR0FBR0MsSUFBYixFQUFtQjtBQUMvQixNQUFJQyxNQUFNLEdBQUcsMEJBQVMsR0FBR0QsSUFBWixDQUFiO0FBQ0EsTUFBSUUsV0FBVyxHQUFHLEVBQWxCO0FBRitCLGFBR2pCLENBQUMsU0FBRCxFQUFZLGdCQUFaLEVBQThCLFFBQTlCLEVBQXdDLGFBQXhDLENBSGlCOztBQUcvQiwyQ0FBc0U7QUFBakUsUUFBSUMsQ0FBQyxXQUFMO0FBQ0hELElBQUFBLFdBQVcsQ0FBQ0MsQ0FBRCxDQUFYLEdBQWlCQyxrQkFBRUMsU0FBRixDQUFZSixNQUFNLENBQUNFLENBQUQsQ0FBTixDQUFVRyxJQUFWLENBQWVMLE1BQWYsQ0FBWixDQUFqQjtBQUNEOztBQUNELFNBQU9DLFdBQVA7QUFDRCxDQVBEOztBQVNBLE1BQU1LLGlCQUFpQixHQUFHO0FBQ3hCQyxFQUFBQSxpQkFBaUIsRUFBRSxLQURLO0FBRXhCQyxFQUFBQSxzQkFBc0IsRUFBRSxLQUZBO0FBR3hCQyxFQUFBQSxXQUFXLEVBQUUsRUFIVztBQUl4QkMsRUFBQUEsUUFBUSxFQUFFLEtBSmM7QUFLeEJDLEVBQUFBLGlCQUFpQixFQUFFLElBTEs7QUFNeEJDLEVBQUFBLGVBQWUsRUFBRSxLQU5PO0FBT3hCQyxF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eyBCYXNlRHJpdmVyLCBEZXZpY2VTZXR0aW5ncywgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IGdldFNpbXVsYXRvciwgaW5zdGFsbFNTTENlcnQsIHVuaW5zdGFsbFNTTENlcnQgfSBmcm9tICdhcHBpdW0taW9zLXNpbXVsYXRvcic7XG5pbXBvcnQgeyBwcmVwYXJlQm9vdHN0cmFwLCBVSUF1dG9DbGllbnQgfSBmcm9tICcuL3VpYXV0by91aWF1dG8nO1xuaW1wb3J0IHsgSW5zdHJ1bWVudHMsIGluc3RydW1lbnRzVXRpbHMgfSBmcm9tICcuL2luc3RydW1lbnRzJztcbmltcG9ydCB7IHJldHJ5LCB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IGNvbW1hbmRzIGZyb20gJy4vY29tbWFuZHMvaW5kZXgnO1xuaW1wb3J0IHsgZGVzaXJlZENhcENvbnN0cmFpbnRzLCBkZXNpcmVkQ2FwVmFsaWRhdGlvbiB9IGZyb20gJy4vZGVzaXJlZC1jYXBzJztcbmltcG9ydCBfaURldmljZSBmcm9tICdub2RlLWlkZXZpY2UnO1xuaW1wb3J0IHsgU0FGQVJJX0JVTkRMRSB9IGZyb20gJy4vY29tbWFuZHMvc2FmYXJpJztcbmltcG9ydCB7IGluc3RhbGwsIG5lZWRzSW5zdGFsbCwgU0FGQVJJX0xBVU5DSEVSX0JVTkRMRSB9IGZyb20gJy4vc2FmYXJpLWxhdW5jaGVyJztcbmltcG9ydCB7IHNldExvY2FsZUFuZFByZWZlcmVuY2VzIH0gZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBydW5TaW11bGF0b3JSZXNldCwgaXNvbGF0ZVNpbXVsYXRvckRldmljZSwgY2hlY2tTaW11bGF0b3JBdmFpbGFibGUsXG4gICAgICAgICBtb3ZlQnVpbHRJbkFwcCwgZ2V0QWRqdXN0ZWREZXZpY2VOYW1lLCBlbmRTaW11bGF0b3IsIHJ1blJlYWxEZXZpY2VSZXNldCB9IGZyb20gJy4vZGV2aWNlJztcbmltcG9ydCB7IElXRFAgfSBmcm9tICcuL2l3ZHAnO1xuXG5cbi8vIHByb21pc2lmeSBfaURldmljZVxubGV0IGlEZXZpY2UgPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICBsZXQgZGV2aWNlID0gX2lEZXZpY2UoLi4uYXJncyk7XG4gIGxldCBwcm9taXNpZmllZCA9IHt9O1xuICBmb3IgKGxldCBtIG9mIFsnaW5zdGFsbCcsICdpbnN0YWxsQW5kV2FpdCcsICdyZW1vdmUnLCAnaXNJbnN0YWxsZWQnXSkge1xuICAgIHByb21pc2lmaWVkW21dID0gQi5wcm9taXNpZnkoZGV2aWNlW21dLmJpbmQoZGV2aWNlKSk7XG4gIH1cbiAgcmV0dXJuIHByb21pc2lmaWVkO1xufTtcblxuY29uc3QgZGVmYXVsdFNlcnZlckNhcHMgPSB7XG4gIHdlYlN0b3JhZ2VFbmFibGVkOiBmYWxzZSxcbiAgbG9jYXRpb25Db250ZXh0RW5hYmxlZDogZmFsc2UsXG4gIGJyb3dzZXJOYW1lOiAnJyxcbiAgcGxhdGZvcm06ICdNQUMnLFxuICBqYXZhc2NyaXB0RW5hYmxlZDogdHJ1ZSxcbiAgZGF0YWJhc2VFbmFibGVkOiBmYWxzZSxcbiAgdGFrZXNTY3JlZW5zaG90OiB0cnVlLFxuICBuZXR3b3JrQ29ubmVjdGlvbkVuYWJsZWQ6IGZhbHNlLFxufTtcblxuY29uc3QgTE9HX0xPQ0FUSU9OUyA9IFtcbiAgcGF0aC5yZXNvbHZlKCcvJywgJ0xpYnJhcnknLCAnQ2FjaGVzJywgJ2NvbS5hcHBsZS5kdC5pbnN0cnVtZW50cycpLFxuXTtcbmlmIChwcm9jZXNzLmVudi5IT01FKSB7XG4gIExPR19MT0NBVElPTlMucHVzaChwYXRoLnJlc29sdmUocHJvY2Vzcy5lbnYuSE9NRSwgJ0xpYnJhcnknLCAnTG9ncycsICdDb3JlU2ltdWxhdG9yJykpO1xufVxuXG5jbGFzcyBJb3NEcml2ZXIgZXh0ZW5kcyBCYXNlRHJpdmVyIHtcbiAgcmVzZXRJb3MgKCkge1xuICAgIHRoaXMuYXBwRXh0ID0gXCIuYXBwXCI7XG4gICAgdGhpcy54Y29kZVZlcnNpb24gPSBudWxsO1xuICAgIHRoaXMuaW9zU2RrVmVyc2lvbiA9IG51bGw7XG4gICAgdGhpcy5sb2dzID0ge307XG4gICAgdGhpcy5pbnN0cnVtZW50cyA9IG51bGw7XG4gICAgdGhpcy51aUF1dG9DbGllbnQgPSBudWxsO1xuICAgIHRoaXMub25JbnN0cnVtZW50c0RpZSA9IGZ1bmN0aW9uICgpIHt9O1xuICAgIHRoaXMuc3RvcHBpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmNiRm9yQ3VycmVudENtZCA9IG51bGw7XG4gICAgdGhpcy5yZW1vdGUgPSBudWxsO1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IG51bGw7XG4gICAgdGhpcy5jdXJXZWJGcmFtZXMgPSBbXTtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSBmYWxzZTtcbiAgICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gW107XG4gICAgdGhpcy53ZWJFbGVtZW50SWRzID0gW107XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IDA7XG4gICAgdGhpcy5hc3luY2xpYldhaXRNcyA9IDA7XG4gICAgdGhpcy5wYWdlTG9hZE1zID0gNjAwMDtcbiAgICB0aGlzLmFzeW5jbGliUmVzcG9uc2VDYiA9IG51bGw7XG4gICAgdGhpcy5yZXR1cm5lZEZyb21FeGVjdXRlQXRvbSA9IHt9O1xuICAgIHRoaXMuZXhlY3V0ZWRBdG9tc0NvdW50ZXIgPSAwO1xuICAgIHRoaXMuY3VyQ29vcmRzID0gbnVsbDtcbiAgICB0aGlzLmN1cldlYkNvb3JkcyA9IG51bGw7XG4gICAgdGhpcy5sYW5kc2NhcGVXZWJDb29yZHNPZmZzZXQgPSAwO1xuICAgIHRoaXMua2VlcEFwcFRvUmV0YWluUHJlZnMgPSBmYWxzZTtcbiAgICB0aGlzLnJlYWR5ID0gZmFsc2U7XG4gICAgdGhpcy5hc3luY1dhaXRNcyA9IDA7XG5cbiAgICB0aGlzLnNldHRpbmdzID0gbmV3IERldmljZVNldHRpbmdzKHt9LCBfLm5vb3ApO1xuXG4gICAgdGhpcy5sb2NhdG9yU3RyYXRlZ2llcyA9IFtcbiAgICAgICd4cGF0aCcsXG4gICAgICAnaWQnLFxuICAgICAgJ2NsYXNzIG5hbWUnLFxuICAgICAgJy1pb3MgdWlhdXRvbWF0aW9uJyxcbiAgICAgICdhY2Nlc3NpYmlsaXR5IGlkJ1xuICAgIF07XG4gICAgdGhpcy53ZWJMb2NhdG9yU3RyYXRlZ2llcyA9IFtcbiAgICAgICdsaW5rIHRleHQnLFxuICAgICAgJ2NzcyBzZWxlY3RvcicsXG4gICAgICAndGFnIG5hbWUnLFxuICAgICAgJ3BhcnRpYWwgbGluayB0ZXh0J1xuICAgIF07XG4gIH1cblxuICBjb25zdHJ1Y3RvciAob3B0cywgc2hvdWxkVmFsaWRhdGVDYXBzKSB7XG4gICAgc3VwZXIob3B0cywgc2hvdWxkVmFsaWRhdGVDYXBzKTtcblxuICAgIHRoaXMuZGVzaXJlZENhcENvbnN0cmFpbnRzID0gZGVzaXJlZENhcENvbnN0cmFpbnRzO1xuICAgIHRoaXMucmVzZXRJb3MoKTtcbiAgICB0aGlzLmdldERldmljZVBpeGVsUmF0aW8gPSBfLm1lbW9pemUodGhpcy5nZXREZXZpY2VQaXhlbFJhdGlvKTtcbiAgfVxuXG4gIHZhbGlkYXRlTG9jYXRvclN0cmF0ZWd5IChzdHJhdGVneSkge1xuICAgIHN1cGVyLnZhbGlkYXRlTG9jYXRvclN0cmF0ZWd5KHN0cmF0ZWd5LCB0aGlzLmlzV2ViQ29udGV4dCgpKTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0ICgpIHtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFJlYWxEZXZpY2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFNpbXVsYXRvcigpO1xuICAgIH1cbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVNlc3Npb24gKC4uLmFyZ3MpIHtcbiAgICBsZXQgW3Nlc3Npb25JZCwgY2Fwc10gPSBhd2FpdCBzdXBlci5jcmVhdGVTZXNzaW9uKC4uLmFyZ3MpO1xuXG4gICAgLy8gYXBwaXVtLWlvcy1kcml2ZXIgdXNlcyBJbnN0cnVtZW50cyB0byBhdXRvbWF0ZSB0aGUgZGV2aWNlXG4gICAgLy8gYnV0IFhjb2RlIDggZG9lcyBub3QgaGF2ZSBJbnN0cnVtZW50cywgc28gc2hvcnQgY2lyY3VpdFxuICAgIHRoaXMueGNvZGVWZXJzaW9uID0gYXdhaXQgdXRpbHMuZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24odGhpcy5vcHRzKTtcbiAgICBsb2dnZXIuZGVidWcoYFhjb2RlIHZlcnNpb24gc2V0IHRvICR7dGhpcy54Y29kZVZlcnNpb24udmVyc2lvblN0cmluZ31gKTtcbiAgICBpZiAodGhpcy54Y29kZVZlcnNpb24ubWFqb3IgPj0gOCkge1xuICAgICAgbGV0IG1zZyA9IGBBcHBpdW0ncyBJb3NEcml2ZXIgZG9lcyBub3Qgc3VwcG9ydCBYY29kZSB2ZXJzaW9uICR7dGhpcy54Y29kZVZlcnNpb24udmVyc2lvblN0cmluZ30uIGAgK1xuICAgICAgICAgICAgICAgICdBcHBsZSBoYXMgZGVwcmVjYXRlZCBVSUF1dG9tYXRpb24uIFVzZSB0aGUgXCJYQ1VJVGVzdFwiIGF1dG9tYXRpb25OYW1lIGNhcGFiaWxpdHkgaW5zdGVhZC4nO1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobmV3IGVycm9ycy5TZXNzaW9uTm90Q3JlYXRlZEVycm9yKG1zZykpO1xuICAgIH1cblxuICAgIC8vIG1lcmdlIHNlcnZlciBjYXBhYmlsaXRpZXMgKyBkZXNpcmVkIGNhcGFiaWxpdGllc1xuICAgIHRoaXMuY2FwcyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRTZXJ2ZXJDYXBzLCB0aGlzLmNhcHMpO1xuICAgIHRoaXMuY2Fwcy5kZXNpcmVkID0gY2FwcztcblxuICAgIGF3YWl0IHV0aWxzLmRldGVjdFVkaWQodGhpcy5vcHRzKTtcbiAgICBhd2FpdCB1dGlscy5wcmVwYXJlSW9zT3B0cyh0aGlzLm9wdHMpO1xuICAgIHRoaXMucmVhbERldmljZSA9IG51bGw7XG4gICAgdGhpcy51c2VSb2JvdCA9IHRoaXMub3B0cy51c2VSb2JvdDtcbiAgICB0aGlzLnNhZmFyaSA9IHRoaXMub3B0cy5zYWZhcmk7XG4gICAgdGhpcy5vcHRzLmN1ck9yaWVudGF0aW9uID0gdGhpcy5vcHRzLmluaXRpYWxPcmllbnRhdGlvbjtcblxuICAgIHRoaXMuc29jayA9IHBhdGgucmVzb2x2ZSh0aGlzLm9wdHMudG1wRGlyIHx8ICcvdG1wJywgJ2luc3RydW1lbnRzX3NvY2snKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbmZpZ3VyZUFwcCgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLmVycm9yKGBCYWQgYXBwOiAnJHt0aGlzLm9wdHMuYXBwfScuIEFwcCBwYXRocyBuZWVkIHRvIGAgK1xuICAgICAgICAgICAgICAgICAgIGBiZSBhYnNvbHV0ZSwgb3IgcmVsYXRpdmUgdG8gdGhlIGFwcGl1bSBzZXJ2ZXIgYCArXG4gICAgICAgICAgICAgICAgICAgYGluc3RhbGwgZGlyLCBvciBhIFVSTCB0byBjb21wcmVzc2VkIGZpbGUsIG9yIGEgYCArXG4gICAgICAgICAgICAgICAgICAgYHNwZWNpYWwgYXBwIG5hbWUuYCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5zdGFydCgpO1xuXG4gICAgLy8gVE9ETzogdGhpcyBzaG91bGQgYmUgaW4gQmFzZURyaXZlci5wb3N0Q3JlYXRlU2Vzc2lvblxuICAgIHRoaXMuc3RhcnROZXdDb21tYW5kVGltZW91dCgnY3JlYXRlU2Vzc2lvbicpO1xuICAgIHJldHVybiBbc2Vzc2lvbklkLCB0aGlzLmNhcHNdO1xuICB9XG5cbiAgYXN5bmMgc3RvcCAoKSB7XG4gICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMudWlBdXRvQ2xpZW50KSB7XG4gICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zaHV0ZG93bigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmluc3RydW1lbnRzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmluc3RydW1lbnRzLnNodXRkb3duKCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGBJbnN0cnVtZW50cyBkaWRuJ3Qgc2h1dCBkb3duLiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYXBzICYmIHRoaXMuY2Fwcy5jdXN0b21TU0xDZXJ0ICYmICF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYFVuaW5zdGFsbGluZyBzc2wgY2VydGlmaWNhdGUgZm9yIHVkaWQgJyR7dGhpcy5zaW0udWRpZH0nYCk7XG4gICAgICBhd2FpdCB1bmluc3RhbGxTU0xDZXJ0KHRoaXMuY2Fwcy5jdXN0b21TU0xDZXJ0LCB0aGlzLnNpbS51ZGlkKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRzLmVuYWJsZUFzeW5jRXhlY3V0ZUZyb21IdHRwcyAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgdGhpcy5zdG9wSHR0cHNBc3luY1NlcnZlcigpO1xuICAgIH1cblxuICAgIHRoaXMudWlBdXRvQ2xpZW50ID0gbnVsbDtcbiAgICB0aGlzLmluc3RydW1lbnRzID0gbnVsbDtcbiAgICB0aGlzLnJlYWxEZXZpY2UgPSBudWxsO1xuXG4gICAgLy8gcG9zdGNsZWFudXBcbiAgICB0aGlzLmN1ckNvb3JkcyA9IG51bGw7XG4gICAgdGhpcy5vcHRzLmN1ck9yaWVudGF0aW9uID0gbnVsbDtcbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmxvZ3MpKSB7XG4gICAgICBhd2FpdCB0aGlzLmxvZ3Muc3lzbG9nLnN0b3BDYXB0dXJlKCk7XG4gICAgICB0aGlzLmxvZ3MgPSB7fTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZW1vdGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RvcFJlbW90ZSgpO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuc3RvcElXRFAoKTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24gKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIkRlbGV0aW5nIGlvcyBzZXNzaW9uXCIpO1xuXG4gICAgYXdhaXQgdGhpcy5zdG9wKCk7XG5cbiAgICBpZiAodGhpcy5vcHRzLmNsZWFyU3lzdGVtRmlsZXMpIHtcbiAgICAgIGF3YWl0IHV0aWxzLmNsZWFyTG9ncyhMT0dfTE9DQVRJT05TKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdOb3QgY2xlYXJpbmcgbG9nIGZpbGVzLiBVc2UgYGNsZWFyU3lzdGVtRmlsZXNgIGNhcGFiaWxpdHkgdG8gdHVybiBvbi4nKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgcnVuUmVhbERldmljZVJlc2V0KHRoaXMucmVhbERldmljZSwgdGhpcy5vcHRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgcnVuU2ltdWxhdG9yUmVzZXQodGhpcy5zaW0sIHRoaXMub3B0cywgdGhpcy5rZWVwQXBwVG9SZXRhaW5QcmVmcyk7XG4gICAgfVxuICAgIGF3YWl0IHN1cGVyLmRlbGV0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIGFzeW5jIGdldFNlc3Npb24gKCkge1xuICAgIGxldCBjYXBzID0gYXdhaXQgc3VwZXIuZ2V0U2Vzc2lvbigpO1xuXG4gICAgY29uc3Qgdmlld3BvcnRSZWN0ID0gYXdhaXQgdGhpcy5nZXRWaWV3cG9ydFJlY3QoKTtcbiAgICBjb25zdCBwaXhlbFJhdGlvID0gYXdhaXQgdGhpcy5nZXREZXZpY2VQaXhlbFJhdGlvKCk7XG4gICAgY29uc3Qgc3RhdEJhckhlaWdodCA9IGF3YWl0IHRoaXMuZ2V0U3RhdHVzQmFySGVpZ2h0KCk7XG5cbiAgICBjYXBzLnZpZXdwb3J0UmVjdCA9IHZpZXdwb3J0UmVjdDtcbiAgICBjYXBzLnBpeGVsUmF0aW8gPSBwaXhlbFJhdGlvO1xuICAgIGNhcHMuc3RhdEJhckhlaWdodCA9IHN0YXRCYXJIZWlnaHQ7XG5cbiAgICByZXR1cm4gY2FwcztcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVDb21tYW5kIChjbWQsIC4uLmFyZ3MpIHtcbiAgICBsb2dnZXIuZGVidWcoYEV4ZWN1dGluZyBpT1MgY29tbWFuZCAnJHtjbWR9J2ApO1xuICAgIGlmIChjbWQgPT09ICdyZWNlaXZlQXN5bmNSZXNwb25zZScpIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlY2VpdmVBc3luY1Jlc3BvbnNlKC4uLmFyZ3MpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5yZWFkeSB8fCBfLmluY2x1ZGVzKFsnbGF1bmNoQXBwJ10sIGNtZCkpIHtcbiAgICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRHJpdmVyRXJyb3IoYERyaXZlciBpcyBub3QgcmVhZHksIGNhbm5vdCBleGVjdXRlICR7Y21kfS5gKTtcbiAgfVxuXG4gIC8vIFRPRE86IHJlZm9ybWF0IHRoaXMuaGVscGVycyArIGNvbmZpZ3VyZUFwcFxuICBhc3luYyBjb25maWd1cmVBcHAgKCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBpZiB0aGUgYXBwIG5hbWUgaXMgYSBidW5kbGVJZCBhc3NpZ24gaXQgdG8gdGhlIGJ1bmRsZUlkIHByb3BlcnR5XG4gICAgICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCAmJiB1dGlscy5hcHBJc1BhY2thZ2VPckJ1bmRsZSh0aGlzLm9wdHMuYXBwKSkge1xuICAgICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSB0aGlzLm9wdHMuYXBwO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRzLmFwcCAmJiB0aGlzLm9wdHMuYXBwLnRvTG93ZXJDYXNlKCkgPT09IFwic2V0dGluZ3NcIikge1xuICAgICAgICBpZiAocGFyc2VGbG9hdCh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uKSA+PSA4KSB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKFwiV2UgYXJlIG9uIGlPUzgrIHNvIG5vdCBjb3B5aW5nIHByZWZlcmVuY2VzIGFwcFwiKTtcbiAgICAgICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSBcImNvbS5hcHBsZS5QcmVmZXJlbmNlc1wiO1xuICAgICAgICAgIHRoaXMub3B0cy5hcHAgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0cy5hcHAgJiYgdGhpcy5vcHRzLmFwcC50b0xvd2VyQ2FzZSgpID09PSBcImNhbGVuZGFyXCIpIHtcbiAgICAgICAgaWYgKHBhcnNlRmxvYXQodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbikgPj0gOCkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcIldlIGFyZSBvbiBpT1M4KyBzbyBub3QgY29weWluZyBjYWxlbmRhciBhcHBcIik7XG4gICAgICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gXCJjb20uYXBwbGUubW9iaWxlY2FsXCI7XG4gICAgICAgICAgdGhpcy5vcHRzLmFwcCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1NhZmFyaSgpKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgICAgIGlmIChwYXJzZUZsb2F0KHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24pID49IDgpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcIldlIGFyZSBvbiBpT1M4KyBzbyBub3QgY29weWluZyBTYWZhcmkgYXBwXCIpO1xuICAgICAgICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gU0FGQVJJX0JVTkRMRTtcbiAgICAgICAgICAgIHRoaXMub3B0cy5hcHAgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBvbiByZWFsIGRldmljZSwgbmVlZCB0byBjaGVjayBpZiBzYWZhcmkgbGF1bmNoZXIgZXhpc3RzXG4gICAgICAgICAgLy8gZmlyc3QgY2hlY2sgaWYgaXQgaXMgYWxyZWFkeSBvbiB0aGUgZGV2aWNlXG4gICAgICAgICAgaWYgKCFhd2FpdCB0aGlzLnJlYWxEZXZpY2UuaXNJbnN0YWxsZWQodGhpcy5vcHRzLmJ1bmRsZUlkKSkge1xuICAgICAgICAgICAgLy8gaXQncyBub3Qgb24gdGhlIGRldmljZSwgc28gY2hlY2sgaWYgd2UgbmVlZCB0byBidWlsZFxuICAgICAgICAgICAgaWYgKGF3YWl0IG5lZWRzSW5zdGFsbCgpKSB7XG4gICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnU2FmYXJpTGF1bmNoZXIgbm90IGZvdW5kLCBidWlsZGluZy4uLicpO1xuICAgICAgICAgICAgICBhd2FpdCBpbnN0YWxsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSBTQUZBUklfTEFVTkNIRVJfQlVORExFO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdHMuYnVuZGxlSWQgJiZcbiAgICAgICAgICAgICAgICAgdXRpbHMuYXBwSXNQYWNrYWdlT3JCdW5kbGUodGhpcy5vcHRzLmJ1bmRsZUlkKSAmJlxuICAgICAgICAgICAgICAgICAodGhpcy5vcHRzLmFwcCA9PT0gXCJcIiB8fCB1dGlscy5hcHBJc1BhY2thZ2VPckJ1bmRsZSh0aGlzLm9wdHMuYXBwKSkpIHtcbiAgICAgICAgLy8gd2UgaGF2ZSBhIGJ1bmRsZSBJRCwgYnV0IG5vIGFwcCwgb3IgYXBwIGlzIGFsc28gYSBidW5kbGVcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiQXBwIGlzIGFuIGlPUyBidW5kbGUsIHdpbGwgYXR0ZW1wdCB0byBydW4gYXMgcHJlLWV4aXN0aW5nXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vcHRzLmFwcCA9IGF3YWl0IHRoaXMuaGVscGVycy5jb25maWd1cmVBcHAodGhpcy5vcHRzLmFwcCwgJy5hcHAnKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihlcnIpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQmFkIGFwcDogJHt0aGlzLm9wdHMuYXBwfS4gQXBwIHBhdGhzIG5lZWQgdG8gYmUgYWJzb2x1dGUsIG9yIHJlbGF0aXZlIHRvIHRoZSBhcHBpdW0gYCArXG4gICAgICAgIFwic2VydmVyIGluc3RhbGwgZGlyLCBvciBhIFVSTCB0byBjb21wcmVzc2VkIGZpbGUsIG9yIGEgc3BlY2lhbCBhcHAgbmFtZS5cIik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RhcnRTaW11bGF0b3IgKCkge1xuICAgIGF3YWl0IHV0aWxzLnJlbW92ZUluc3RydW1lbnRzU29ja2V0KHRoaXMuc29jayk7XG5cbiAgICBpZiAoIXRoaXMueGNvZGVWZXJzaW9uKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJTZXR0aW5nIFhjb2RlIHZlcnNpb25cIik7XG4gICAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IGF3YWl0IHV0aWxzLmdldEFuZENoZWNrWGNvZGVWZXJzaW9uKHRoaXMub3B0cyk7XG4gICAgICBsb2dnZXIuZGVidWcoYFhjb2RlIHZlcnNpb24gc2V0IHRvICR7dGhpcy54Y29kZVZlcnNpb24udmVyc2lvblN0cmluZ31gKTtcbiAgICB9XG5cbiAgICBsb2dnZXIuZGVidWcoXCJTZXR0aW5nIGlPUyBTREsgVmVyc2lvblwiKTtcbiAgICB0aGlzLmlvc1Nka1ZlcnNpb24gPSBhd2FpdCB1dGlscy5nZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24oKTtcbiAgICBsb2dnZXIuZGVidWcoYGlPUyBTREsgVmVyc2lvbiBzZXQgdG8gJHt0aGlzLmlvc1Nka1ZlcnNpb259YCk7XG5cbiAgICBsZXQgdGltZW91dCA9IF8uaXNPYmplY3QodGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQpID8gdGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQuZ2xvYmFsIDogdGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQ7XG4gICAgbGV0IGF2YWlsYWJsZURldmljZXMgPSBhd2FpdCByZXRyeSgzLCBpbnN0cnVtZW50c1V0aWxzLmdldEF2YWlsYWJsZURldmljZXMsIHRpbWVvdXQpO1xuXG4gICAgbGV0IGlvc1NpbVVkaWQgPSBhd2FpdCBjaGVja1NpbXVsYXRvckF2YWlsYWJsZSh0aGlzLm9wdHMsIHRoaXMuaW9zU2RrVmVyc2lvbiwgYXZhaWxhYmxlRGV2aWNlcyk7XG5cbiAgICB0aGlzLnNpbSA9IGF3YWl0IGdldFNpbXVsYXRvcihpb3NTaW1VZGlkLCB0aGlzLnhjb2RlVmVyc2lvbi52ZXJzaW9uU3RyaW5nKTtcblxuICAgIGF3YWl0IG1vdmVCdWlsdEluQXBwKHRoaXMuc2ltKTtcblxuICAgIHRoaXMub3B0cy5sb2NhbGl6YWJsZVN0cmluZ3MgPSBhd2FpdCB1dGlscy5wYXJzZUxvY2FsaXphYmxlU3RyaW5ncyh0aGlzLm9wdHMpO1xuXG4gICAgYXdhaXQgdXRpbHMuc2V0QnVuZGxlSWRGcm9tQXBwKHRoaXMub3B0cyk7XG5cbiAgICBhd2FpdCB0aGlzLmNyZWF0ZUluc3RydW1lbnRzKCk7XG5cbiAgICB7XG4gICAgICAvLyBwcmV2aW91c2x5IHNldERldmljZUluZm8oKVxuICAgICAgdGhpcy5zaG91bGRQcmVsYXVuY2hTaW11bGF0b3IgPSB1dGlscy5zaG91bGRQcmVsYXVuY2hTaW11bGF0b3IodGhpcy5vcHRzLCB0aGlzLmlvc1Nka1ZlcnNpb24pO1xuICAgICAgbGV0IGRTdHJpbmcgPSBhd2FpdCBnZXRBZGp1c3RlZERldmljZU5hbWUodGhpcy5vcHRzKTtcbiAgICAgIGlmICh0aGlzLmNhcHMuYXBwKSB7XG4gICAgICAgIGF3YWl0IHV0aWxzLnNldERldmljZVR5cGVJbkluZm9QbGlzdCh0aGlzLm9wdHMuYXBwLCBkU3RyaW5nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBhd2FpdCBydW5TaW11bGF0b3JSZXNldCh0aGlzLnNpbSwgdGhpcy5vcHRzLCB0aGlzLmtlZXBBcHBUb1JldGFpblByZWZzKTtcblxuICAgIGlmICh0aGlzLmNhcHMuY3VzdG9tU1NMQ2VydCAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgaW5zdGFsbFNTTENlcnQodGhpcy5jYXBzLmN1c3RvbVNTTENlcnQsIHRoaXMuc2ltLnVkaWQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdHMuZW5hYmxlQXN5bmNFeGVjdXRlRnJvbUh0dHBzICYmICF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICAvLyBhd2FpdCB0aGlzLnNpbS5zaHV0ZG93bigpO1xuICAgICAgYXdhaXQgdGhpcy5zdGFydEh0dHBzQXN5bmNTZXJ2ZXIoKTtcbiAgICB9XG5cbiAgICBhd2FpdCBpc29sYXRlU2ltdWxhdG9yRGV2aWNlKHRoaXMuc2ltLCB0aGlzLm9wdHMpO1xuICAgIHRoaXMubG9jYWxDb25maWcgPSBhd2FpdCBzZXRMb2NhbGVBbmRQcmVmZXJlbmNlcyh0aGlzLnNpbSwgdGhpcy5vcHRzLCB0aGlzLmlzU2FmYXJpKCksIGVuZFNpbXVsYXRvcik7XG4gICAgYXdhaXQgdGhpcy5zdGFydExvZ0NhcHR1cmUodGhpcy5zaW0pO1xuICAgIGF3YWl0IHRoaXMucHJlbGF1bmNoU2ltdWxhdG9yKCk7XG4gICAgYXdhaXQgdGhpcy5zdGFydEluc3RydW1lbnRzKCk7XG4gICAgYXdhaXQgdGhpcy5vbkluc3RydW1lbnRzTGF1bmNoKCk7XG4gICAgYXdhaXQgdGhpcy5jb25maWd1cmVCb290c3RyYXAoKTtcbiAgICBhd2FpdCB0aGlzLnNldEJ1bmRsZUlkKCk7XG4gICAgYXdhaXQgdGhpcy5zZXRJbml0aWFsT3JpZW50YXRpb24oKTtcbiAgICBhd2FpdCB0aGlzLmluaXRBdXRvV2VidmlldygpO1xuICAgIGF3YWl0IHRoaXMud2FpdEZvckFwcExhdW5jaGVkKCk7XG4gIH1cblxuICBhc3luYyBzdGFydFJlYWxEZXZpY2UgKCkge1xuICAgIGF3YWl0IHV0aWxzLnJlbW92ZUluc3RydW1lbnRzU29ja2V0KHRoaXMuc29jayk7XG4gICAgdGhpcy5vcHRzLmxvY2FsaXphYmxlU3RyaW5ncyA9IGF3YWl0IHV0aWxzLnBhcnNlTG9jYWxpemFibGVTdHJpbmdzKHRoaXMub3B0cyk7XG4gICAgYXdhaXQgdXRpbHMuc2V0QnVuZGxlSWRGcm9tQXBwKHRoaXMub3B0cyk7XG4gICAgYXdhaXQgdGhpcy5jcmVhdGVJbnN0cnVtZW50cygpO1xuICAgIGF3YWl0IHJ1blJlYWxEZXZpY2VSZXNldCh0aGlzLnJlYWxEZXZpY2UsIHRoaXMub3B0cyk7XG4gICAgYXdhaXQgdGhpcy5zdGFydExvZ0NhcHR1cmUoKTtcbiAgICBhd2FpdCB0aGlzLmluc3RhbGxUb1JlYWxEZXZpY2UoKTtcbiAgICBhd2FpdCB0aGlzLnN0YXJ0SW5zdHJ1bWVudHMoKTtcbiAgICBhd2FpdCB0aGlzLm9uSW5zdHJ1bWVudHNMYXVuY2goKTtcbiAgICBhd2FpdCB0aGlzLmNvbmZpZ3VyZUJvb3RzdHJhcCgpO1xuICAgIGF3YWl0IHRoaXMuc2V0QnVuZGxlSWQoKTtcbiAgICBhd2FpdCB0aGlzLnNldEluaXRpYWxPcmllbnRhdGlvbigpO1xuICAgIGF3YWl0IHRoaXMuaW5pdEF1dG9XZWJ2aWV3KCk7XG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yQXBwTGF1bmNoZWQoKTtcbiAgfVxuXG4gIGFzeW5jIGluc3RhbGxUb1JlYWxEZXZpY2UgKCkge1xuICAgIC8vIGlmIHVzZXIgaGFzIHBhc3NlZCBpbiBkZXNpcmVkQ2Fwcy5hdXRvTGF1bmNoID0gZmFsc2VcbiAgICAvLyBtZWFuaW5nIHRoZXkgd2lsbCBtYW5hZ2UgYXBwIGluc3RhbGwgLyBsYXVuY2hpbmdcbiAgICBpZiAodGhpcy5vcHRzLmF1dG9MYXVuY2ggPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgaGF2ZSBhbiBpcGEgZmlsZSwgc2V0IGl0IGluIG9wdHNcbiAgICBpZiAodGhpcy5vcHRzLmFwcCkge1xuICAgICAgbGV0IGV4dCA9IHRoaXMub3B0cy5hcHAuc3Vic3RyaW5nKHRoaXMub3B0cy5hcHAubGVuZ3RoIC0gMykudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChleHQgPT09ICdpcGEnKSB7XG4gICAgICAgIHRoaXMub3B0cy5pcGEgPSB0aGlzLm9wdHMuYXBwO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdHMudWRpZCkge1xuICAgICAgaWYgKGF3YWl0IHRoaXMucmVhbERldmljZS5pc0luc3RhbGxlZCh0aGlzLm9wdHMuYnVuZGxlSWQpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIkFwcCBpcyBpbnN0YWxsZWQuXCIpO1xuICAgICAgICBpZiAodGhpcy5vcHRzLmZ1bGxSZXNldCkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcImZ1bGxSZXNldCByZXF1ZXN0ZWQuIEZvcmNpbmcgYXBwIGluc3RhbGwuXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcImZ1bGxSZXNldCBub3QgcmVxdWVzdGVkLiBObyBuZWVkIHRvIGluc3RhbGwuXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiQXBwIGlzIG5vdCBpbnN0YWxsZWQuIFdpbGwgdHJ5IHRvIGluc3RhbGwuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRzLmlwYSAmJiB0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5pbnN0YWxsSXBhKCk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwIGluc3RhbGxlZC4nKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRzLmlwYSkge1xuICAgICAgICBsZXQgbXNnID0gXCJZb3Ugc3BlY2lmaWVkIGEgVURJRCBhbmQgaXBhIGJ1dCBkaWQgbm90IGluY2x1ZGUgdGhlIGJ1bmRsZSBpZFwiO1xuICAgICAgICBsb2dnZXIud2Fybihtc2cpO1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihtc2cpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdHMuYXBwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVhbERldmljZS5pbnN0YWxsKHRoaXMub3B0cy5hcHApO1xuICAgICAgICBsb2dnZXIuZGVidWcoJ0FwcCBpbnN0YWxsZWQuJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZGVidWcoXCJSZWFsIGRldmljZSBzcGVjaWZpZWQgYnV0IG5vIGlwYSBvciBhcHAgcGF0aCwgYXNzdW1pbmcgYnVuZGxlIElEIGlzIFwiICtcbiAgICAgICAgICAgICAgICAgICAgIFwib24gZGV2aWNlXCIpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJObyBkZXZpY2UgaWQgb3IgYXBwLCBub3QgaW5zdGFsbGluZyB0byByZWFsIGRldmljZS5cIik7XG4gICAgfVxuICB9XG5cbiAgZ2V0SURldmljZU9iaiAoKSB7XG4gICAgbGV0IGlkaVBhdGggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcIi4uLy4uLy4uL2J1aWxkL1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGliaW1vYmlsZWRldmljZS1tYWNvc3gvaWRldmljZWluc3RhbGxlclwiKTtcbiAgICBsb2dnZXIuZGVidWcoYENyZWF0aW5nIGlEZXZpY2Ugb2JqZWN0IHdpdGggdWRpZCAke3RoaXMub3B0cy51ZGlkfWApO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gaURldmljZSh0aGlzLm9wdHMudWRpZCk7XG4gICAgfSBjYXRjaCAoZTEpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgQ291bGRuJ3QgZmluZCBpZGV2aWNlaW5zdGFsbGVyLCB0cnlpbmcgYnVpbHQtaW4gYXQgJHtpZGlQYXRofWApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGlEZXZpY2UodGhpcy5vcHRzLnVkaWQsIHtjbWQ6IGlkaVBhdGh9KTtcbiAgICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICAgIGxldCBtc2cgPSBcIkNvdWxkIG5vdCBpbml0aWFsaXplIGlkZXZpY2VpbnN0YWxsZXI7IG1ha2Ugc3VyZSBpdCBpcyBcIiArXG4gICAgICAgICAgICAgICAgICBcImluc3RhbGxlZCBhbmQgd29ya3Mgb24geW91ciBzeXN0ZW1cIjtcbiAgICAgICAgbG9nZ2VyLmVycm9yKG1zZyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGluc3RhbGxJcGEgKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhgSW5zdGFsbGluZyBpcGEgZm91bmQgYXQgJHt0aGlzLm9wdHMuaXBhfWApO1xuICAgIGlmIChhd2FpdCB0aGlzLnJlYWxEZXZpY2UuaXNJbnN0YWxsZWQodGhpcy5vcHRzLmJ1bmRsZUlkKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiQnVuZGxlIGZvdW5kIG9uIGRldmljZSwgcmVtb3ZpbmcgYmVmb3JlIHJlaW5zdGFsbGluZy5cIik7XG4gICAgICBhd2FpdCB0aGlzLnJlYWxEZXZpY2UucmVtb3ZlKHRoaXMub3B0cy5idW5kbGVJZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIk5vdGhpbmcgZm91bmQgb24gZGV2aWNlLCBnb2luZyBhaGVhZCBhbmQgaW5zdGFsbGluZy5cIik7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMucmVhbERldmljZS5pbnN0YWxsQW5kV2FpdCh0aGlzLm9wdHMuaXBhLCB0aGlzLm9wdHMuYnVuZGxlSWQpO1xuICB9XG5cbiAgdmFsaWRhdGVEZXNpcmVkQ2FwcyAoY2Fwcykge1xuICAgIC8vIGNoZWNrIHdpdGggdGhlIGJhc2UgY2xhc3MsIGFuZCByZXR1cm4gaWYgaXQgZmFpbHNcbiAgICBsZXQgcmVzID0gc3VwZXIudmFsaWRhdGVEZXNpcmVkQ2FwcyhjYXBzKTtcbiAgICBpZiAoIXJlcykgcmV0dXJuIHJlczsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgcmV0dXJuIGRlc2lyZWRDYXBWYWxpZGF0aW9uKGNhcHMpO1xuICB9XG5cbiAgYXN5bmMgcHJlbGF1bmNoU2ltdWxhdG9yICgpIHtcbiAgICBpZiAoIXRoaXMuc2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJOb3QgcHJlLWxhdW5jaGluZyBzaW11bGF0b3JcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGF3YWl0IGVuZFNpbXVsYXRvcih0aGlzLnNpbSk7XG4gICAgLy8gVE9ETzogaW1wbGVtZW50IHByZWxhdW5jaCBzaW0gaW4gc2ltdWxhdG9yIHBhY2thZ2VcbiAgfVxuXG4gIGFzeW5jIG9uSW5zdHJ1bWVudHNMYXVuY2ggKCkge1xuICAgIGxvZ2dlci5kZWJ1ZygnSW5zdHJ1bWVudHMgbGF1bmNoZWQuIFN0YXJ0aW5nIHBvbGwgbG9vcCBmb3IgbmV3IGNvbW1hbmRzLicpO1xuICAgIGlmICh0aGlzLm9wdHMub3JpZ0FwcFBhdGgpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIkNvcHlpbmcgYXBwIGJhY2sgdG8gaXRzIG9yaWdpbmFsIHBsYWNlXCIpO1xuICAgICAgcmV0dXJuIGF3YWl0IGZzLmNvcHlGaWxlKHRoaXMub3B0cy5hcHAsIHRoaXMub3B0cy5vcmlnQXBwUGF0aCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2V0QnVuZGxlSWQgKCkge1xuICAgIGlmICh0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAgIC8vIFdlIGFscmVhZHkgaGF2ZSBhIGJ1bmRsZSBJZFxuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgYklkID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoJ2F1LmJ1bmRsZUlkKCknKTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgQnVuZGxlIElEIGZvciBvcGVuIGFwcCBpcyAke2JJZC52YWx1ZX1gKTtcbiAgICAgIHRoaXMub3B0cy5idW5kbGVJZCA9IGJJZC52YWx1ZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzdGFydElXRFAgKCkge1xuICAgIGlmICh0aGlzLm9wdHMuc3RhcnRJV0RQKSB7XG4gICAgICB0aGlzLml3ZHBTZXJ2ZXIgPSBuZXcgSVdEUCh0aGlzLm9wdHMud2Via2l0RGVidWdQcm94eVBvcnQsIHRoaXMub3B0cy51ZGlkKTtcbiAgICAgIGF3YWl0IHRoaXMuaXdkcFNlcnZlci5zdGFydCgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN0b3BJV0RQICgpIHtcbiAgICBpZiAodGhpcy5pd2RwU2VydmVyKSB7XG4gICAgICBhd2FpdCB0aGlzLml3ZHBTZXJ2ZXIuc3RvcCgpO1xuICAgICAgZGVsZXRlIHRoaXMuaXdkcFNlcnZlcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZXRJbml0aWFsT3JpZW50YXRpb24gKCkge1xuICAgIGlmIChfLmlzU3RyaW5nKHRoaXMub3B0cy5pbml0aWFsT3JpZW50YXRpb24pICYmXG4gICAgICAgIF8uaW5jbHVkZXMoW1wiTEFORFNDQVBFXCIsIFwiUE9SVFJBSVRcIl0sIHRoaXMub3B0cy5pbml0aWFsT3JpZW50YXRpb24udG9VcHBlckNhc2UoKSkpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgU2V0dGluZyBpbml0aWFsIG9yaWVudGF0aW9uIHRvICR7dGhpcy5vcHRzLmluaXRpYWxPcmllbnRhdGlvbn1gKTtcbiAgICAgIGxldCBjb21tYW5kID0gYGF1LnNldFNjcmVlbk9yaWVudGF0aW9uKCcke3RoaXMub3B0cy5pbml0aWFsT3JpZW50YXRpb24udG9VcHBlckNhc2UoKX0nKWA7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgICAgICAgdGhpcy5vcHRzLmN1ck9yaWVudGF0aW9uID0gdGhpcy5vcHRzLmluaXRpYWxPcmllbnRhdGlvbjtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2dnZXIud2FybihgU2V0dGluZyBpbml0aWFsIG9yaWVudGF0aW9uIGZhaWxlZCB3aXRoOiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpc1JlYWxEZXZpY2UgKCkge1xuICAgIHJldHVybiAhIXRoaXMub3B0cy51ZGlkO1xuICB9XG5cbiAgaXNTYWZhcmkgKCkge1xuICAgIHJldHVybiB0aGlzLm9wdHMuc2FmYXJpO1xuICB9XG5cbiAgYXN5bmMgd2FpdEZvckFwcExhdW5jaGVkICgpIHtcbiAgICAvLyBvbiBpT1M4IGluIHBhcnRpY3VsYXIsIHdlIGNhbiBnZXQgYSB3b3JraW5nIHNlc3Npb24gYmVmb3JlIHRoZSBhcHBcbiAgICAvLyBpcyByZWFkeSB0byByZXNwb25kIHRvIGNvbW1hbmRzOyBpbiB0aGF0IGNhc2UgdGhlIHNvdXJjZSB3aWxsIGJlIGVtcHR5XG4gICAgLy8gc28gd2UganVzdCBzcGluIHVudGlsIGl0J3Mgbm90XG4gICAgbGV0IGNvbmRGbjtcbiAgICBpZiAodGhpcy5vcHRzLndhaXRGb3JBcHBTY3JpcHQpIHtcbiAgICAgIC8vIHRoZSBkZWZhdWx0IGdldFNvdXJjZUZvckVsZW1lbnRGb3JYTUwgZG9lcyBub3QgZml0IHNvbWUgdXNlIGNhc2UsIHNvIG1ha2luZyB0aGlzIGN1c3RvbWl6YWJsZS5cbiAgICAgIC8vIFRPRE86IGNvbGxlY3Qgc2NyaXB0IGZyb20gY3VzdG9tZXIgYW5kIHByb3Bvc2Ugc2V2ZXJhbCBvcHRpb25zLCBwbGVhc2UgY29tbWVudCBpbiBpc3N1ZSAjNDE5MC5cbiAgICAgIGxvZ2dlci5kZWJ1ZyhgVXNpbmcgY3VzdG9tIHNjcmlwdCB0byB3YWl0IGZvciBhcHAgc3RhcnQ6ICR7dGhpcy5vcHRzLndhaXRGb3JBcHBTY3JpcHR9YCk7XG4gICAgICBjb25kRm4gPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCByZXM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoYHRyeXtcXG4ke3RoaXMub3B0cy53YWl0Rm9yQXBwU2NyaXB0fWAgK1xuICAgICAgICAgICAgICAgICAgICAgYFxcbn0gY2F0Y2goZXJyKSB7ICQubG9nKFwid2FpdEZvckFwcFNjcmlwdCBlcnI6IFwiICsgZXJyb3IpOyBmYWxzZTsgfTtgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKGBDYW5ub3QgZXZhbCB3YWl0Rm9yQXBwU2NyaXB0IHNjcmlwdCwgZXJyOiAke2Vycn1gKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiByZXMgIT09ICdib29sZWFuJykge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnVW5leHBlY3RlZCByZXR1cm4gdHlwZSBpbiB3YWl0Rm9yQXBwU2NyaXB0IHNjcmlwdCcpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNTYWZhcmkoKSkge1xuICAgICAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGlja0J1dHRvblRvTGF1bmNoU2FmYXJpKCk7XG4gICAgICB9XG4gICAgICBsb2dnZXIuZGVidWcoJ1dhaXRpbmcgZm9yIGluaXRpYWwgd2VidmlldycpO1xuICAgICAgYXdhaXQgdGhpcy5uYXZUb0luaXRpYWxXZWJ2aWV3KCk7XG4gICAgICBjb25kRm4gPSBhc3luYyAoKSA9PiB0cnVlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiV2FpdGluZyBmb3IgYXBwIHNvdXJjZSB0byBjb250YWluIGVsZW1lbnRzXCIpO1xuICAgICAgY29uZEZuID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGxldCBzb3VyY2UgPSBhd2FpdCB0aGlzLmdldFNvdXJjZUZvckVsZW1lbnRGb3JYTUwoKTtcbiAgICAgICAgICBzb3VyY2UgPSBKU09OLnBhcnNlKHNvdXJjZSB8fCBcInt9XCIpO1xuICAgICAgICAgIGxldCBhcHBFbHMgPSAoc291cmNlLlVJQUFwcGxpY2F0aW9uIHx8IHt9KVsnPiddO1xuICAgICAgICAgIHJldHVybiBhcHBFbHMgJiYgYXBwRWxzLmxlbmd0aCA+IDAgJiYgIUlvc0RyaXZlci5pc1NwcmluZ0JvYXJkKHNvdXJjZS5VSUFBcHBsaWNhdGlvbik7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBsb2dnZXIud2FybihgQ291bGRuJ3QgZXh0cmFjdCBhcHAgZWxlbWVudCBmcm9tIHNvdXJjZSwgZXJyb3Igd2FzOiAke2V9YCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihjb25kRm4sIHtsb2dnZXIsIHdhaXRNczogMTAwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5tZXNzYWdlICYmIGVyci5tZXNzYWdlLm1hdGNoKC9Db25kaXRpb24gdW5tZXQvKSkge1xuICAgICAgICBsb2dnZXIud2FybignSW5pdGlhbCBzcGluIHRpbWVkIG91dCwgY29udGludWluZyBidXQgdGhlIGFwcCBtaWdodCBub3QgYmUgcmVhZHkuJyk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgSW5pdGlhbCBzcGluIGVycm9yIHdhczogJHtlcnJ9YCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGlzU3ByaW5nQm9hcmQgKHVpQXBwT2JqKSB7XG4gIC8vIFRPRE86IG1vdmUgdG8gaGVscGVyc1xuICAvLyBUZXN0IGZvciBpT1MgaG9tZXNjcmVlbiAoU3ByaW5nQm9hcmQpLiBBVVQgb2NjYXNzaW9uYWxseSBzdGFydCB0aGUgc2ltLCBidXQgZmFpbHMgdG8gbG9hZFxuICAvLyB0aGUgYXBwLiBJZiB0aGF0IG9jY3VycywgZ2V0U291cmNlRm9yRWxlbWVudEZvWE1MIHdpbGwgcmV0dXJuIGEgZG9jIG9iamVjdCB0aGF0IG1lZXRzIG91clxuICAvLyBhcHAtY2hlY2sgY29uZGl0aW9ucywgcmVzdWx0aW5nIGluIGEgZmFsc2UgcG9zaXRpdmUuIFRoaXMgZnVuY3Rpb24gdGVzdHMgdGhlIFVpQXBwbGljYXRpb25cbiAgLy8gcHJvcGVydHkncyBtZXRhIGRhdGEgdG8gZW5zdXJlIHRoYXQgdGhlIEFwcGl1bSBkb2Vzbid0IGNvbmZ1c2UgU3ByaW5nQm9hcmQgd2l0aCB0aGUgYXBwXG4gIC8vIHVuZGVyIHRlc3QuXG4gICAgcmV0dXJuIF8ucHJvcGVydHlPZih1aUFwcE9ialsnQCddKSgnbmFtZScpID09PSAnU3ByaW5nQm9hcmQnO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlSW5zdHJ1bWVudHMgKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIkNyZWF0aW5nIGluc3RydW1lbnRzXCIpO1xuICAgIHRoaXMudWlBdXRvQ2xpZW50ID0gbmV3IFVJQXV0b0NsaWVudCh0aGlzLnNvY2spO1xuICAgIHRoaXMuaW5zdHJ1bWVudHMgPSBhd2FpdCB0aGlzLm1ha2VJbnN0cnVtZW50cygpO1xuICAgIHRoaXMuaW5zdHJ1bWVudHMub25TaHV0ZG93bi5jYXRjaChhc3luYyAoKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9jYXRjaC1vci1yZXR1cm5cbiAgICAgIC8vIHVuZXhwZWN0ZWQgZXhpdFxuICAgICAgYXdhaXQgdGhpcy5zdGFydFVuZXhwZWN0ZWRTaHV0ZG93bihuZXcgZXJyb3JzLlVua25vd25FcnJvcignQWJub3JtYWwgSW5zdHJ1bWVudHMgdGVybWluYXRpb24hJykpO1xuICAgIH0pLmRvbmUoKTtcbiAgfVxuXG4gIHNob3VsZElnbm9yZUluc3RydW1lbnRzRXhpdCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2FmYXJpICYmIHRoaXMuaXNSZWFsRGV2aWNlKCk7XG4gIH1cblxuICBhc3luYyBtYWtlSW5zdHJ1bWVudHMgKCkge1xuICAgIC8vIGF0IHRoZSBtb21lbnQgYWxsIHRoZSBsb2dnaW5nIGluIHVpYXV0byBpcyBhdCBkZWJ1ZyBsZXZlbFxuICAgIGxldCBib290c3RyYXBQYXRoID0gYXdhaXQgcHJlcGFyZUJvb3RzdHJhcCh7XG4gICAgICBzb2NrOiB0aGlzLnNvY2ssXG4gICAgICBpbnRlcktleURlbGF5OiB0aGlzLm9wdHMuaW50ZXJLZXlEZWxheSxcbiAgICAgIGp1c3RMb29wSW5maW5pdGVseTogZmFsc2UsXG4gICAgICBhdXRvQWNjZXB0QWxlcnRzOiB0aGlzLm9wdHMuYXV0b0FjY2VwdEFsZXJ0cyxcbiAgICAgIGF1dG9EaXNtaXNzQWxlcnRzOiB0aGlzLm9wdHMuYXV0b0Rpc21pc3NBbGVydHMsXG4gICAgICBzZW5kS2V5U3RyYXRlZ3k6IHRoaXMub3B0cy5zZW5kS2V5U3RyYXRlZ3kgfHwgKHRoaXMuaXNSZWFsRGV2aWNlKCkgPyAnZ3JvdXBlZCcgOiAnb25lQnlPbmUnKVxuICAgIH0pO1xuICAgIGxldCBpbnN0cnVtZW50cyA9IG5ldyBJbnN0cnVtZW50cyh7XG4gICAgICAvLyBvbiByZWFsIGRldmljZXMgYnVuZGxlSWQgaXMgYWx3YXlzIHVzZWRcbiAgICAgIGFwcDogKCF0aGlzLmlzUmVhbERldmljZSgpID8gdGhpcy5vcHRzLmFwcCA6IG51bGwpIHx8IHRoaXMub3B0cy5idW5kbGVJZCxcbiAgICAgIHVkaWQ6IHRoaXMub3B0cy51ZGlkLFxuICAgICAgcHJvY2Vzc0FyZ3VtZW50czogdGhpcy5vcHRzLnByb2Nlc3NBcmd1bWVudHMsXG4gICAgICBpZ25vcmVTdGFydHVwRXhpdDogdGhpcy5zaG91bGRJZ25vcmVJbnN0cnVtZW50c0V4aXQoKSxcbiAgICAgIGJvb3RzdHJhcDogYm9vdHN0cmFwUGF0aCxcbiAgICAgIHRlbXBsYXRlOiB0aGlzLm9wdHMuYXV0b21hdGlvblRyYWNlVGVtcGxhdGVQYXRoLFxuICAgICAgaW5zdHJ1bWVudHNQYXRoOiB0aGlzLm9wdHMuaW5zdHJ1bWVudHNQYXRoLFxuICAgICAgd2l0aG91dERlbGF5OiB0aGlzLm9wdHMud2l0aG91dERlbGF5LFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgICAgd2ViU29ja2V0OiB0aGlzLm9wdHMud2ViU29ja2V0LFxuICAgICAgbGF1bmNoVGltZW91dDogdGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQsXG4gICAgICBmbGFrZXlSZXRyaWVzOiB0aGlzLm9wdHMuYmFja2VuZFJldHJpZXMsXG4gICAgICByZWFsRGV2aWNlOiB0aGlzLmlzUmVhbERldmljZSgpLFxuICAgICAgc2ltdWxhdG9yU2RrQW5kRGV2aWNlOiB0aGlzLmlvc1Nka1ZlcnNpb24gPj0gNy4xID8gYXdhaXQgZ2V0QWRqdXN0ZWREZXZpY2VOYW1lKHRoaXMub3B0cykgOiBudWxsLFxuICAgICAgdG1wRGlyOiBwYXRoLnJlc29sdmUodGhpcy5vcHRzLnRtcERpciB8fCAnL3RtcCcsICdhcHBpdW0taW5zdHJ1bWVudHMnKSxcbiAgICAgIHRyYWNlRGlyOiB0aGlzLm9wdHMudHJhY2VEaXIsXG4gICAgICBsb2NhbGU6IHRoaXMub3B0cy5sb2NhbGUsXG4gICAgICBsYW5ndWFnZTogdGhpcy5vcHRzLmxhbmd1YWdlXG4gICAgfSk7XG4gICAgcmV0dXJuIGluc3RydW1lbnRzO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRJbnN0cnVtZW50cyAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFwiU3RhcnRpbmcgVUlBdXRvQ2xpZW50LCBhbmQgbGF1bmNoaW5nIEluc3RydW1lbnRzLlwiKTtcblxuICAgIGF3YWl0IEIuYWxsKFtcbiAgICAgIHRoaXMudWlBdXRvQ2xpZW50LnN0YXJ0KCkudGhlbigoKSA9PiB7IHRoaXMuaW5zdHJ1bWVudHMucmVnaXN0ZXJMYXVuY2goKTsgfSksXG4gICAgICB0aGlzLmluc3RydW1lbnRzLmxhdW5jaCgpXG4gICAgXSk7XG4gIH1cblxuICBhc3luYyBjb25maWd1cmVCb290c3RyYXAgKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIlNldHRpbmcgYm9vdHN0cmFwIGNvbmZpZyBrZXlzL3ZhbHVlc1wiKTtcbiAgICBsZXQgaXNWZXJib3NlID0gdHJ1ZTsgLy8gVE9ETzogbGV2ZWwgd2FzIGNvbmZpZ3VyZWQgYWNjb3JkaW5nIHRvIGxvZ2dlclxuICAgIGxldCBjbWQgPSAndGFyZ2V0ID0gJC50YXJnZXQoKTtcXG4nO1xuICAgIGNtZCArPSAnYXUgPSAkO1xcbic7XG4gICAgY21kICs9IGAkLmlzVmVyYm9zZSA9ICR7aXNWZXJib3NlfTtcXG5gO1xuICAgIC8vIE5vdCB1c2luZyB1aWF1dG8gZ3JhY2UgcGVyaW9kIGJlY2F1c2Ugb2YgYnVnLlxuICAgIC8vIGNtZCArPSAnJC50YXJnZXQoKS5zZXRUaW1lb3V0KDEpO1xcbic7XG4gICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY21kKTtcbiAgfVxuXG4gIGFzeW5jIGdldFNvdXJjZUZvckVsZW1lbnRGb3JYTUwgKGN0eCkge1xuICAgIGxldCBzb3VyY2U7XG4gICAgaWYgKCFjdHgpIHtcbiAgICAgIHNvdXJjZSA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKFwiYXUubWFpbkFwcCgpLmdldFRyZWVGb3JYTUwoKVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc291cmNlID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoYGF1LmdldEVsZW1lbnQoJyR7Y3R4fScpLmdldFRyZWVGb3JYTUwoKWApO1xuICAgIH1cbiAgICAvLyBUT0RPOiBhbGwgdGhpcyBqc29uL3htbCBsb2dpYyBpcyB2ZXJ5IGV4cGVuc2l2ZSwgd2UgbmVlZFxuICAgIC8vIHRvIHVzZSBhIFNBWCBwYXJzZXIgaW5zdGVhZC5cbiAgICBpZiAoc291cmNlKSB7XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoc291cmNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuIGJ1dCB3ZSd2ZSByZWNlaXZlZCBidWcgcmVwb3J0czsgdGhpcyB3aWxsIGhlbHAgdXMgdHJhY2sgZG93blxuICAgICAgLy8gd2hhdCdzIHdyb25nIGluIGdldFRyZWVGb3JYTUxcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIHJlc3BvbnNlIGZyb20gZ2V0VHJlZUZvclhNTC4gcmVzIHdhcyAke0pTT04uc3RyaW5naWZ5KHNvdXJjZSl9YCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHJlYWxEZXZpY2UgKCkge1xuICAgIHRoaXMuX3JlYWxEZXZpY2UgPSB0aGlzLl9yZWFsRGV2aWNlIHx8IHRoaXMuZ2V0SURldmljZU9iaigpO1xuICAgIHJldHVybiB0aGlzLl9yZWFsRGV2aWNlO1xuICB9XG5cbiAgc2V0IHJlYWxEZXZpY2UgKHJkKSB7XG4gICAgdGhpcy5fcmVhbERldmljZSA9IHJkO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoY29tbWFuZHMpKSB7XG4gIElvc0RyaXZlci5wcm90b3R5cGVbY21kXSA9IGZuO1xufVxuXG5cbmV4cG9ydCB7IElvc0RyaXZlciwgZGVmYXVsdFNlcnZlckNhcHMgfTtcbmV4cG9ydCBkZWZhdWx0IElvc0RyaXZlcjtcbiJdLCJmaWxlIjoibGliL2RyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
