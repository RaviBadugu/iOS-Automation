"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.install = install;
exports.needsInstall = needsInstall;
exports.SAFARI_LAUNCHER_BUNDLE = exports.SAFARI_LAUNCHER_APP_FILE = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

const SAFARI_LAUNCHER_DIR = _path.default.resolve(__dirname, '..', '..', 'build', 'SafariLauncher');

const SAFARI_LAUNCHER_APP_FILE = _path.default.resolve(__dirname, '..', '..', 'build', 'SafariLauncher', 'SafariLauncher.app');

exports.SAFARI_LAUNCHER_APP_FILE = SAFARI_LAUNCHER_APP_FILE;

const SAFARI_LAUNCHER_REPO = _path.default.resolve(__dirname, '..', '..', 'node_modules', 'safari-launcher');

const SAFARI_LAUNCHER_CONFIG_FILE = _path.default.resolve(SAFARI_LAUNCHER_REPO, 'build.xcconfig');

const SAFARI_LAUNCHER_BUNDLE = 'com.bytearc.SafariLauncher';
exports.SAFARI_LAUNCHER_BUNDLE = SAFARI_LAUNCHER_BUNDLE;
const sdks = ['iphoneos'];

function cleanApp(_x, _x2) {
  return _cleanApp.apply(this, arguments);
}

function _cleanApp() {
  _cleanApp = (0, _asyncToGenerator2.default)(function* (appRoot, sdk) {
    _logger.default.debug(`Cleaning SafariLauncher for ${sdk}`);

    try {
      yield (0, _teen_process.exec)('xcodebuild', ['-sdk', sdk, 'clean'], {
        cwd: appRoot
      });
    } catch (err) {
      _logger.default.error(err);

      throw err;
    }
  });
  return _cleanApp.apply(this, arguments);
}

function cleanAll() {
  return _cleanAll.apply(this, arguments);
}

function _cleanAll() {
  _cleanAll = (0, _asyncToGenerator2.default)(function* () {
    _logger.default.info("Cleaning SafariLauncher");

    let sdkVer = yield _appiumXcode.default.getMaxIOSSDK();

    for (var _i = 0; _i < sdks.length; _i++) {
      let sdk = sdks[_i];
      let fullSdk = sdk + sdkVer;
      yield cleanApp(SAFARI_LAUNCHER_REPO, fullSdk);
    }

    yield _appiumSupport.fs.rimraf(SAFARI_LAUNCHER_DIR);

    _logger.default.info("Finished cleaning SafariLauncher");
  });
  return _cleanAll.apply(this, arguments);
}

function buildApp(_x3, _x4) {
  return _buildApp.apply(this, arguments);
}

function _buildApp() {
  _buildApp = (0, _asyncToGenerator2.default)(function* (appRoot, sdk) {
    try {
      _logger.default.debug(`Building SafariLauncher for ${sdk}`);

      let args = ['-sdk', sdk, '-xcconfig', SAFARI_LAUNCHER_CONFIG_FILE];
      yield (0, _teen_process.exec)('xcodebuild', args, {
        cwd: appRoot
      });
    } catch (err) {
      _logger.default.error(err);

      throw err;
    }
  });
  return _buildApp.apply(this, arguments);
}

function buildAll() {
  return _buildAll.apply(this, arguments);
}

function _buildAll() {
  _buildAll = (0, _asyncToGenerator2.default)(function* () {
    _logger.default.info("Building SafariLauncher");

    let sdkVer = yield _appiumXcode.default.getMaxIOSSDK();

    for (var _i2 = 0; _i2 < sdks.length; _i2++) {
      let sdk = sdks[_i2];
      let fullSdk = sdk + sdkVer;
      yield buildApp(SAFARI_LAUNCHER_REPO, fullSdk);
    }

    _logger.default.info("Finished building SafariLauncher");
  });
  return _buildAll.apply(this, arguments);
}

function renameAll() {
  return _renameAll.apply(this, arguments);
}

function _renameAll() {
  _renameAll = (0, _asyncToGenerator2.default)(function* () {
    try {
      _logger.default.info("Renaming SafariLauncher");

      if (!(yield _appiumSupport.fs.exists(SAFARI_LAUNCHER_DIR))) {
        yield _appiumSupport.fs.mkdir(SAFARI_LAUNCHER_DIR);
      }

      let file = _path.default.resolve(SAFARI_LAUNCHER_REPO, 'build', 'Release-iphoneos', 'SafariLauncher.app');

      yield _appiumSupport.fs.rename(file, SAFARI_LAUNCHER_APP_FILE);

      _logger.default.info("Finished renaming SafariLauncher");
    } catch (err) {
      _logger.default.warn("Could not rename SafariLauncher");

      _logger.default.errorAndThrow(err);
    }
  });
  return _renameAll.apply(this, arguments);
}

function updateConfig() {
  return _updateConfig.apply(this, arguments);
}

function _updateConfig() {
  _updateConfig = (0, _asyncToGenerator2.default)(function* () {
    _logger.default.info('Updating config for Safari Launcher');

    let config = `BUNDLE_ID = ${SAFARI_LAUNCHER_BUNDLE}
IDENTITY_NAME = iPhone Developer
IDENTITY_CODE =`;
    yield _appiumSupport.fs.writeFile(SAFARI_LAUNCHER_CONFIG_FILE, config);
  });
  return _updateConfig.apply(this, arguments);
}

function install() {
  return _install.apply(this, arguments);
}

function _install() {
  _install = (0, _asyncToGenerator2.default)(function* () {
    yield cleanAll();
    yield updateConfig();
    yield buildAll();
    yield renameAll();
  });
  return _install.apply(this, arguments);
}

function needsInstall() {
  return _needsInstall.apply(this, arguments);
}

function _needsInstall() {
  _needsInstall = (0, _asyncToGenerator2.default)(function* () {
    _logger.default.debug(`Checking for presence of SafariLauncher at '${SAFARI_LAUNCHER_APP_FILE}'`);

    let exists = yield _appiumSupport.fs.exists(SAFARI_LAUNCHER_APP_FILE);

    _logger.default.debug(`SafariLauncher ${exists ? 'exists' : 'does not exist'}`);

    return !exists;
  });
  return _needsInstall.apply(this, arguments);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zYWZhcmktbGF1bmNoZXIuanMiXSwibmFtZXMiOlsiU0FGQVJJX0xBVU5DSEVSX0RJUiIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiU0FGQVJJX0xBVU5DSEVSX0FQUF9GSUxFIiwiU0FGQVJJX0xBVU5DSEVSX1JFUE8iLCJTQUZBUklfTEFVTkNIRVJfQ09ORklHX0ZJTEUiLCJTQUZBUklfTEFVTkNIRVJfQlVORExFIiwic2RrcyIsImNsZWFuQXBwIiwiYXBwUm9vdCIsInNkayIsImxvZ2dlciIsImRlYnVnIiwiY3dkIiwiZXJyIiwiZXJyb3IiLCJjbGVhbkFsbCIsImluZm8iLCJzZGtWZXIiLCJ4Y29kZSIsImdldE1heElPU1NESyIsImZ1bGxTZGsiLCJmcyIsInJpbXJhZiIsImJ1aWxkQXBwIiwiYXJncyIsImJ1aWxkQWxsIiwicmVuYW1lQWxsIiwiZXhpc3RzIiwibWtkaXIiLCJmaWxlIiwicmVuYW1lIiwid2FybiIsImVycm9yQW5kVGhyb3ciLCJ1cGRhdGVDb25maWciLCJjb25maWciLCJ3cml0ZUZpbGUiLCJpbnN0YWxsIiwibmVlZHNJbnN0YWxsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsbUJBQW1CLEdBQUdDLGNBQUtDLE9BQUwsQ0FBYUMsU0FBYixFQUF3QixJQUF4QixFQUE4QixJQUE5QixFQUNrQixPQURsQixFQUMyQixnQkFEM0IsQ0FBNUI7O0FBRUEsTUFBTUMsd0JBQXdCLEdBQUdILGNBQUtDLE9BQUwsQ0FBYUMsU0FBYixFQUF3QixJQUF4QixFQUE4QixJQUE5QixFQUNhLE9BRGIsRUFDc0IsZ0JBRHRCLEVBRWEsb0JBRmIsQ0FBakM7Ozs7QUFHQSxNQUFNRSxvQkFBb0IsR0FBR0osY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLElBQXhCLEVBQThCLElBQTlCLEVBQ2EsY0FEYixFQUM2QixpQkFEN0IsQ0FBN0I7O0FBRUEsTUFBTUcs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QUFDQXJCLHNCQUFPc0IsYUFBUCxDQUFxQm5CLEdBQXJCO0FBQ0Q7QUFDRixHOzs7O1NBRWNvQixZOzs7OztrREFBZixhQUErQjtBQUM3QnZCLG9CQUFPTSxJQUFQLENBQVkscUNBQVo7O0FBQ0EsUUFBSWtCLE1BQU0sR0FBSSxlQUFjN0Isc0JBQXVCOztnQkFBbkQ7QUFHQSxVQUFNZ0Isa0JBQUdjLFNBQUgsQ0FBYS9CLDJCQUFiLEVBQTBDOEIsTUFBMUMsQ0FBTjtBQUNELEc7Ozs7U0FFY0UsTzs7Ozs7NkNBQWYsYUFBMEI7QUFDeEIsVUFBTXJCLFFBQVEsRUFBZDtBQUNBLFVBQU1rQixZQUFZLEVBQWxCO0FBQ0EsVUFBTVIsUUFBUSxFQUFkO0FBQ0EsVUFBTUMsU0FBUyxFQUFmO0FBQ0QsRzs7OztTQUVjVyxZOzs7OztrREFBZixhQUErQjtBQUM3QjNCLG9CQUFPQyxLQUFQLENBQWMsK0NBQThDVCx3QkFBeUIsR0FBckY7O0FBQ0EsUUFBSXlCLE1BQU0sU0FBU04sa0JBQUdNLE1BQUgsQ0FBVXpCLHdCQUFWLENBQW5COztBQUNBUSxvQkFBT0MsS0FBUCxDQUFjLGtCQUFpQmdCLE1BQU0sR0FBRyxRQUFILEdBQWMsZ0JBQWlCLEVBQXBFOztBQUNBLFdBQU8sQ0FBQ0EsTUFBUjtBQUNELEciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeGNvZGUgZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5cbmNvbnN0IFNBRkFSSV9MQVVOQ0hFUl9ESVIgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdidWlsZCcsICdTYWZhcmlMYXVuY2hlcicpO1xuY29uc3QgU0FGQVJJX0xBVU5DSEVSX0FQUF9GSUxFID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJy4uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYnVpbGQnLCAnU2FmYXJpTGF1bmNoZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTYWZhcmlMYXVuY2hlci5hcHAnKTtcbmNvbnN0IFNBRkFSSV9MQVVOQ0hFUl9SRVBPID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJy4uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdub2RlX21vZHVsZXMnLCAnc2FmYXJpLWxhdW5jaGVyJyk7XG5jb25zdCBTQUZBUklfTEFVTkNIRVJfQ09ORklHX0ZJTEUgPSBwYXRoLnJlc29sdmUoU0FGQVJJX0xBVU5DSEVSX1JFUE8sICdidWlsZC54Y2NvbmZpZycpO1xuY29uc3QgU0FGQVJJX0xBVU5DSEVSX0JVTkRMRSA9ICdjb20uYnl0ZWFyYy5TYWZhcmlMYXVuY2hlcic7XG5cbmNvbnN0IHNka3MgPSBbJ2lwaG9uZW9zJ107XG5cbmFzeW5jIGZ1bmN0aW9uIGNsZWFuQXBwIChhcHBSb290LCBzZGspIHtcbiAgbG9nZ2VyLmRlYnVnKGBDbGVhbmluZyBTYWZhcmlMYXVuY2hlciBmb3IgJHtzZGt9YCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYygneGNvZGVidWlsZCcsIFsnLXNkaycsIHNkaywgJ2NsZWFuJ10sIHtjd2Q6IGFwcFJvb3R9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmVycm9yKGVycik7XG4gICAgdGhyb3cgZXJyO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsZWFuQWxsICgpIHtcbiAgbG9nZ2VyLmluZm8oXCJDbGVhbmluZyBTYWZhcmlMYXVuY2hlclwiKTtcbiAgbGV0IHNka1ZlciA9IGF3YWl0IHhjb2RlLmdldE1heElPU1NESygpO1xuICBmb3IgKGxldCBzZGsgb2Ygc2Rrcykge1xuICAgIGxldCBmdWxsU2RrID0gc2RrICsgc2RrVmVyO1xuICAgIGF3YWl0IGNsZWFuQXBwKFNBRkFSSV9MQVVOQ0hFUl9SRVBPLCBmdWxsU2RrKTtcbiAgfVxuICBhd2FpdCBmcy5yaW1yYWYoU0FGQVJJX0xBVU5DSEVSX0RJUik7XG4gIGxvZ2dlci5pbmZvKFwiRmluaXNoZWQgY2xlYW5pbmcgU2FmYXJpTGF1bmNoZXJcIik7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGJ1aWxkQXBwIChhcHBSb290LCBzZGspIHtcbiAgdHJ5IHtcbiAgICBsb2dnZXIuZGVidWcoYEJ1aWxkaW5nIFNhZmFyaUxhdW5jaGVyIGZvciAke3Nka31gKTtcbiAgICBsZXQgYXJncyA9IFsnLXNkaycsIHNkaywgJy14Y2NvbmZpZycsIFNBRkFSSV9MQVVOQ0hFUl9DT05GSUdfRklMRV07XG4gICAgYXdhaXQgZXhlYygneGNvZGVidWlsZCcsIGFyZ3MsIHtcbiAgICAgIGN3ZDogYXBwUm9vdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIuZXJyb3IoZXJyKTtcbiAgICB0aHJvdyBlcnI7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gYnVpbGRBbGwgKCkge1xuICBsb2dnZXIuaW5mbyhcIkJ1aWxkaW5nIFNhZmFyaUxhdW5jaGVyXCIpO1xuICBsZXQgc2RrVmVyID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gIGZvciAobGV0IHNkayBvZiBzZGtzKSB7XG4gICAgbGV0IGZ1bGxTZGsgPSBzZGsgKyBzZGtWZXI7XG4gICAgYXdhaXQgYnVpbGRBcHAoU0FGQVJJX0xBVU5DSEVSX1JFUE8sIGZ1bGxTZGspO1xuICB9XG4gIGxvZ2dlci5pbmZvKFwiRmluaXNoZWQgYnVpbGRpbmcgU2FmYXJpTGF1bmNoZXJcIik7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlbmFtZUFsbCAoKSB7XG4gIHRyeSB7XG4gICAgbG9nZ2VyLmluZm8oXCJSZW5hbWluZyBTYWZhcmlMYXVuY2hlclwiKTtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhTQUZBUklfTEFVTkNIRVJfRElSKSkge1xuICAgICAgYXdhaXQgZnMubWtkaXIoU0FGQVJJX0xBVU5DSEVSX0RJUik7XG4gICAgfVxuXG4gICAgbGV0IGZpbGUgPSBwYXRoLnJlc29sdmUoU0FGQVJJX0xBVU5DSEVSX1JFUE8sICdidWlsZCcsICdSZWxlYXNlLWlwaG9uZW9zJywgJ1NhZmFyaUxhdW5jaGVyLmFwcCcpO1xuICAgIGF3YWl0IGZzLnJlbmFtZShcbiAgICAgIGZpbGUsXG4gICAgICBTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEUpO1xuICAgIGxvZ2dlci5pbmZvKFwiRmluaXNoZWQgcmVuYW1pbmcgU2FmYXJpTGF1bmNoZXJcIik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci53YXJuKFwiQ291bGQgbm90IHJlbmFtZSBTYWZhcmlMYXVuY2hlclwiKTtcbiAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhlcnIpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNvbmZpZyAoKSB7XG4gIGxvZ2dlci5pbmZvKCdVcGRhdGluZyBjb25maWcgZm9yIFNhZmFyaSBMYXVuY2hlcicpO1xuICBsZXQgY29uZmlnID0gYEJVTkRMRV9JRCA9ICR7U0FGQVJJX0xBVU5DSEVSX0JVTkRMRX1cbklERU5USVRZX05BTUUgPSBpUGhvbmUgRGV2ZWxvcGVyXG5JREVOVElUWV9DT0RFID1gO1xuICBhd2FpdCBmcy53cml0ZUZpbGUoU0FGQVJJX0xBVU5DSEVSX0NPTkZJR19GSUxFLCBjb25maWcpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBpbnN0YWxsICgpIHtcbiAgYXdhaXQgY2xlYW5BbGwoKTtcbiAgYXdhaXQgdXBkYXRlQ29uZmlnKCk7XG4gIGF3YWl0IGJ1aWxkQWxsKCk7XG4gIGF3YWl0IHJlbmFtZUFsbCgpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBuZWVkc0luc3RhbGwgKCkge1xuICBsb2dnZXIuZGVidWcoYENoZWNraW5nIGZvciBwcmVzZW5jZSBvZiBTYWZhcmlMYXVuY2hlciBhdCAnJHtTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEV9J2ApO1xuICBsZXQgZXhpc3RzID0gYXdhaXQgZnMuZXhpc3RzKFNBRkFSSV9MQVVOQ0hFUl9BUFBfRklMRSk7XG4gIGxvZ2dlci5kZWJ1ZyhgU2FmYXJpTGF1bmNoZXIgJHtleGlzdHMgPyAnZXhpc3RzJyA6ICdkb2VzIG5vdCBleGlzdCd9YCk7XG4gIHJldHVybiAhZXhpc3RzO1xufVxuXG5cbmV4cG9ydCB7IGluc3RhbGwsIG5lZWRzSW5zdGFsbCwgU0FGQVJJX0xBVU5DSEVSX0FQUF9GSUxFLCBTQUZBUklfTEFVTkNIRVJfQlVORExFIH07XG4iXSwiZmlsZSI6ImxpYi9zYWZhcmktbGF1bmNoZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
