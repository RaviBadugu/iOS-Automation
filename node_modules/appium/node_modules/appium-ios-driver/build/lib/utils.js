"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.removeInstrumentsSocket = removeInstrumentsSocket;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.prepareIosOpts = prepareIosOpts;
exports.appIsPackageOrBundle = appIsPackageOrBundle;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.detectUdid = detectUdid;
exports.parseLocalizableStrings = parseLocalizableStrings;
exports.setBundleIdFromApp = setBundleIdFromApp;
exports.shouldPrelaunchSimulator = shouldPrelaunchSimulator;
exports.setDeviceTypeInInfoPlist = setDeviceTypeInInfoPlist;
exports.getSimForDeviceString = getSimForDeviceString;
exports.unwrapEl = unwrapEl;
exports.clearLogs = clearLogs;
exports.rootDir = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _appiumSupport = require("appium-support");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _appUtils = require("./app-utils");

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _safari = require("./commands/safari");

var _safariLauncher = require("./safari-launcher");

const rootDir = _path.default.resolve(__dirname, '..', '..');

exports.rootDir = rootDir;
const STRINGSDICT_RESOURCE = '.stringsdict';
const STRINGS_RESOURCE = '.strings';

function prepareIosOpts(_x) {
  return _prepareIosOpts.apply(this, arguments);
}

function _prepareIosOpts() {
  _prepareIosOpts = (0, _asyncToGenerator2.default)(function* (opts) {
    opts.backendRetries = 4;
    opts.withoutDelay = !opts.nativeInstrumentsLib;
    opts.reset = !opts.noReset;
    opts.initialOrientation = opts.deviceOrientation || opts.orientation || "PORTRAIT";
    opts.useRobot = opts.robotPort > 0;
    opts.robotUrl = opts.useRobot ? `http://${opts.robotAddress}:${opts.robotPort}` : null;

    if (opts.locationServicesAuthorized && !opts.bundleId) {
      throw new Error("You must set the bundleId cap if using locationServicesEnabled");
    }

    opts.platformVersion = opts.platformVersion || (yield _appiumXcode.default.getMaxIOSSDK());
    let pv = parseFloat(opts.platformVersion);

    if (pv < 8) {
      _logger.default.warn(`iOS version ${opts.platformVersion} support has been ` + `deprecated and will be removed in a future version of ` + `Appium.`);
    }

    opts.localizableStringsDir = opts.localizableStringsDir || 'en.lproj';
    opts.autoAcceptAlerts = _lodash.default.isNull(opts.autoAcceptAlerts) || _lodash.default.isUndefined(opts.autoAcceptAlerts) ? false : opts.autoAcceptAlerts;
    opts.autoDismissAlerts = _lodash.default.isNull(opts.autoDismissAlerts) || _lodash.default.isUndefined(opts.autoDismissAlerts) ? false : opts.autoDismissAlerts;

    if ((opts.browserName || '').toLowerCase() === 'safari' || (opts.app || '').toLowerCase() === 'safari' || (opts.bundleId || '').toLowerCase() === _safari.SAFARI_BUNDLE) {
      if (opts.udid) {
        opts.app = opts.app || _safariLauncher.SAFARI_LAUNCHER_APP_FILE;
        opts.bundleId = opts.bundleId || _safariLauncher.SAFARI_LAUNCHER_BUNDLE;
      } else {
        if (parseFloat(opts.platformVersion) <= 8) {
          opts.app = 'safari';
          opts.bundleId = null;
        } else {
          opts.app = null;
          opts.bundleId = _safari.SAFARI_BUNDLE;
        }
      }

      opts.safari = true;
    }
  });
  return _prepareIosOpts.apply(this, arguments);
}

function appIsPackageOrBundle(app) {
  return /^([a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+)+$/.test(app);
}

function removeInstrumentsSocket(_x2) {
  return _removeInstrumentsSocket.apply(this, arguments);
}

function _removeInstrumentsSocket() {
  _removeInstrumentsSocket = (0, _asyncToGenerator2.default)(function* (sock) {
    _logger.default.debug("Removing any remaining instruments sockets");

    yield _appiumSupport.fs.rimraf(sock);

    _logger.default.debug(`Cleaned up instruments socket ${sock}`);
  });
  return _removeInstrumentsSocket.apply(this, arguments);
}

function getAndCheckXcodeVersion(_x3) {
  return _getAndCheckXcodeVersion.apply(this, arguments);
}

function _getAndCheckXcodeVersion() {
  _getAndCheckXcodeVersion = (0, _asyncToGenerator2.default)(function* (caps) {
    let version;

    try {
      version = yield _appiumXcode.default.getVersion(true);
    } catch (err) {
      _logger.default.debug(err);

      _logger.default.error(`Could not determine Xcode version: ${err.message}`);

      throw err;
    }

    let minorVersion = version.versionFloat;
    let pv = parseFloat(caps.platformVersion);

    if (minorVersion < 6.3 && !(minorVersion === 6.0 && pv === 8.0)) {
      _logger.default.warn(`Xcode version '${version.versionString}'. Support for Xcode ` + `${version.versionString} has been deprecated and will be removed ` + `in a future version. Please upgrade to version 6.3 or ` + `higher (or version 6.0.1 for iOS 8.0)`);
    }

    return version;
  });
  return _getAndCheckXcodeVersion.apply(this, arguments);
}

function getAndCheckIosSdkVersion() {
  return _getAndCheckIosSdkVersion.apply(this, arguments);
}

function _getAndCheckIosSdkVersion() {
  _getAndCheckIosSdkVersion = (0, _asyncToGenerator2.default)(function* () {
    let versionNumber;

    try {
      versionNumber = yield _appiumXcode.default.getMaxIOSSDK();
    } catch (err) {
      _logger.default.error("Could not determine iOS SDK version");

      throw err;
    }

    return versionNumber;
  });
  return _getAndCheckIosSdkVersion.apply(this, arguments);
}

function getSimForDeviceString(dString, availDevices) {
  let matchedDevice = null;
  let matchedUdid = null;

  _lodash.default.each(availDevices, function (device) {
    if (device.indexOf(dString) !== -1) {
      matchedDevice = device;

      try {
        matchedUdid = /.+\[([^\]]+)\]/.exec(device)[1];
      } catch (e) {
        matchedUdid = null;
      }
    }
  });

  return [matchedDevice, matchedUdid];
}

function detectUdid(_x4) {
  return _detectUdid.apply(this, arguments);
}

function _detectUdid() {
  _detectUdid = (0, _asyncToGenerator2.default)(function* (caps) {
    if (caps.udid !== null && caps.udid === "auto") {
      _logger.default.debug("Auto-detecting iOS udid...");

      let cmd,
          args = [];

      try {
        cmd = yield _appiumSupport.fs.which('idevice_id');
        args.push('-l');
      } catch (err) {
        cmd = require.resolve('udidetect');
      }

      let udid;

      try {
        let _ref = yield (0, _teen_process.exec)(cmd, args, {
          timeout: 3000
        }),
            stdout = _ref.stdout;

        udid = stdout.split("\n")[0];
      } catch (err) {
        _logger.default.error("Error detecting udid");

        throw err;
      }

      if (udid && udid.length > 2) {
        caps.udid = udid;

        _logger.default.debug(`Detected udid as '${caps.udid}'`);
      } else {
        throw new Error("Could not detect udid.");
      }
    } else {
      _logger.default.debug("Not auto-detecting udid.");
    }
  });
  return _detectUdid.apply(this, arguments);
}

function readResource(_x5) {
  return _readResource.apply(this, arguments);
}

function _readResource() {
  _readResource = (0, _asyncToGenerator2.default)(function* (resourcePath) {
    const data = yield _appiumSupport.plist.parsePlistFile(resourcePath);
    const result = {};
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = _lodash.default.toPairs(data)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        const _step$value = (0, _slicedToArray2.default)(_step.value, 2),
              key = _step$value[0],
              value = _step$value[1];

        result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return result;
  });
  return _readResource.apply(this, arguments);
}

function parseLocalizableStrings(_x6) {
  return _parseLocalizableStrings.apply(this, arguments);
}

function _parseLocalizableStrings() {
  _parseLocalizableStrings = (0, _asyncToGenerator2.default)(function* (opts) {
    const app = opts.app,
          _opts$language = opts.language,
          language = _opts$language === void 0 ? 'en' : _opts$language,
          localizableStringsDir = opts.localizableStringsDir,
          stringFile = opts.stringFile,
          strictMode = opts.strictMode;

    if (!app) {
      const message = "Strings extraction is not supported if 'app' capability is not set";

      if (strictMode) {
        throw new Error(message);
      }

      _logger.default.info(message);

      return {};
    }

    let lprojRoot;
    var _arr = [`${language}.lproj`, localizableStringsDir, ''];

    for (var _i = 0; _i < _arr.length; _i++) {
      const subfolder = _arr[_i];
      lprojRoot = _path.default.resolve(app, subfolder);

      if (yield _appiumSupport.fs.exists(lprojRoot)) {
        break;
      }

      const message = `No '${lprojRoot}' resources folder has been found`;

      if (strictMode) {
        throw new Error(message);
      }

      _logger.default.debug(message);
    }

    _logger.default.info(`Will extract resource strings from '${lprojRoot}'`);

    const resourcePaths = [];

    if (stringFile) {
      const dstPath = _path.default.resolve(lprojRoot, stringFile);

      if (yield _appiumSupport.fs.exists(dstPath)) {
        resourcePaths.push(dstPath);
      } else {
        const message = `No '${dstPath}' resource file has been found for '${app}'`;

        if (strictMode) {
          throw new Error(message);
        }

        _logger.default.info(message);

        _logger.default.info(`Getting all the available strings from '${lprojRoot}'`);
      }
    }

    if (_lodash.default.isEmpty(resourcePaths) && (yield _appiumSupport.fs.exists(lprojRoot))) {
      const resourceFiles = (yield _appiumSupport.fs.readdir(lprojRoot)).filter(name => _lodash.default.some([STRINGS_RESOURCE, STRINGSDICT_RESOURCE], x => name.endsWith(x))).map(name => _path.default.resolve(lprojRoot, name));
      resourcePaths.push(...resourceFiles);
    }

    _logger.default.info(`Got ${resourcePaths.length} resource file(s) in '${lprojRoot}'`);

    if (_lodash.default.isEmpty(resourcePaths)) {
      return {};
    }

    const resultStrings = {};

    const toAbsolutePath = function toAbsolutePath(p) {
      return _path.default.isAbsolute(p) ? p : _path.default.resolve(process.cwd(), p);
    };

    for (var _i2 = 0; _i2 < resourcePaths.length; _i2++) {
      const resourcePath = resourcePaths[_i2];

      if (!_appiumSupport.util.isSubPath(toAbsolutePath(resourcePath), toAbsolutePath(app))) {
        throw new Error(`'${resourcePath}' is expected to be located under '${app}'`);
      }

      try {
        const data = yield readResource(resourcePath);

        _logger.default.debug(`Parsed ${_lodash.default.keys(data).length} string(s) from '${resourcePath}'`);

        _lodash.default.merge(resultStrings, data);
      } catch (e) {
        _logger.default.warn(`Cannot parse '${resourcePath}' resource. Original error: ${e.message}`);
      }
    }

    _logger.default.info(`Got ${_lodash.default.keys(resultStrings).length} string(s) from '${lprojRoot}'`);

    return resultStrings;
  });
  return _parseLocalizableStrings.apply(this, arguments);
}

function setBundleIdFromApp(_x7) {
  return _setBundleIdFromApp.apply(this, arguments);
}

function _setBundleIdFromApp() {
  _setBundleIdFromApp = (0, _asyncToGenerator2.default)(function* (caps) {
    if (!caps.bundleId) {
      try {
        caps.bundleId = yield (0, _appUtils.extractBundleId)(caps.app);

        _logger.default.info(`Extracted bundleID: ${caps.bundleId} from app: ${caps.app}`);
      } catch (err) {
        _logger.default.error("Could not set the bundleId from app.");

        throw err;
      }
    }
  });
  return _setBundleIdFromApp.apply(this, arguments);
}

function shouldPrelaunchSimulator(caps, iosSdkVersion) {
  let shouldPrelaunch = false;

  if (caps.defaultDevice || iosSdkVersion >= 7.1) {
    if (this.iosSdkVersion >= 7.1) {
      _logger.default.debug("We're on iOS7.1+ so forcing defaultDevice on");
    } else {
      _logger.default.debug("User specified default device, letting instruments launch it");
    }
  } else {
    shouldPrelaunch = true;
  }

  return shouldPrelaunch;
}

function setDeviceTypeInInfoPlist(_x8, _x9) {
  return _setDeviceTypeInInfoPlist.apply(this, arguments);
}

function _setDeviceTypeInInfoPlist() {
  _setDeviceTypeInInfoPlist = (0, _asyncToGenerator2.default)(function* (app, deviceString) {
    if (_lodash.default.isNull(app) || _lodash.default.isUndefined(app)) {
      return;
    }

    let plistFile = _path.default.resolve(app, "Info.plist");

    let isiPhone = deviceString.toLowerCase().indexOf("ipad") === -1;
    let deviceTypeCode = isiPhone ? 1 : 2;
    yield _appiumSupport.plist.updatePlistFile(plistFile, {
      UIDeviceFamily: [deviceTypeCode]
    });
  });
  return _setDeviceTypeInInfoPlist.apply(this, arguments);
}

function unwrapEl(el) {
  if (typeof el === 'object' && el.ELEMENT) {
    return el.ELEMENT;
  }

  return el;
}

function clearLogs(_x10) {
  return _clearLogs.apply(this, arguments);
}

function _clearLogs() {
  _clearLogs = (0, _asyncToGenerator2.default)(function* (locations) {
    _logger.default.debug('Clearing log files');

    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = locations[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        let location = _step2.value;

        if (yield _appiumSupport.fs.exists(location)) {
          let size;

          try {
            let _ref2 = yield (0, _teen_process.exec)('du', ['-sh', location]),
                stdout = _ref2.stdout;

            size = stdout.trim().split(/\s+/)[0];
          } catch (ign) {}

          try {
            _logger.default.debug(`Deleting '${location}'. ${size ? `Freeing ${size}.` : ''}`);

            yield _appiumSupport.fs.rimraf(location);
          } catch (err) {
            _logger.default.warn(`Unable to delete '${location}': ${err.message}`);
          }
        }
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    _logger.default.debug('Finished clearing log files');
  });
  return _clearLogs.apply(this, arguments);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJyb290RGlyIiwicGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJTVFJJTkdTRElDVF9SRVNPVVJDRSIsIlNUUklOR1NfUkVTT1VSQ0UiLCJwcmVwYXJlSW9zT3B0cyIsIm9wdHMiLCJiYWNrZW5kUmV0cmllcyIsIndpdGhvdXREZWxheSIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwicmVzZXQiLCJub1Jlc2V0IiwiaW5pdGlhbE9yaWVudGF0aW9uIiwiZGV2aWNlT3JpZW50YXRpb24iLCJvcmllbnRhdGlvbiIsInVzZVJvYm90Iiwicm9ib3RQb3J0Iiwicm9ib3RVcmwiLCJyb2JvdEFkZHJlc3MiLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImJ1bmRsZUlkIiwiRXJyb3IiLCJwbGF0Zm9ybVZlcnNpb24iLCJ4Y29kZSIsImdldE1heElPU1NESyIsInB2IiwicGFyc2VGbG9hdCIsImxvZ2dlciIsIndhcm4iLCJsb2NhbGl6YWJsZVN0cmluZ3NEaXIiLCJhdXRvQWNjZXB0QWxlcnRzIiwiXyIsImlzTnVsbCIsImlzVW5kZWZpbmVkIiwiYXV0b0Rpc21pc3NBbGVydHMiLCJicm93c2VyTmFtZSIsInRvTG93ZXJDYXNlIiwiYXBwIiwiU0FGQVJJX0JVTkRMRSIsInVkaWQiLCJTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEUiLCJTQUZBUklfTEFVTkNIRVJfQlVORExFIiwic2FmYXJpIiwiYXBwSXNQYWNrYWdlT3JCdW5kbGUiLCJ0ZXN0IiwicmVtb3ZlSW5zdHJ1bWVudHNTb2NrZXQiLCJzb2NrIiwiZGVidWciLCJmcyIsInJpbXJhZiIsImdldEFuZENoZWNrWGNvZGVWZXJzaW9uIiwiY2FwcyIsInZlcnNpb24iLCJnZXRWZXJzaW9uIiwiZXJyIiwiZXJyb3IiLCJtZXNzYWdlIiwibWlub3JWZXJzaW9uIiwidmVyc2lvbkZsb2F0IiwidmVyc2lvblN0cmluZyIsImdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiIsInZlcnNpb25OdW1iZXIiLCJnZXRTaW1Gb3JEZXZpY2VTdHJpbmciLCJkU3RyaW5nIiwiYXZhaWxEZXZpY2VzIiwibWF0Y2hlZERldmljZSIsIm1hdGNoZWRVZGlkIiwiZWFjaCIsImRldmljZSIsImluZGV4T2YiLCJleGVjIiwiZSIsImRldGVjdFVkaWQiLCJjbWQiLCJhcmdzIiwid2hpY2giLCJwdXNoIiwicmVxdWlyZSIsInRpbWVvdXQiLCJzdGRvdXQiLCJzcGxpdCIsImxlbmd0aCIsInJlYWRSZXNvdXJjZSIsInJlc291cmNlUGF0aCIsImRhdGEiLCJwbGlzdCIsInBhcnNlUGxpc3RGaWxlIiwicmVzdWx0IiwidG9QYWlycyIsImtleSIsInZhbHVlIiwiaXNTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwicGFyc2VMb2NhbGl6YWJsZVN0cmluZ3MiLCJsYW5ndWFnZSIsInN0cmluZ0ZpbGUiLCJzdHJpY3RNb2RlIiwiaW5mbyIsImxwcm9qUm9vdCIsInN1YmZvbGRlciIsImV4aXN0cyIsInJlc291cmNlUGF0aHMiLCJkc3RQYXRoIiwiaXNFbXB0eSIsInJlc291cmNlRmlsZXMiLCJyZWFkZGlyIiwiZmlsdGVyIiwibmFtZSIsInNvbWUiLCJ4IiwiZW5kc1dpdGgiLCJtYXAiLCJyZXN1bHRTdHJpbmdzIiwidG9BYnNvbHV0ZVBhdGgiLCJwIiwiaXNBYnNvbHV0ZSIsInByb2Nlc3MiLCJjd2QiLCJ1dGlsIiwiaXNTdWJQYXRoIiwia2V5cyIsIm1lcmdlIiwic2V0QnVuZGxlSWRGcm9tQXBwIiwic2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yIiwiaW9zU2RrVmVyc2lvbiIsInNob3VsZFByZWxhdW5jaCIsImRlZmF1bHREZXZpY2UiLCJzZXREZXZpY2VUeXBlSW5JbmZvUGxpc3QiLCJkZXZpY2VTdHJpbmciLCJwbGlzdEZpbGUiLCJpc2lQaG9uZSIsImRldmljZVR5cGVDb2RlIiwidXBkYXRlUGxpc3RGaWxlIiwiVUlEZXZpY2VGYW1pbHkiLCJ1bndyYXBFbCIsImVsIiwiRUxFTUVOVCIsImNsZWFy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OztBQWlCbkM3QixvQkFBT29CLEtBQVAsQ0FBYSw2QkFBYjtBQUNELEciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmcywgcGxpc3QsIHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeGNvZGUgZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCB7IGV4dHJhY3RCdW5kbGVJZCB9IGZyb20gJy4vYXBwLXV0aWxzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyBTQUZBUklfQlVORExFIH0gZnJvbSAnLi9jb21tYW5kcy9zYWZhcmknO1xuaW1wb3J0IHsgU0FGQVJJX0xBVU5DSEVSX0FQUF9GSUxFLCBTQUZBUklfTEFVTkNIRVJfQlVORExFIH0gZnJvbSAnLi9zYWZhcmktbGF1bmNoZXInO1xuXG5cbmNvbnN0IHJvb3REaXIgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nKTtcbmNvbnN0IFNUUklOR1NESUNUX1JFU09VUkNFID0gJy5zdHJpbmdzZGljdCc7XG5jb25zdCBTVFJJTkdTX1JFU09VUkNFID0gJy5zdHJpbmdzJztcblxuYXN5bmMgZnVuY3Rpb24gcHJlcGFyZUlvc09wdHMgKG9wdHMpIHtcbiAgb3B0cy5iYWNrZW5kUmV0cmllcyA9IDQ7XG4gIG9wdHMud2l0aG91dERlbGF5ID0gIW9wdHMubmF0aXZlSW5zdHJ1bWVudHNMaWI7XG4gIG9wdHMucmVzZXQgPSAhb3B0cy5ub1Jlc2V0O1xuICBvcHRzLmluaXRpYWxPcmllbnRhdGlvbiA9IG9wdHMuZGV2aWNlT3JpZW50YXRpb24gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzLm9yaWVudGF0aW9uIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJQT1JUUkFJVFwiO1xuICBvcHRzLnVzZVJvYm90ID0gb3B0cy5yb2JvdFBvcnQgPiAwO1xuICBvcHRzLnJvYm90VXJsID0gb3B0cy51c2VSb2JvdCA/XG4gICAgYGh0dHA6Ly8ke29wdHMucm9ib3RBZGRyZXNzfToke29wdHMucm9ib3RQb3J0fWAgOiBudWxsO1xuICBpZiAob3B0cy5sb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCAmJiAhb3B0cy5idW5kbGVJZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIllvdSBtdXN0IHNldCB0aGUgYnVuZGxlSWQgY2FwIGlmIHVzaW5nIGxvY2F0aW9uU2VydmljZXNFbmFibGVkXCIpO1xuICB9XG5cbiAgb3B0cy5wbGF0Zm9ybVZlcnNpb24gPSBvcHRzLnBsYXRmb3JtVmVyc2lvbiB8fCBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgbGV0IHB2ID0gcGFyc2VGbG9hdChvcHRzLnBsYXRmb3JtVmVyc2lvbik7XG4gIGlmIChwdiA8IDgpIHtcbiAgICBsb2dnZXIud2FybihgaU9TIHZlcnNpb24gJHtvcHRzLnBsYXRmb3JtVmVyc2lvbn0gc3VwcG9ydCBoYXMgYmVlbiBgICtcbiAgICAgICAgICAgICAgICBgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24gb2YgYCArXG4gICAgICAgICAgICAgICAgYEFwcGl1bS5gKTtcbiAgfVxuICBvcHRzLmxvY2FsaXphYmxlU3RyaW5nc0RpciA9IG9wdHMubG9jYWxpemFibGVTdHJpbmdzRGlyIHx8ICdlbi5scHJvaic7XG4gIG9wdHMuYXV0b0FjY2VwdEFsZXJ0cyA9IF8uaXNOdWxsKG9wdHMuYXV0b0FjY2VwdEFsZXJ0cykgfHwgXy5pc1VuZGVmaW5lZChvcHRzLmF1dG9BY2NlcHRBbGVydHMpID8gZmFsc2UgOiBvcHRzLmF1dG9BY2NlcHRBbGVydHM7XG4gIG9wdHMuYXV0b0Rpc21pc3NBbGVydHMgPSBfLmlzTnVsbChvcHRzLmF1dG9EaXNtaXNzQWxlcnRzKSB8fCBfLmlzVW5kZWZpbmVkKG9wdHMuYXV0b0Rpc21pc3NBbGVydHMpID8gZmFsc2UgOiBvcHRzLmF1dG9EaXNtaXNzQWxlcnRzO1xuXG4gIGlmICgob3B0cy5icm93c2VyTmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKSA9PT0gJ3NhZmFyaScgfHxcbiAgICAgIChvcHRzLmFwcCB8fCAnJykudG9Mb3dlckNhc2UoKSA9PT0gJ3NhZmFyaScgfHxcbiAgICAgIChvcHRzLmJ1bmRsZUlkIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSBTQUZBUklfQlVORExFKSB7XG4gICAgLy8gcHJlcGFyaW5nIGEgc2FmYXJpIHNlc3Npb25cbiAgICBpZiAob3B0cy51ZGlkKSB7XG4gICAgICAvLyBvbiBhIHJlYWwgZGV2aWNlXG4gICAgICBvcHRzLmFwcCA9IG9wdHMuYXBwIHx8IFNBRkFSSV9MQVVOQ0hFUl9BUFBfRklMRTtcbiAgICAgIG9wdHMuYnVuZGxlSWQgPSBvcHRzLmJ1bmRsZUlkIHx8IFNBRkFSSV9MQVVOQ0hFUl9CVU5ETEU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwYXJzZUZsb2F0KG9wdHMucGxhdGZvcm1WZXJzaW9uKSA8PSA4KSB7XG4gICAgICAgIC8vIG1ha2Ugc3VyZSBhcmdzLmFwcCBoYXMgc29tZXRoaW5nIGluIGl0IHNvIHdlIGdldCB0byB0aGUgcmlnaHQgc3BvdHNcbiAgICAgICAgLy8gaW4gbW92ZUJ1aWx0SW5BcHAoKVxuICAgICAgICBvcHRzLmFwcCA9ICdzYWZhcmknO1xuICAgICAgICBvcHRzLmJ1bmRsZUlkID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wdHMuYXBwID0gbnVsbDtcbiAgICAgICAgb3B0cy5idW5kbGVJZCA9IFNBRkFSSV9CVU5ETEU7XG4gICAgICB9XG4gICAgfVxuICAgIG9wdHMuc2FmYXJpID0gdHJ1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhcHBJc1BhY2thZ2VPckJ1bmRsZSAoYXBwKSB7XG4gIHJldHVybiAoL14oW2EtekEtWjAtOVxcLV9dK1xcLlthLXpBLVowLTlcXC1fXSspKyQvKS50ZXN0KGFwcCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlbW92ZUluc3RydW1lbnRzU29ja2V0IChzb2NrKSB7XG4gIGxvZ2dlci5kZWJ1ZyhcIlJlbW92aW5nIGFueSByZW1haW5pbmcgaW5zdHJ1bWVudHMgc29ja2V0c1wiKTtcbiAgYXdhaXQgZnMucmltcmFmKHNvY2spO1xuICBsb2dnZXIuZGVidWcoYENsZWFuZWQgdXAgaW5zdHJ1bWVudHMgc29ja2V0ICR7c29ja31gKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24gKGNhcHMpIHtcbiAgbGV0IHZlcnNpb247XG4gIHRyeSB7XG4gICAgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24odHJ1ZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5kZWJ1ZyhlcnIpO1xuICAgIGxvZ2dlci5lcnJvcihgQ291bGQgbm90IGRldGVybWluZSBYY29kZSB2ZXJzaW9uOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIHRocm93IGVycjtcbiAgfVxuICBsZXQgbWlub3JWZXJzaW9uID0gdmVyc2lvbi52ZXJzaW9uRmxvYXQ7XG4gIGxldCBwdiA9IHBhcnNlRmxvYXQoY2Fwcy5wbGF0Zm9ybVZlcnNpb24pO1xuICAvLyB3ZSBkZXByZWNhdGUgWGNvZGVzIDwgNi4zLCBleGNlcHQgZm9yIGlPUyA4LjAgaW4gd2hpY2ggY2FzZSB3ZVxuICAvLyBzdXBwb3J0IFhjb2RlIDYuMCBhcyB3ZWxsXG4gIGlmIChtaW5vclZlcnNpb24gPCA2LjMgJiYgKCEobWlub3JWZXJzaW9uID09PSA2LjAgJiYgcHYgPT09IDguMCkpKSB7XG4gICAgbG9nZ2VyLndhcm4oYFhjb2RlIHZlcnNpb24gJyR7dmVyc2lvbi52ZXJzaW9uU3RyaW5nfScuIFN1cHBvcnQgZm9yIFhjb2RlIGAgK1xuICAgICAgICAgICAgICAgIGAke3ZlcnNpb24udmVyc2lvblN0cmluZ30gaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGAgK1xuICAgICAgICAgICAgICAgIGBpbiBhIGZ1dHVyZSB2ZXJzaW9uLiBQbGVhc2UgdXBncmFkZSB0byB2ZXJzaW9uIDYuMyBvciBgICtcbiAgICAgICAgICAgICAgICBgaGlnaGVyIChvciB2ZXJzaW9uIDYuMC4xIGZvciBpT1MgOC4wKWApO1xuICB9XG4gIHJldHVybiB2ZXJzaW9uO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24gKCkge1xuICBsZXQgdmVyc2lvbk51bWJlcjtcbiAgdHJ5IHtcbiAgICB2ZXJzaW9uTnVtYmVyID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5lcnJvcihcIkNvdWxkIG5vdCBkZXRlcm1pbmUgaU9TIFNESyB2ZXJzaW9uXCIpO1xuICAgIHRocm93IGVycjtcbiAgfVxuICByZXR1cm4gdmVyc2lvbk51bWJlcjtcbn1cblxuZnVuY3Rpb24gZ2V0U2ltRm9yRGV2aWNlU3RyaW5nIChkU3RyaW5nLCBhdmFpbERldmljZXMpIHtcbiAgbGV0IG1hdGNoZWREZXZpY2UgPSBudWxsO1xuICBsZXQgbWF0Y2hlZFVkaWQgPSBudWxsO1xuICBfLmVhY2goYXZhaWxEZXZpY2VzLCBmdW5jdGlvbiAoZGV2aWNlKSB7XG4gICAgaWYgKGRldmljZS5pbmRleE9mKGRTdHJpbmcpICE9PSAtMSkge1xuICAgICAgbWF0Y2hlZERldmljZSA9IGRldmljZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIG1hdGNoZWRVZGlkID0gLy4rXFxbKFteXFxdXSspXFxdLy5leGVjKGRldmljZSlbMV07XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIG1hdGNoZWRVZGlkID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICByZXR1cm4gW21hdGNoZWREZXZpY2UsIG1hdGNoZWRVZGlkXTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGV0ZWN0VWRpZCAoY2Fwcykge1xuICBpZiAoY2Fwcy51ZGlkICE9PSBudWxsICYmIGNhcHMudWRpZCA9PT0gXCJhdXRvXCIpIHtcbiAgICBsb2dnZXIuZGVidWcoXCJBdXRvLWRldGVjdGluZyBpT1MgdWRpZC4uLlwiKTtcbiAgICBsZXQgY21kLCBhcmdzID0gW107XG4gICAgdHJ5IHtcbiAgICAgIGNtZCA9IGF3YWl0IGZzLndoaWNoKCdpZGV2aWNlX2lkJyk7XG4gICAgICBhcmdzLnB1c2goJy1sJyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjbWQgPSByZXF1aXJlLnJlc29sdmUoJ3VkaWRldGVjdCcpO1xuICAgIH1cbiAgICBsZXQgdWRpZDtcbiAgICB0cnkge1xuICAgICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyhjbWQsIGFyZ3MsIHt0aW1lb3V0OiAzMDAwfSk7XG4gICAgICB1ZGlkID0gc3Rkb3V0LnNwbGl0KFwiXFxuXCIpWzBdO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiRXJyb3IgZGV0ZWN0aW5nIHVkaWRcIik7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGlmICh1ZGlkICYmIHVkaWQubGVuZ3RoID4gMikge1xuICAgICAgY2Fwcy51ZGlkID0gdWRpZDtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgRGV0ZWN0ZWQgdWRpZCBhcyAnJHtjYXBzLnVkaWR9J2ApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZGV0ZWN0IHVkaWQuXCIpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZGVidWcoXCJOb3QgYXV0by1kZXRlY3RpbmcgdWRpZC5cIik7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVhZFJlc291cmNlIChyZXNvdXJjZVBhdGgpIHtcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHBsaXN0LnBhcnNlUGxpc3RGaWxlKHJlc291cmNlUGF0aCk7XG4gIGNvbnN0IHJlc3VsdCA9IHt9O1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMoZGF0YSkpIHtcbiAgICByZXN1bHRba2V5XSA9IF8uaXNTdHJpbmcodmFsdWUpID8gdmFsdWUgOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcGFyc2VMb2NhbGl6YWJsZVN0cmluZ3MgKG9wdHMpIHtcbiAgY29uc3Qge1xuICAgIGFwcCxcbiAgICBsYW5ndWFnZSA9ICdlbicsXG4gICAgbG9jYWxpemFibGVTdHJpbmdzRGlyLFxuICAgIHN0cmluZ0ZpbGUsXG4gICAgc3RyaWN0TW9kZSxcbiAgfSA9IG9wdHM7XG5cbiAgaWYgKCFhcHApIHtcbiAgICBjb25zdCBtZXNzYWdlID0gXCJTdHJpbmdzIGV4dHJhY3Rpb24gaXMgbm90IHN1cHBvcnRlZCBpZiAnYXBwJyBjYXBhYmlsaXR5IGlzIG5vdCBzZXRcIjtcbiAgICBpZiAoc3RyaWN0TW9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBsb2dnZXIuaW5mbyhtZXNzYWdlKTtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBsZXQgbHByb2pSb290O1xuICBmb3IgKGNvbnN0IHN1YmZvbGRlciBvZiBbYCR7bGFuZ3VhZ2V9Lmxwcm9qYCwgbG9jYWxpemFibGVTdHJpbmdzRGlyLCAnJ10pIHtcbiAgICBscHJvalJvb3QgPSBwYXRoLnJlc29sdmUoYXBwLCBzdWJmb2xkZXIpO1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMobHByb2pSb290KSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2UgPSBgTm8gJyR7bHByb2pSb290fScgcmVzb3VyY2VzIGZvbGRlciBoYXMgYmVlbiBmb3VuZGA7XG4gICAgaWYgKHN0cmljdE1vZGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB9XG4gICAgbG9nZ2VyLmRlYnVnKG1lc3NhZ2UpO1xuICB9XG4gIGxvZ2dlci5pbmZvKGBXaWxsIGV4dHJhY3QgcmVzb3VyY2Ugc3RyaW5ncyBmcm9tICcke2xwcm9qUm9vdH0nYCk7XG5cbiAgY29uc3QgcmVzb3VyY2VQYXRocyA9IFtdO1xuICBpZiAoc3RyaW5nRmlsZSkge1xuICAgIGNvbnN0IGRzdFBhdGggPSBwYXRoLnJlc29sdmUobHByb2pSb290LCBzdHJpbmdGaWxlKTtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGRzdFBhdGgpKSB7XG4gICAgICByZXNvdXJjZVBhdGhzLnB1c2goZHN0UGF0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgTm8gJyR7ZHN0UGF0aH0nIHJlc291cmNlIGZpbGUgaGFzIGJlZW4gZm91bmQgZm9yICcke2FwcH0nYDtcbiAgICAgIGlmIChzdHJpY3RNb2RlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5pbmZvKG1lc3NhZ2UpO1xuICAgICAgbG9nZ2VyLmluZm8oYEdldHRpbmcgYWxsIHRoZSBhdmFpbGFibGUgc3RyaW5ncyBmcm9tICcke2xwcm9qUm9vdH0nYCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShyZXNvdXJjZVBhdGhzKSAmJiBhd2FpdCBmcy5leGlzdHMobHByb2pSb290KSkge1xuICAgIGNvbnN0IHJlc291cmNlRmlsZXMgPSAoYXdhaXQgZnMucmVhZGRpcihscHJvalJvb3QpKVxuICAgICAgLmZpbHRlcigobmFtZSkgPT4gXy5zb21lKFtTVFJJTkdTX1JFU09VUkNFLCBTVFJJTkdTRElDVF9SRVNPVVJDRV0sICh4KSA9PiBuYW1lLmVuZHNXaXRoKHgpKSlcbiAgICAgIC5tYXAoKG5hbWUpID0+IHBhdGgucmVzb2x2ZShscHJvalJvb3QsIG5hbWUpKTtcbiAgICByZXNvdXJjZVBhdGhzLnB1c2goLi4ucmVzb3VyY2VGaWxlcyk7XG4gIH1cbiAgbG9nZ2VyLmluZm8oYEdvdCAke3Jlc291cmNlUGF0aHMubGVuZ3RofSByZXNvdXJjZSBmaWxlKHMpIGluICcke2xwcm9qUm9vdH0nYCk7XG5cbiAgaWYgKF8uaXNFbXB0eShyZXNvdXJjZVBhdGhzKSkge1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdFN0cmluZ3MgPSB7fTtcbiAgY29uc3QgdG9BYnNvbHV0ZVBhdGggPSBmdW5jdGlvbiAocCkge1xuICAgIHJldHVybiBwYXRoLmlzQWJzb2x1dGUocCkgPyBwIDogcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIHApO1xuICB9O1xuICBmb3IgKGNvbnN0IHJlc291cmNlUGF0aCBvZiByZXNvdXJjZVBhdGhzKSB7XG4gICAgaWYgKCF1dGlsLmlzU3ViUGF0aCh0b0Fic29sdXRlUGF0aChyZXNvdXJjZVBhdGgpLCB0b0Fic29sdXRlUGF0aChhcHApKSkge1xuICAgICAgLy8gc2VjdXJpdHkgcHJlY2F1dGlvblxuICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtyZXNvdXJjZVBhdGh9JyBpcyBleHBlY3RlZCB0byBiZSBsb2NhdGVkIHVuZGVyICcke2FwcH0nYCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVhZFJlc291cmNlKHJlc291cmNlUGF0aCk7XG4gICAgICBsb2dnZXIuZGVidWcoYFBhcnNlZCAke18ua2V5cyhkYXRhKS5sZW5ndGh9IHN0cmluZyhzKSBmcm9tICcke3Jlc291cmNlUGF0aH0nYCk7XG4gICAgICBfLm1lcmdlKHJlc3VsdFN0cmluZ3MsIGRhdGEpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBDYW5ub3QgcGFyc2UgJyR7cmVzb3VyY2VQYXRofScgcmVzb3VyY2UuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICBsb2dnZXIuaW5mbyhgR290ICR7Xy5rZXlzKHJlc3VsdFN0cmluZ3MpLmxlbmd0aH0gc3RyaW5nKHMpIGZyb20gJyR7bHByb2pSb290fSdgKTtcbiAgcmV0dXJuIHJlc3VsdFN0cmluZ3M7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNldEJ1bmRsZUlkRnJvbUFwcCAoY2Fwcykge1xuICAvLyBUaGlzIG1ldGhvZCB3aWxsIHRyeSB0byBleHRyYWN0IHRoZSBidW5kbGVJZCBmcm9tIHRoZSBhcHBcbiAgaWYgKCFjYXBzLmJ1bmRsZUlkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNhcHMuYnVuZGxlSWQgPSBhd2FpdCBleHRyYWN0QnVuZGxlSWQoY2Fwcy5hcHApO1xuICAgICAgbG9nZ2VyLmluZm8oYEV4dHJhY3RlZCBidW5kbGVJRDogJHtjYXBzLmJ1bmRsZUlkfSBmcm9tIGFwcDogJHtjYXBzLmFwcH1gKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkNvdWxkIG5vdCBzZXQgdGhlIGJ1bmRsZUlkIGZyb20gYXBwLlwiKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gc2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yIChjYXBzLCBpb3NTZGtWZXJzaW9uKSB7XG4gIGxldCBzaG91bGRQcmVsYXVuY2ggPSBmYWxzZTtcblxuICBpZiAoY2Fwcy5kZWZhdWx0RGV2aWNlIHx8IGlvc1Nka1ZlcnNpb24gPj0gNy4xKSB7XG4gICAgaWYgKHRoaXMuaW9zU2RrVmVyc2lvbiA+PSA3LjEpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIldlJ3JlIG9uIGlPUzcuMSsgc28gZm9yY2luZyBkZWZhdWx0RGV2aWNlIG9uXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJVc2VyIHNwZWNpZmllZCBkZWZhdWx0IGRldmljZSwgbGV0dGluZyBpbnN0cnVtZW50cyBsYXVuY2ggaXRcIik7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHNob3VsZFByZWxhdW5jaCA9IHRydWU7XG4gIH1cbiAgcmV0dXJuIHNob3VsZFByZWxhdW5jaDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0RGV2aWNlVHlwZUluSW5mb1BsaXN0IChhcHAsIGRldmljZVN0cmluZykge1xuICBpZiAoXy5pc051bGwoYXBwKSB8fCBfLmlzVW5kZWZpbmVkKGFwcCkpIHsgcmV0dXJuOyB9XG4gIGxldCBwbGlzdEZpbGUgPSBwYXRoLnJlc29sdmUoYXBwLCBcIkluZm8ucGxpc3RcIik7XG4gIGxldCBpc2lQaG9uZSA9IGRldmljZVN0cmluZy50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJpcGFkXCIpID09PSAtMTtcbiAgbGV0IGRldmljZVR5cGVDb2RlID0gaXNpUGhvbmUgPyAxIDogMjtcbiAgYXdhaXQgcGxpc3QudXBkYXRlUGxpc3RGaWxlKHBsaXN0RmlsZSwge1VJRGV2aWNlRmFtaWx5OiBbZGV2aWNlVHlwZUNvZGVdfSk7XG59XG5cbmZ1bmN0aW9uIHVud3JhcEVsIChlbCkge1xuICBpZiAodHlwZW9mIGVsID09PSAnb2JqZWN0JyAmJiBlbC5FTEVNRU5UKSB7XG4gICAgcmV0dXJuIGVsLkVMRU1FTlQ7XG4gIH1cbiAgcmV0dXJuIGVsO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjbGVhckxvZ3MgKGxvY2F0aW9ucykge1xuICBsb2dnZXIuZGVidWcoJ0NsZWFyaW5nIGxvZyBmaWxlcycpO1xuICBmb3IgKGxldCBsb2NhdGlvbiBvZiBsb2NhdGlvbnMpIHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxvY2F0aW9uKSkge1xuICAgICAgbGV0IHNpemU7XG4gICAgICB0cnkge1xuICAgICAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdkdScsIFsnLXNoJywgbG9jYXRpb25dKTtcbiAgICAgICAgc2l6ZSA9IHN0ZG91dC50cmltKCkuc3BsaXQoL1xccysvKVswXTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICAgIHRyeSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgRGVsZXRpbmcgJyR7bG9jYXRpb259Jy4gJHtzaXplID8gYEZyZWVpbmcgJHtzaXplfS5gIDogJyd9YCk7XG4gICAgICAgIGF3YWl0IGZzLnJpbXJhZihsb2NhdGlvbik7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oYFVuYWJsZSB0byBkZWxldGUgJyR7bG9jYXRpb259JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgbG9nZ2VyLmRlYnVnKCdGaW5pc2hlZCBjbGVhcmluZyBsb2cgZmlsZXMnKTtcbn1cblxuZXhwb3J0IHtcbiAgcm9vdERpciwgcmVtb3ZlSW5zdHJ1bWVudHNTb2NrZXQsIGdldEFuZENoZWNrWGNvZGVWZXJzaW9uLCBwcmVwYXJlSW9zT3B0cyxcbiAgYXBwSXNQYWNrYWdlT3JCdW5kbGUsIGdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiwgZGV0ZWN0VWRpZCwgcGFyc2VMb2NhbGl6YWJsZVN0cmluZ3MsXG4gIHNldEJ1bmRsZUlkRnJvbUFwcCwgc2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yLCBzZXREZXZpY2VUeXBlSW5JbmZvUGxpc3QsXG4gIGdldFNpbUZvckRldmljZVN0cmluZywgdW53cmFwRWwsIGNsZWFyTG9ncyxcbn07XG4iXSwiZmlsZSI6ImxpYi91dGlscy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
