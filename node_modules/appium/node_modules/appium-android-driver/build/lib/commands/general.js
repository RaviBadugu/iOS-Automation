"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseWindows = parseWindows;
exports.parseSurfaceLine = parseSurfaceLine;
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _logger = _interopRequireDefault(require("../logger"));

var _webviewHelpers = require("../webview-helpers");

var _moment = _interopRequireDefault(require("moment"));

var _asyncbox = require("asyncbox");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keys = async function (keys) {
  keys = _lodash.default.isArray(keys) ? keys.join('') : keys;
  let params = {
    text: keys,
    replace: false
  };

  if (this.opts.unicodeKeyboard) {
    params.unicodeKeyboard = true;
  }

  await this.doSendKeys(params);
};

commands.doSendKeys = async function (params) {
  return await this.bootstrap.sendAction('setText', params);
};

const DEFAULT_DEVICE_TIME = 'YYYY-MM-DDTHH:mm:ssZ';

commands.getDeviceTime = async function (format = DEFAULT_DEVICE_TIME) {
  _logger.default.info('Attempting to capture android device date and time');

  if (!_lodash.default.isString(format)) {
    _logger.default.errorAndThrow(`The format specifier is expected to be a valid string specifier like '${DEFAULT_DEVICE_TIME}'. ` + `The current value is: ${format}`);
  }

  const deviceTimestamp = (await this.adb.shell(['date', '+%Y-%m-%dT%T%z'])).trim();
  const parsedTimestamp = (0, _moment.default)(deviceTimestamp, 'YYYY-MM-DDTHH:mm:ssZ');

  if (!parsedTimestamp.isValid()) {
    _logger.default.warn(`Cannot parse the returned timestamp '${deviceTimestamp}'. Returning as is`);

    return deviceTimestamp;
  }

  return parsedTimestamp.format(format);
};

commands.getPageSource = async function () {
  return await this.bootstrap.sendAction('source');
};

commands.back = async function () {
  return await this.bootstrap.sendAction('pressBack');
};

commands.isKeyboardShown = async function () {
  let keyboardInfo = await this.adb.isSoftKeyboardPresent();
  return keyboardInfo.isKeyboardShown;
};

commands.hideKeyboard = async function () {
  let {
    isKeyboardShown,
    canCloseKeyboard
  } = await this.adb.isSoftKeyboardPresent();

  if (isKeyboardShown) {
    if (canCloseKeyboard) {
      await this.adb.keyevent(111);
    }

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        ({
          isKeyboardShown
        } = await this.adb.isSoftKeyboardPresent());
        return !isKeyboardShown;
      }, {
        waitMs: 2000,
        intervalMs: 500
      });
    } catch (err) {
      throw new Error(`The software keyboard cannot be closed`);
    }
  } else {
    _logger.default.info('Keyboard has no UI; no closing necessary');
  }
};

commands.openSettingsActivity = async function (setting) {
  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.shell(['am', 'start', '-a', `android.settings.${setting}`]);
  await this.adb.waitForNotActivity(appPackage, appActivity, 5000);
};

commands.getWindowSize = async function () {
  return await this.bootstrap.sendAction('getDeviceSize');
};

commands.getWindowRect = async function () {
  const {
    width,
    height
  } = await this.getWindowSize();
  return {
    width,
    height,
    x: 0,
    y: 0
  };
};

commands.getCurrentActivity = async function () {
  return (await this.adb.getFocusedPackageAndActivity()).appActivity;
};

commands.getCurrentPackage = async function () {
  return (await this.adb.getFocusedPackageAndActivity()).appPackage;
};

commands.background = async function (seconds) {
  if (seconds < 0) {
    await this.adb.goToHome();
    return true;
  }

  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.goToHome();
  await _bluebird.default.delay(seconds * 1000);
  let args;

  if (this._cachedActivityArgs && this._cachedActivityArgs[`${appPackage}/${appActivity}`]) {
    args = this._cachedActivityArgs[`${appPackage}/${appActivity}`];
  } else {
    try {
      _logger.default.debug(`Activating app '${appPackage}' in order to restore it`);

      await this.activateApp(appPackage);
      return true;
    } catch (ign) {}

    args = appPackage === this.opts.appPackage && appActivity === this.opts.appActivity || appPackage === this.opts.appWaitPackage && (this.opts.appWaitActivity || '').split(',').includes(appActivity) ? {
      pkg: this.opts.appPackage,
      activity: this.opts.appActivity,
      action: this.opts.intentAction,
      category: this.opts.intentCategory,
      flags: this.opts.intentFlags,
      waitPkg: this.opts.appWaitPackage,
      waitActivity: this.opts.appWaitActivity,
      optionalIntentArguments: this.opts.optionalIntentArguments,
      stopApp: false,
      user: this.opts.userProfile
    } : {
      pkg: appPackage,
      activity: appActivity,
      waitPkg: appPackage,
      waitActivity: appActivity,
      stopApp: false
    };
  }

  args = await _appiumSupport.util.filterObject(args);

  _logger.default.debug(`Bringing application back to foreground with arguments: ${JSON.stringify(args)}`);

  return await this.adb.startApp(args);
};

commands.getStrings = async function (language) {
  if (!language) {
    language = await this.adb.getDeviceLanguage();

    _logger.default.info(`No language specified, returning strings for: ${language}`);
  }

  const preprocessStringsMap = mapping => {
    const result = {};

    for (const [key, value] of _lodash.default.toPairs(mapping)) {
      result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
    }

    return result;
  };

  if (this.apkStrings[language]) {
    return preprocessStringsMap(this.apkStrings[language]);
  }

  this.apkStrings[language] = await _androidHelpers.default.pushStrings(language, this.adb, this.opts);

  if (this.bootstrap) {
    await this.bootstrap.sendAction('updateStrings');
  }

  return preprocessStringsMap(this.apkStrings[language]);
};

commands.launchApp = async function () {
  await this.initAUT();
  await this.startAUT();
};

commands.startActivity = async function (appPackage, appActivity, appWaitPackage, appWaitActivity, intentAction, intentCategory, intentFlags, optionalIntentArguments, dontStopAppOnReset) {
  _logger.default.debug(`Starting package '${appPackage}' and activity '${appActivity}'`);

  if (!_appiumSupport.util.hasValue(dontStopAppOnReset)) {
    dontStopAppOnReset = !!this.opts.dontStopAppOnReset;
  }

  let args = {
    pkg: appPackage,
    activity: appActivity,
    waitPkg: appWaitPackage || appPackage,
    waitActivity: appWaitActivity || appActivity,
    action: intentAction,
    category: intentCategory,
    flags: intentFlags,
    optionalIntentArguments,
    stopApp: !dontStopAppOnReset
  };
  this._cachedActivityArgs = this._cachedActivityArgs || {};
  this._cachedActivityArgs[`${args.waitPkg}/${args.waitActivity}`] = args;
  await this.adb.startApp(args);
};

commands.reset = async function () {
  await _androidHelpers.default.resetApp(this.adb, Object.assign({}, this.opts, {
    fastReset: true
  }));
  this.curContext = _webviewHelpers.NATIVE_WIN;
  return (await this.isChromeSession) ? this.startChromeSession() : this.startAUT();
};

commands.startAUT = async function () {
  await this.adb.startApp({
    pkg: this.opts.appPackage,
    activity: this.opts.appActivity,
    action: this.opts.intentAction,
    category: this.opts.intentCategory,
    flags: this.opts.intentFlags,
    waitPkg: this.opts.appWaitPackage,
    waitActivity: this.opts.appWaitActivity,
    waitDuration: this.opts.appWaitDuration,
    optionalIntentArguments: this.opts.optionalIntentArguments,
    stopApp: !this.opts.dontStopAppOnReset,
    user: this.opts.userProfile
  });
};

commands.setUrl = async function (uri) {
  await this.adb.startUri(uri, this.opts.appPackage);
};

commands.closeApp = async function () {
  await this.adb.forceStop(this.opts.appPackage);
  this.curContext = _webviewHelpers.NATIVE_WIN;
  await this.stopChromedriverProxies();
};

commands.getDisplayDensity = async function () {
  let out = await this.adb.shell(['getprop', 'ro.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  out = await this.adb.shell(['getprop', 'qemu.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  _logger.default.errorAndThrow('Failed to get display density property.');
};

function parseSurfaceLine(line) {
  let bounds = line.split('rect=')[1].replace(/[(), x]+/g, ' ').trim().split(' ');
  return {
    visible: line.indexOf('shown=true') !== -1,
    x: parseFloat(bounds[0]),
    y: parseFloat(bounds[1]),
    width: parseFloat(bounds[2]),
    height: parseFloat(bounds[3])
  };
}

function parseWindows(lines) {
  let atStatusBar = false;
  let atNavBar = false;
  let statusBar;
  let navigationBar;
  lines.split('\n').forEach(line => {
    if (line.indexOf('  Window #') !== -1) {
      atStatusBar = line.indexOf('StatusBar') !== -1;
      atNavBar = line.indexOf('NavigationBar') !== -1;
      return;
    }

    if (line.indexOf('      Surface:') === -1) {
      return;
    }

    if (atStatusBar) {
      statusBar = parseSurfaceLine(line);
      atStatusBar = false;
    } else if (atNavBar) {
      navigationBar = parseSurfaceLine(line);
      atNavBar = false;
    }
  });

  if (!statusBar) {
    _logger.default.errorAndThrow('Failed to parse status bar information.');
  }

  if (!navigationBar) {
    _logger.default.errorAndThrow('Failed to parse navigation bar information.');
  }

  return {
    statusBar,
    navigationBar
  };
}

commands.getSystemBars = async function () {
  let out = await this.adb.shell(['dumpsys', 'window', 'windows']);

  if (!out) {
    _logger.default.errorAndThrow('Did not get window manager output.');
  }

  return parseWindows(out);
};

commands.mobilePerformEditorAction = async function (opts = {}) {
  const {
    action
  } = opts;

  if (!_appiumSupport.util.hasValue(action)) {
    _logger.default.errorAndThrow(`'action' argument is required`);
  }

  await this.adb.performEditorAction(action);
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZW5lcmFsLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJrZXlzIiwiXyIsImlzQXJyYXkiLCJqb2luIiwicGFyYW1zIiwidGV4dCIsInJlcGxhY2UiLCJvcHRzIiwidW5pY29kZUtleWJvYXJkIiwiZG9TZW5kS2V5cyIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJERUZBVUxUX0RFVklDRV9USU1FIiwiZ2V0RGV2aWNlVGltZSIsImZvcm1hdCIsImxvZyIsImluZm8iLCJpc1N0cmluZyIsImVycm9yQW5kVGhyb3ciLCJkZXZpY2VUaW1lc3RhbXAiLCJhZGIiLCJzaGVsbCIsInRyaW0iLCJwYXJzZWRUaW1lc3RhbXAiLCJpc1ZhbGlkIiwid2FybiIsImdldFBhZ2VTb3VyY2UiLCJiYWNrIiwiaXNLZXlib2FyZFNob3duIiwia2V5Ym9hcmRJbmZvIiwiaXNTb2Z0S2V5Ym9hcmRQcmVzZW50IiwiaGlkZUtleWJvYXJkIiwiY2FuQ2xvc2VLZXlib2FyZCIsImtleWV2ZW50Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImVyciIsIkVycm9yIiwib3BlblNldHRpbmdzQWN0aXZpdHkiLCJzZXR0aW5nIiwiYXBwUGFja2FnZSIsImFwcEFjdGl2aXR5IiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIndhaXRGb3JOb3RBY3Rpdml0eSIsImdldFdpbmRvd1NpemUiLCJnZXRXaW5kb3dSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJ4IiwieSIsImdldEN1cnJlbnRBY3Rpdml0eSIsImdldEN1cnJlbnRQYWNrYWdlIiwiYmFja2dyb3VuZCIsInNlY29uZHMiLCJnb1RvSG9tZSIsIkIiLCJkZWxheSIsImFyZ3MiLCJfY2FjaGVkQWN0aXZpdHlBcmdzIiwiZGVidWciLCJhY3RpdmF0ZUFwcCIsImlnbiIsImFwcFdhaXRQYWNrYWdlIiwiYXBwV2FpdEFjdGl2aXR5Iiwic3BsaXQiLCJpbmNsdWRlcyIsInBrZyIsImFjdGl2aXR5IiwiYWN0aW9uIiwiaW50ZW50QWN0aW9uIiwiY2F0ZWdvcnkiLCJpbnRlbnRDYXRlZ29yeSIsImZsYWdzIiwiaW50ZW50RmxhZ3MiLCJ3YWl0UGtnIiwid2FpdEFjdGl2aXR5Iiwib3B0aW9uYWxJbnRlbnRBcmd1bWVudHMiLCJzdG9wQXBwIiwidXNlciIsInVzZXJQcm9maWxlIiwidXRpbCIsImZpbHRlck9iamVjdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGFydEFwcCIsImdldFN0cmluZ3MiLCJsYW5ndWFnZSIsImdldERldmljZUxhbmd1YWdlIiwicHJlcHJvY2Vzc1N0cmluZ3NNYXAiLCJtYXBwaW5nIiwicmVzdWx0Iiwia2V5IiwidmFsdWUiLCJ0b1BhaXJzIiwiYXBrU3RyaW5ncyIsImFuZHJvaWRIZWxwZXJzIiwicHVzaFN0cmluZ3MiLCJsYXVuY2hBcHAiLCJpbml0QVVUIiwic3RhcnRBVVQiLCJzdGFydEFjdGl2aXR5IiwiZG9udFN0b3BBcHBPblJlc2V0IiwiaGFzVmFsdWUiLCJyZXNldCIsInJlc2V0QXBwIiwiT2JqZWN0IiwiYXNzaWduIiwiZmFzdFJlc2V0IiwiY3VyQ29udGV4dCIsIk5BVElWRV9XSU4iLCJpc0Nocm9tZVNlc3Npb24iLCJzdGFydENocm9tZVNlc3Npb24iLCJ3YWl0RHVyYXRpb24iLCJhcHBXYWl0RHVyYXRpb24iLCJzZXRVcmwiLCJ1cmkiLCJzdGFydFVyaSIsImNsb3NlQXBwIiwiZm9yY2VTdG9wIiwic3RvcENocm9tZWRyaXZlclByb3hpZXMiLCJnZXREaXNwbGF5RGVuc2l0eSIsIm91dCIsInZhbCIsInBhcnNlSW50IiwiaXNOYU4iLCJwYXJzZVN1cmZhY2VMaW5lIiwibGluZSIsImJvdW5kcyIsInZpc2libGUiLCJpbmRleE9mIiwicGFyc2VGbG9hdCIsInBhcnNlV2luZG93cyIsImxpbmVzIiwiYXRTdGF0dXNCYXIiLCJhdE5hdkJhciIsInN0YXR1c0JhciIsIm5hdmlnYXRpb25CYXIiLCJmb3JFYWNoIiwiZ2V0U3lzdGVtQmFy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RDs7QUFFRDNJLFFBQVEsQ0FBQzZJLGFBQVQsR0FBeUIsa0JBQWtCO0FBQ3pDLE1BQUlqQixHQUFHLEdBQUcsTUFBTSxLQUFLckcsR0FBTCxDQUFTQyxLQUFULENBQWUsQ0FBQyxTQUFELEVBQVksUUFBWixFQUFzQixTQUF0QixDQUFmLENBQWhCOztBQUNBLE1BQUksQ0FBQ29HLEdBQUwsRUFBVTtBQUNSMUcsb0JBQUlHLGFBQUosQ0FBa0Isb0NBQWxCO0FBQ0Q7O0FBQ0QsU0FBT2lILFlBQVksQ0FBQ1YsR0FBRCxDQUFuQjtBQUNELENBTkQ7O0FBUUE1SCxRQUFRLENBQUM4SSx5QkFBVCxHQUFxQyxnQkFBZ0JwSSxJQUFJLEdBQUcsRUFBdkIsRUFBMkI7QUFDOUQsUUFBTTtBQUFDNkQsSUFBQUE7QUFBRCxNQUFXN0QsSUFBakI7O0FBQ0EsTUFBSSxDQUFDeUUsb0JBQUtzQixRQUFMLENBQWNsQyxNQUFkLENBQUwsRUFBNEI7QUFDMUJyRCxvQkFBSUcsYUFBSixDQUFtQiwrQkFBbkI7QUFDRDs7QUFFRCxRQUFNLEtBQUtFLEdBQUwsQ0FBU3dILG1CQUFULENBQTZCeEUsTUFBN0IsQ0FBTjtBQUNELENBUEQ7O0FBU0FxQyxNQUFNLENBQUNDLE1BQVAsQ0FBYzNHLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBhbmRyb2lkSGVscGVycyBmcm9tICcuLi9hbmRyb2lkLWhlbHBlcnMnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCB7IE5BVElWRV9XSU4gfSBmcm9tICcuLi93ZWJ2aWV3LWhlbHBlcnMnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5jb21tYW5kcy5rZXlzID0gYXN5bmMgZnVuY3Rpb24gKGtleXMpIHtcbiAgLy8gUHJvdG9jb2wgc2VuZHMgYW4gYXJyYXk7IHJldGhpbmsgYXBwcm9hY2hcbiAga2V5cyA9IF8uaXNBcnJheShrZXlzKSA/IGtleXMuam9pbignJykgOiBrZXlzO1xuICBsZXQgcGFyYW1zID0ge1xuICAgIHRleHQ6IGtleXMsXG4gICAgcmVwbGFjZTogZmFsc2VcbiAgfTtcbiAgaWYgKHRoaXMub3B0cy51bmljb2RlS2V5Ym9hcmQpIHtcbiAgICBwYXJhbXMudW5pY29kZUtleWJvYXJkID0gdHJ1ZTtcbiAgfVxuICBhd2FpdCB0aGlzLmRvU2VuZEtleXMocGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLmRvU2VuZEtleXMgPSBhc3luYyBmdW5jdGlvbiAocGFyYW1zKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdzZXRUZXh0JywgcGFyYW1zKTtcbn07XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IGRldmljZSdzIHRpbWVzdGFtcC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZm9ybWF0IC0gVGhlIHNldCBvZiBmb3JtYXQgc3BlY2lmaWVycy4gUmVhZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBzOi8vbW9tZW50anMuY29tL2RvY3MvIHRvIGdldCB0aGUgZnVsbCBsaXN0IG9mIHN1cHBvcnRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGV0aW1lIGZvcm1hdCBzcGVjaWZpZXJzLiBUaGUgZGVmYXVsdCBmb3JtYXQgaXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBgWVlZWS1NTS1ERFRISDptbTpzc1pgLCB3aGljaCBjb21wbGllcyB0byBJU08tODYwMVxuICogQHJldHVybnMgRm9ybWF0dGVkIGRhdGV0aW1lIHN0cmluZyBvciB0aGUgcmF3IGNvbW1hbmQgb3V0cHV0IGlmIGZvcm1hdHRpbmcgZmFpbHNcbiAqL1xuY29uc3QgREVGQVVMVF9ERVZJQ0VfVElNRSA9ICdZWVlZLU1NLUREVEhIOm1tOnNzWic7XG5jb21tYW5kcy5nZXREZXZpY2VUaW1lID0gYXN5bmMgZnVuY3Rpb24gKGZvcm1hdCA9IERFRkFVTFRfREVWSUNFX1RJTUUpIHtcbiAgbG9nLmluZm8oJ0F0dGVtcHRpbmcgdG8gY2FwdHVyZSBhbmRyb2lkIGRldmljZSBkYXRlIGFuZCB0aW1lJyk7XG5cbiAgaWYgKCFfLmlzU3RyaW5nKGZvcm1hdCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGZvcm1hdCBzcGVjaWZpZXIgaXMgZXhwZWN0ZWQgdG8gYmUgYSB2YWxpZCBzdHJpbmcgc3BlY2lmaWVyIGxpa2UgJyR7REVGQVVMVF9ERVZJQ0VfVElNRX0nLiBgICtcbiAgICAgICAgYFRoZSBjdXJyZW50IHZhbHVlIGlzOiAke2Zvcm1hdH1gKTtcbiAgfVxuXG4gIGNvbnN0IGRldmljZVRpbWVzdGFtcCA9IChhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2RhdGUnLCAnKyVZLSVtLSVkVCVUJXonXSkpLnRyaW0oKTtcbiAgY29uc3QgcGFyc2VkVGltZXN0YW1wID0gbW9tZW50KGRldmljZVRpbWVzdGFtcCwgJ1lZWVktTU0tRERUSEg6bW06c3NaJyk7XG4gIGlmICghcGFyc2VkVGltZXN0YW1wLmlzVmFsaWQoKSkge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgcGFyc2UgdGhlIHJldHVybmVkIHRpbWVzdGFtcCAnJHtkZXZpY2VUaW1lc3RhbXB9Jy4gUmV0dXJuaW5nIGFzIGlzYCk7XG4gICAgcmV0dXJuIGRldmljZVRpbWVzdGFtcDtcbiAgfVxuICByZXR1cm4gcGFyc2VkVGltZXN0YW1wLmZvcm1hdChmb3JtYXQpO1xufTtcblxuY29tbWFuZHMuZ2V0UGFnZVNvdXJjZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3NvdXJjZScpO1xufTtcblxuY29tbWFuZHMuYmFjayA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3ByZXNzQmFjaycpO1xufTtcblxuY29tbWFuZHMuaXNLZXlib2FyZFNob3duID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQga2V5Ym9hcmRJbmZvID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCk7XG4gIHJldHVybiBrZXlib2FyZEluZm8uaXNLZXlib2FyZFNob3duO1xufTtcblxuY29tbWFuZHMuaGlkZUtleWJvYXJkID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQge2lzS2V5Ym9hcmRTaG93biwgY2FuQ2xvc2VLZXlib2FyZH0gPSBhd2FpdCB0aGlzLmFkYi5pc1NvZnRLZXlib2FyZFByZXNlbnQoKTtcbiAgaWYgKGlzS2V5Ym9hcmRTaG93bikge1xuICAgIGlmIChjYW5DbG9zZUtleWJvYXJkKSB7XG4gICAgICAvLyBQcmVzcyBlc2NhcGVcbiAgICAgIGF3YWl0IHRoaXMuYWRiLmtleWV2ZW50KDExMSk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgICAgKHtpc0tleWJvYXJkU2hvd259ID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCkpO1xuICAgICAgICByZXR1cm4gIWlzS2V5Ym9hcmRTaG93bjtcbiAgICAgIH0sIHt3YWl0TXM6IDIwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgc29mdHdhcmUga2V5Ym9hcmQgY2Fubm90IGJlIGNsb3NlZGApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsb2cuaW5mbygnS2V5Ym9hcmQgaGFzIG5vIFVJOyBubyBjbG9zaW5nIG5lY2Vzc2FyeScpO1xuICB9XG59O1xuXG5jb21tYW5kcy5vcGVuU2V0dGluZ3NBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIChzZXR0aW5nKSB7XG4gIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpO1xuICBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2FtJywgJ3N0YXJ0JywgJy1hJywgYGFuZHJvaWQuc2V0dGluZ3MuJHtzZXR0aW5nfWBdKTtcbiAgYXdhaXQgdGhpcy5hZGIud2FpdEZvck5vdEFjdGl2aXR5KGFwcFBhY2thZ2UsIGFwcEFjdGl2aXR5LCA1MDAwKTtcbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd1NpemUgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdnZXREZXZpY2VTaXplJyk7XG59O1xuXG4vLyBGb3IgVzNDXG5jb21tYW5kcy5nZXRXaW5kb3dSZWN0ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGF3YWl0IHRoaXMuZ2V0V2luZG93U2l6ZSgpO1xuICByZXR1cm4ge1xuICAgIHdpZHRoLFxuICAgIGhlaWdodCxcbiAgICB4OiAwLFxuICAgIHk6IDBcbiAgfTtcbn07XG5cbmNvbW1hbmRzLmdldEN1cnJlbnRBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIChhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCkpLmFwcEFjdGl2aXR5O1xufTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudFBhY2thZ2UgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiAoYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpKS5hcHBQYWNrYWdlO1xufTtcblxuY29tbWFuZHMuYmFja2dyb3VuZCA9IGFzeW5jIGZ1bmN0aW9uIChzZWNvbmRzKSB7XG4gIGlmIChzZWNvbmRzIDwgMCkge1xuICAgIC8vIGlmIHVzZXIgcGFzc2VzIGluIGEgbmVnYXRpdmUgc2Vjb25kcyB2YWx1ZSwgaW50ZXJwcmV0IHRoYXQgYXMgdGhlIGluc3RydWN0aW9uXG4gICAgLy8gdG8gbm90IGJyaW5nIHRoZSBhcHAgYmFjayBhdCBhbGxcbiAgICBhd2FpdCB0aGlzLmFkYi5nb1RvSG9tZSgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpO1xuICBhd2FpdCB0aGlzLmFkYi5nb1RvSG9tZSgpO1xuICBhd2FpdCBCLmRlbGF5KHNlY29uZHMgKiAxMDAwKTtcblxuICBsZXQgYXJncztcbiAgaWYgKHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJncyAmJiB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3NbYCR7YXBwUGFja2FnZX0vJHthcHBBY3Rpdml0eX1gXSkge1xuICAgIC8vIHRoZSBhY3Rpdml0eSB3YXMgc3RhcnRlZCB3aXRoIGBzdGFydEFjdGl2aXR5YCwgc28gdXNlIHRob3NlIGFyZ3MgdG8gcmVzdGFydFxuICAgIGFyZ3MgPSB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3NbYCR7YXBwUGFja2FnZX0vJHthcHBBY3Rpdml0eX1gXTtcbiAgfSBlbHNlIHtcbiAgICB0cnkge1xuICAgICAgbG9nLmRlYnVnKGBBY3RpdmF0aW5nIGFwcCAnJHthcHBQYWNrYWdlfScgaW4gb3JkZXIgdG8gcmVzdG9yZSBpdGApO1xuICAgICAgYXdhaXQgdGhpcy5hY3RpdmF0ZUFwcChhcHBQYWNrYWdlKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICBhcmdzID0gKChhcHBQYWNrYWdlID09PSB0aGlzLm9wdHMuYXBwUGFja2FnZSAmJiBhcHBBY3Rpdml0eSA9PT0gdGhpcy5vcHRzLmFwcEFjdGl2aXR5KSB8fFxuICAgICAgICAgICAgKGFwcFBhY2thZ2UgPT09IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSAmJiAodGhpcy5vcHRzLmFwcFdhaXRBY3Rpdml0eSB8fCAnJykuc3BsaXQoJywnKS5pbmNsdWRlcyhhcHBBY3Rpdml0eSkpKVxuICAgICAgPyB7Ly8gdGhlIGFjdGl2aXR5IGlzIHRoZSBvcmlnaW5hbCBzZXNzaW9uIGFjdGl2aXR5LCBzbyB1c2UgdGhlIG9yaWdpbmFsIGFyZ3NcbiAgICAgICAgcGtnOiB0aGlzLm9wdHMuYXBwUGFja2FnZSxcbiAgICAgICAgYWN0aXZpdHk6IHRoaXMub3B0cy5hcHBBY3Rpdml0eSxcbiAgICAgICAgYWN0aW9uOiB0aGlzLm9wdHMuaW50ZW50QWN0aW9uLFxuICAgICAgICBjYXRlZ29yeTogdGhpcy5vcHRzLmludGVudENhdGVnb3J5LFxuICAgICAgICBmbGFnczogdGhpcy5vcHRzLmludGVudEZsYWdzLFxuICAgICAgICB3YWl0UGtnOiB0aGlzLm9wdHMuYXBwV2FpdFBhY2thZ2UsXG4gICAgICAgIHdhaXRBY3Rpdml0eTogdGhpcy5vcHRzLmFwcFdhaXRBY3Rpdml0eSxcbiAgICAgICAgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHM6IHRoaXMub3B0cy5vcHRpb25hbEludGVudEFyZ3VtZW50cyxcbiAgICAgICAgc3RvcEFwcDogZmFsc2UsXG4gICAgICAgIHVzZXI6IHRoaXMub3B0cy51c2VyUHJvZmlsZX1cbiAgICAgIDogey8vIHRoZSBhY3Rpdml0eSB3YXMgc3RhcnRlZCBzb21lIG90aGVyIHdheSwgc28gdXNlIGRlZmF1bHRzXG4gICAgICAgIHBrZzogYXBwUGFja2FnZSxcbiAgICAgICAgYWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgICAgICB3YWl0UGtnOiBhcHBQYWNrYWdlLFxuICAgICAgICB3YWl0QWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgICAgICBzdG9wQXBwOiBmYWxzZX07XG4gIH1cbiAgYXJncyA9IGF3YWl0IHV0aWwuZmlsdGVyT2JqZWN0KGFyZ3MpO1xuICBsb2cuZGVidWcoYEJyaW5naW5nIGFwcGxpY2F0aW9uIGJhY2sgdG8gZm9yZWdyb3VuZCB3aXRoIGFyZ3VtZW50czogJHtKU09OLnN0cmluZ2lmeShhcmdzKX1gKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYWRiLnN0YXJ0QXBwKGFyZ3MpO1xufTtcblxuY29tbWFuZHMuZ2V0U3RyaW5ncyA9IGFzeW5jIGZ1bmN0aW9uIChsYW5ndWFnZSkge1xuICBpZiAoIWxhbmd1YWdlKSB7XG4gICAgbGFuZ3VhZ2UgPSBhd2FpdCB0aGlzLmFkYi5nZXREZXZpY2VMYW5ndWFnZSgpO1xuICAgIGxvZy5pbmZvKGBObyBsYW5ndWFnZSBzcGVjaWZpZWQsIHJldHVybmluZyBzdHJpbmdzIGZvcjogJHtsYW5ndWFnZX1gKTtcbiAgfVxuXG4gIC8vIENsaWVudHMgcmVxdWlyZSB0aGUgcmVzdWx0aW5nIG1hcHBpbmcgdG8gaGF2ZSBib3RoIGtleXNcbiAgLy8gYW5kIHZhbHVlcyBvZiB0eXBlIHN0cmluZ1xuICBjb25zdCBwcmVwcm9jZXNzU3RyaW5nc01hcCA9IChtYXBwaW5nKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKG1hcHBpbmcpKSB7XG4gICAgICByZXN1bHRba2V5XSA9IF8uaXNTdHJpbmcodmFsdWUpID8gdmFsdWUgOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgaWYgKHRoaXMuYXBrU3RyaW5nc1tsYW5ndWFnZV0pIHtcbiAgICAvLyBSZXR1cm4gY2FjaGVkIHN0cmluZ3NcbiAgICByZXR1cm4gcHJlcHJvY2Vzc1N0cmluZ3NNYXAodGhpcy5hcGtTdHJpbmdzW2xhbmd1YWdlXSk7XG4gIH1cblxuICB0aGlzLmFwa1N0cmluZ3NbbGFuZ3VhZ2VdID0gYXdhaXQgYW5kcm9pZEhlbHBlcnMucHVzaFN0cmluZ3MobGFuZ3VhZ2UsIHRoaXMuYWRiLCB0aGlzLm9wdHMpO1xuICBpZiAodGhpcy5ib290c3RyYXApIHtcbiAgICAvLyBUT0RPOiBUaGlzIGlzIG11dGF0aW5nIHRoZSBjdXJyZW50IGxhbmd1YWdlLCBidXQgaXQncyBob3cgYXBwaXVtIGN1cnJlbnRseSB3b3Jrc1xuICAgIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3VwZGF0ZVN0cmluZ3MnKTtcbiAgfVxuXG4gIHJldHVybiBwcmVwcm9jZXNzU3RyaW5nc01hcCh0aGlzLmFwa1N0cmluZ3NbbGFuZ3VhZ2VdKTtcbn07XG5cbmNvbW1hbmRzLmxhdW5jaEFwcCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5pbml0QVVUKCk7XG4gIGF3YWl0IHRoaXMuc3RhcnRBVVQoKTtcbn07XG5cbmNvbW1hbmRzLnN0YXJ0QWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiAoYXBwUGFja2FnZSwgYXBwQWN0aXZpdHksXG4gIGFwcFdhaXRQYWNrYWdlLCBhcHBXYWl0QWN0aXZpdHksIGludGVudEFjdGlvbiwgaW50ZW50Q2F0ZWdvcnksIGludGVudEZsYWdzLFxuICBvcHRpb25hbEludGVudEFyZ3VtZW50cywgZG9udFN0b3BBcHBPblJlc2V0KSB7XG4gIGxvZy5kZWJ1ZyhgU3RhcnRpbmcgcGFja2FnZSAnJHthcHBQYWNrYWdlfScgYW5kIGFjdGl2aXR5ICcke2FwcEFjdGl2aXR5fSdgKTtcblxuICAvLyBkb250U3RvcEFwcE9uUmVzZXQgaXMgYm90aCBhbiBhcmd1bWVudCBoZXJlLCBhbmQgYSBkZXNpcmVkIGNhcGFiaWxpdHlcbiAgLy8gaWYgdGhlIGFyZ3VtZW50IGlzIHNldCwgdXNlIGl0LCBvdGhlcndpc2UgdXNlIHRoZSBjYXBcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKGRvbnRTdG9wQXBwT25SZXNldCkpIHtcbiAgICBkb250U3RvcEFwcE9uUmVzZXQgPSAhIXRoaXMub3B0cy5kb250U3RvcEFwcE9uUmVzZXQ7XG4gIH1cblxuICBsZXQgYXJncyA9IHtcbiAgICBwa2c6IGFwcFBhY2thZ2UsXG4gICAgYWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgIHdhaXRQa2c6IGFwcFdhaXRQYWNrYWdlIHx8IGFwcFBhY2thZ2UsXG4gICAgd2FpdEFjdGl2aXR5OiBhcHBXYWl0QWN0aXZpdHkgfHwgYXBwQWN0aXZpdHksXG4gICAgYWN0aW9uOiBpbnRlbnRBY3Rpb24sXG4gICAgY2F0ZWdvcnk6IGludGVudENhdGVnb3J5LFxuICAgIGZsYWdzOiBpbnRlbnRGbGFncyxcbiAgICBvcHRpb25hbEludGVudEFyZ3VtZW50cyxcbiAgICBzdG9wQXBwOiAhZG9udFN0b3BBcHBPblJlc2V0XG4gIH07XG4gIHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJncyA9IHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJncyB8fCB7fTtcbiAgdGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzW2Ake2FyZ3Mud2FpdFBrZ30vJHthcmdzLndhaXRBY3Rpdml0eX1gXSA9IGFyZ3M7XG4gIGF3YWl0IHRoaXMuYWRiLnN0YXJ0QXBwKGFyZ3MpO1xufTtcblxuY29tbWFuZHMucmVzZXQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGF3YWl0IGFuZHJvaWRIZWxwZXJzLnJlc2V0QXBwKHRoaXMuYWRiLCBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm9wdHMsIHtmYXN0UmVzZXQ6IHRydWV9KSk7XG4gIC8vIHJlc2V0IGNvbnRleHQgc2luY2Ugd2UgZG9uJ3Qga25vdyB3aGF0IGtpbmQgb24gY29udGV4dCB3ZSB3aWxsIGVuZCB1cCBhZnRlciBhcHAgbGF1bmNoLlxuICB0aGlzLmN1ckNvbnRleHQgPSBOQVRJVkVfV0lOO1xuXG4gIHJldHVybiBhd2FpdCB0aGlzLmlzQ2hyb21lU2Vzc2lvbiA/IHRoaXMuc3RhcnRDaHJvbWVTZXNzaW9uKCkgOiB0aGlzLnN0YXJ0QVVUKCk7XG59O1xuXG5jb21tYW5kcy5zdGFydEFVVCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5hZGIuc3RhcnRBcHAoe1xuICAgIHBrZzogdGhpcy5vcHRzLmFwcFBhY2thZ2UsXG4gICAgYWN0aXZpdHk6IHRoaXMub3B0cy5hcHBBY3Rpdml0eSxcbiAgICBhY3Rpb246IHRoaXMub3B0cy5pbnRlbnRBY3Rpb24sXG4gICAgY2F0ZWdvcnk6IHRoaXMub3B0cy5pbnRlbnRDYXRlZ29yeSxcbiAgICBmbGFnczogdGhpcy5vcHRzLmludGVudEZsYWdzLFxuICAgIHdhaXRQa2c6IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSxcbiAgICB3YWl0QWN0aXZpdHk6IHRoaXMub3B0cy5hcHBXYWl0QWN0aXZpdHksXG4gICAgd2FpdER1cmF0aW9uOiB0aGlzLm9wdHMuYXBwV2FpdER1cmF0aW9uLFxuICAgIG9wdGlvbmFsSW50ZW50QXJndW1lbnRzOiB0aGlzLm9wdHMub3B0aW9uYWxJbnRlbnRBcmd1bWVudHMsXG4gICAgc3RvcEFwcDogIXRoaXMub3B0cy5kb250U3RvcEFwcE9uUmVzZXQsXG4gICAgdXNlcjogdGhpcy5vcHRzLnVzZXJQcm9maWxlLFxuICB9KTtcbn07XG5cbi8vIHdlIG92ZXJyaWRlIHNldFVybCB0byB0YWtlIGFuIGFuZHJvaWQgVVJJIHdoaWNoIGNhbiBiZSB1c2VkIGZvciBkZWVwLWxpbmtpbmdcbi8vIGluc2lkZSBhbiBhcHAsIHNpbWlsYXIgdG8gc3RhcnRpbmcgYW4gaW50ZW50XG5jb21tYW5kcy5zZXRVcmwgPSBhc3luYyBmdW5jdGlvbiAodXJpKSB7XG4gIGF3YWl0IHRoaXMuYWRiLnN0YXJ0VXJpKHVyaSwgdGhpcy5vcHRzLmFwcFBhY2thZ2UpO1xufTtcblxuLy8gY2xvc2luZyBhcHAgdXNpbmcgZm9yY2Ugc3RvcFxuY29tbWFuZHMuY2xvc2VBcHAgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGF3YWl0IHRoaXMuYWRiLmZvcmNlU3RvcCh0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG4gIC8vIHJlc2V0IGNvbnRleHQgc2luY2Ugd2UgZG9uJ3Qga25vdyB3aGF0IGtpbmQgb24gY29udGV4dCB3ZSB3aWxsIGVuZCB1cCBhZnRlciBhcHAgbGF1bmNoLlxuICB0aGlzLmN1ckNvbnRleHQgPSBOQVRJVkVfV0lOO1xuICBhd2FpdCB0aGlzLnN0b3BDaHJvbWVkcml2ZXJQcm94aWVzKCk7XG59O1xuXG5jb21tYW5kcy5nZXREaXNwbGF5RGVuc2l0eSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgLy8gZmlyc3QgdHJ5IHRoZSBwcm9wZXJ0eSBmb3IgZGV2aWNlc1xuICBsZXQgb3V0ID0gYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydnZXRwcm9wJywgJ3JvLnNmLmxjZF9kZW5zaXR5J10pO1xuICBpZiAob3V0KSB7XG4gICAgbGV0IHZhbCA9IHBhcnNlSW50KG91dCwgMTApO1xuICAgIC8vIGlmIHRoZSB2YWx1ZSBpcyBOYU4sIHRyeSBnZXR0aW5nIHRoZSBlbXVsYXRvciBwcm9wZXJ0eVxuICAgIGlmICghaXNOYU4odmFsKSkge1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBQYXJzZWQgZGVuc2l0eSB2YWx1ZSB3YXMgTmFOOiBcIiR7b3V0fVwiYCk7XG4gIH1cbiAgLy8gZmFsbGJhY2sgdG8gdHJ5aW5nIHByb3BlcnR5IGZvciBlbXVsYXRvcnNcbiAgb3V0ID0gYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydnZXRwcm9wJywgJ3FlbXUuc2YubGNkX2RlbnNpdHknXSk7XG4gIGlmIChvdXQpIHtcbiAgICBsZXQgdmFsID0gcGFyc2VJbnQob3V0LCAxMCk7XG4gICAgaWYgKCFpc05hTih2YWwpKSB7XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYFBhcnNlZCBkZW5zaXR5IHZhbHVlIHdhcyBOYU46IFwiJHtvdXR9XCJgKTtcbiAgfVxuICAvLyBjb3VsZG4ndCBnZXQgYW55dGhpbmcsIHNvIGVycm9yIG91dFxuICBsb2cuZXJyb3JBbmRUaHJvdygnRmFpbGVkIHRvIGdldCBkaXNwbGF5IGRlbnNpdHkgcHJvcGVydHkuJyk7XG59O1xuXG4vKipcbiAqIFBhcnNlcyB0aGUgZ2l2ZW4gd2luZG93IG1hbmFnZXIgU3VyZmFjZSBzdHJpbmcgdG8gZ2V0IGluZm8uXG4gKiBAcGFyYW0gbGluZTogVG8gcGFyc2UuIFRoaXMgaXMgYXNzdW1lZCB0byBiZSB2YWxpZC5cbiAqIEByZXR1cm46IFZpc2liaWxpdHkgYW5kIGJvdW5kcyBvZiB0aGUgU3VyZmFjZS5cbiAqL1xuZnVuY3Rpb24gcGFyc2VTdXJmYWNlTGluZSAobGluZSkge1xuICAvLyB0aGUgc3VyZmFjZSBib3VuZHMgYXJlIGluIHRoZSBmb3JtYXQ6XG4gIC8vIFwicmVjdD0oMC4wLDExODQuMCkgNzY4LjAgeCA5Ni4wXCJcbiAgLy8gICAgICAgXiBsb2NhdGlvbiAgIF4gc2l6ZVxuICAvLyBjdXQgb3V0IHRoZSBzdHVmZiBiZWZvcmUgdGhlICdyZWN0JyBhbmQgdGhlbiBzcGxpdCB0aGUgbnVtYmVycyBhcGFydFxuICBsZXQgYm91bmRzID0gbGluZS5zcGxpdCgncmVjdD0nKVsxXVxuICAucmVwbGFjZSgvWygpLCB4XSsvZywgJyAnKVxuICAudHJpbSgpXG4gIC5zcGxpdCgnICcpO1xuXG4gIHJldHVybiB7XG4gICAgdmlzaWJsZTogKGxpbmUuaW5kZXhPZignc2hvd249dHJ1ZScpICE9PSAtMSksXG4gICAgeDogcGFyc2VGbG9hdChib3VuZHNbMF0pLFxuICAgIHk6IHBhcnNlRmxvYXQoYm91bmRzWzFdKSxcbiAgICB3aWR0aDogcGFyc2VGbG9hdChib3VuZHNbMl0pLFxuICAgIGhlaWdodDogcGFyc2VGbG9hdChib3VuZHNbM10pXG4gIH07XG59XG5cbi8qKlxuICogRXh0cmFjdHMgc3RhdHVzIGFuZCBuYXZpZ2F0aW9uIGJhciBpbmZvcm1hdGlvbiBmcm9tIHRoZSB3aW5kb3cgbWFuYWdlciBvdXRwdXQuXG4gKiBAcGFyYW0gbGluZXM6IE91dHB1dCBmcm9tIGR1bXBzeXMgY29tbWFuZFxuICogQHJldHVybjogVmlzaWJpbGl0eSBhbmQgYm91bmRzIGluZm8gb2Ygc3RhdHVzIGFuZCBuYXZpZ2F0aW9uIGJhclxuICovXG5mdW5jdGlvbiBwYXJzZVdpbmRvd3MgKGxpbmVzKSB7XG4gIGxldCBhdFN0YXR1c0JhciA9IGZhbHNlO1xuICBsZXQgYXROYXZCYXIgPSBmYWxzZTtcbiAgbGV0IHN0YXR1c0JhcjtcbiAgbGV0IG5hdmlnYXRpb25CYXI7XG4gIC8vIHRoZSB3aW5kb3cgbWFuYWdlciBvdXRwdXQgbG9va3MgbGlrZTpcbiAgLy8gV2luZG93ICMxIC4uLiBXaW5kb3dJRFxuICAvLyAgIEEgYnVuY2ggb2YgcHJvcGVydGllc1xuICAvLyBXaW5kb3cgIzIgLi4uIFdpbmRvd0lEXG4gIC8vICAgQSBidW5jaCBvZiBwcm9wZXJ0aWVzXG4gIGxpbmVzLnNwbGl0KCdcXG4nKS5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgLy8gdGhlIHN0YXJ0IG9mIGEgbmV3IHdpbmRvdyBzZWN0aW9uXG4gICAgaWYgKGxpbmUuaW5kZXhPZignICBXaW5kb3cgIycpICE9PSAtMSkge1xuICAgICAgLy8gZGV0ZXJtaW5lIHdoaWNoIHNlY3Rpb24gd2UncmUgaW5cbiAgICAgIC8vIG9ubHkgb25lIHdpbGwgYmUgdHJ1ZVxuICAgICAgYXRTdGF0dXNCYXIgPSAobGluZS5pbmRleE9mKCdTdGF0dXNCYXInKSAhPT0gLTEpO1xuICAgICAgYXROYXZCYXIgPSAobGluZS5pbmRleE9mKCdOYXZpZ2F0aW9uQmFyJykgIT09IC0xKTtcbiAgICAgIC8vIGRvbid0IG5lZWQgYW55dGhpbmcgZWxzZS4gbW92ZSB0byBuZXh0IGxpbmVcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gb25jZSB3ZSdyZSBpbiBhIHdpbmRvdyBzZWN0aW9uLCBsb29rIGZvciB0aGUgc3VyZmFjZSBkYXRhIGxpbmVcbiAgICBpZiAobGluZS5pbmRleE9mKCcgICAgICBTdXJmYWNlOicpID09PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYXRTdGF0dXNCYXIpIHtcbiAgICAgIHN0YXR1c0JhciA9IHBhcnNlU3VyZmFjZUxpbmUobGluZSk7XG4gICAgICBhdFN0YXR1c0JhciA9IGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoYXROYXZCYXIpIHtcbiAgICAgIG5hdmlnYXRpb25CYXIgPSBwYXJzZVN1cmZhY2VMaW5lKGxpbmUpO1xuICAgICAgYXROYXZCYXIgPSBmYWxzZTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmICghc3RhdHVzQmFyKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0ZhaWxlZCB0byBwYXJzZSBzdGF0dXMgYmFyIGluZm9ybWF0aW9uLicpO1xuICB9XG4gIGlmICghbmF2aWdhdGlvbkJhcikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdGYWlsZWQgdG8gcGFyc2UgbmF2aWdhdGlvbiBiYXIgaW5mb3JtYXRpb24uJyk7XG4gIH1cblxuICByZXR1cm4ge3N0YXR1c0JhciwgbmF2aWdhdGlvbkJhcn07XG59XG5cbmNvbW1hbmRzLmdldFN5c3RlbUJhcnMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBvdXQgPSBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2R1bXBzeXMnLCAnd2luZG93JywgJ3dpbmRvd3MnXSk7XG4gIGlmICghb3V0KSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0RpZCBub3QgZ2V0IHdpbmRvdyBtYW5hZ2VyIG91dHB1dC4nKTtcbiAgfVxuICByZXR1cm4gcGFyc2VXaW5kb3dzKG91dCk7XG59O1xuXG5jb21tYW5kcy5tb2JpbGVQZXJmb3JtRWRpdG9yQWN0aW9uID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCB7YWN0aW9ufSA9IG9wdHM7XG4gIGlmICghdXRpbC5oYXNWYWx1ZShhY3Rpb24pKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYCdhY3Rpb24nIGFyZ3VtZW50IGlzIHJlcXVpcmVkYCk7XG4gIH1cblxuICBhd2FpdCB0aGlzLmFkYi5wZXJmb3JtRWRpdG9yQWN0aW9uKGFjdGlvbik7XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuLy8gZm9yIHVuaXQgdGVzdHNcbmV4cG9ydCB7IHBhcnNlV2luZG93cywgcGFyc2VTdXJmYWNlTGluZSB9O1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZ2VuZXJhbC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
